<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CardPick - Best Card for Every Purchase</title>
<meta name="description" content="CardPick - Free credit card reward optimizer for India. Find the best card and multi-step routes to maximize cashback on every purchase.">
<!-- Favicon -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect rx='22' width='100' height='100' fill='%23e8503a'/><text x='50' y='68' font-size='55' text-anchor='middle' fill='white' font-family='system-ui' font-weight='bold'>CP</text></svg>">
<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#e8503a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icons/icon-192.png">
<!-- Google Analytics 4 — Replace G-XXXXXXXXXX with your Measurement ID -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-XXXXXXXXXX');</script>
<!-- Google AdSense — Replace ca-pub-XXXXXXXXXXXXXXXX with your publisher ID after approval -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>
<style>
/* ====== Monzo-inspired Design System ====== */
/* Warm, friendly, light theme with hot coral accent */
:root {
  --bg: #f7f5f0; --bg-sub: #ffffff; --bg-card: #ffffff; --bg-hover: #faf8f4;
  --bg-inset: #f0ede6; --bg-surface: #f5f3ed;
  --border: #e4e0d8; --border-hover: #d4d0c8; --border-active: #c0bbb1;
  --text-1: #1a2233; --text-2: #556070; --text-3: #8e99a8;
  --accent: #e8503a; --accent-dim: #e8503a15; --accent-hover: #d4442f;
  --blue: #2d7ff9; --green: #00a67e; --green-dim: #00a67e10; --green-border: #00a67e28;
  --red: #e8503a; --yellow: #f5a623; --orange: #e87d2f;
  --r: 14px; --r-lg: 20px; --r-sm: 10px; --r-pill: 100px;
  --shadow: 0 1px 3px rgba(26,34,51,0.06), 0 4px 12px rgba(26,34,51,0.04);
  --shadow-lg: 0 8px 30px rgba(26,34,51,0.1), 0 2px 8px rgba(26,34,51,0.04);
  --ease: cubic-bezier(.4,0,.2,1); --dur: .2s;
}

* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior: smooth; }
body { font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text-1); min-height: 100vh; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; line-height: 1.6; }

::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #c0bbb180; border-radius: 10px; }
::-webkit-scrollbar-thumb:hover { background: #a09a90; }

::selection { background: var(--accent-dim); color: var(--text-1); }

/* ====== Container ====== */
.container { max-width: 860px; margin: 0 auto; padding: 0 24px 28px; }

/* ====== Header ====== */
.app-header { padding: 44px 0 32px; text-align: center; position: relative; }
h1 { font-size: 2.4rem; font-weight: 800; letter-spacing: -0.04em; color: var(--text-1); display: inline-block; }
h1::after { content: '.'; color: var(--accent); }
.subtitle { color: var(--text-3); font-size: 0.92rem; margin-top: 8px; font-weight: 400; letter-spacing: -0.01em; }

/* ====== Tabs ====== */
.tabs { display: flex; gap: 4px; margin-bottom: 28px; padding: 4px; background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--r); box-shadow: var(--shadow); }
.tab { flex: 1; text-align: center; padding: 11px 8px; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 0.84rem; color: var(--text-3); transition: all var(--dur) var(--ease); display: flex; align-items: center; justify-content: center; gap: 7px; user-select: none; }
.tab .tab-icon { font-size: 1rem; }
.tab .tab-label {}
.tab:hover:not(.active) { color: var(--text-2); background: var(--bg-surface); }
.tab.active { color: #fff; background: var(--accent); box-shadow: 0 2px 8px rgba(232,80,58,0.3); }
@media(max-width:480px) { .tab .tab-label { display:none; } .tab .tab-icon { font-size:1.15rem; } }

.panel { display: none; }
.panel.active { display: block; animation: panelIn .3s var(--ease); }
@keyframes panelIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }

/* ====== Form elements ====== */
label { display: block; font-size: 0.78rem; color: var(--text-3); margin-bottom: 6px; margin-top: 16px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }
input, select { width: 100%; padding: 12px 14px; background: var(--bg-sub); border: 2px solid var(--border); border-radius: var(--r-sm); color: var(--text-1); font-size: 0.92rem; transition: all var(--dur) var(--ease); font-family: inherit; }
input:focus, select:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-dim); }
input::placeholder { color: var(--text-3); }
select { cursor: pointer; }
select option { background: var(--bg-card); color: var(--text-1); }

/* ====== Buttons ====== */
.btn { padding: 11px 22px; border: none; border-radius: var(--r-pill); cursor: pointer; font-weight: 700; font-size: 0.88rem; transition: all var(--dur) var(--ease); font-family: inherit; letter-spacing: -0.01em; }
.btn-primary { background: var(--accent); color: #fff; box-shadow: 0 2px 10px rgba(232,80,58,0.25); }
.btn-primary:hover { background: var(--accent-hover); box-shadow: 0 4px 18px rgba(232,80,58,0.35); transform: translateY(-1px); }
.btn-primary:active { transform: translateY(0); }
.btn-secondary { background: var(--bg-surface); color: var(--text-2); border: 2px solid var(--border); }
.btn-secondary:hover { color: var(--text-1); background: var(--bg-hover); border-color: var(--border-hover); }
.btn-danger { background: transparent; color: var(--red); border: 2px solid rgba(232,80,58,0.15); font-size: 0.78rem; padding: 5px 14px; border-radius: var(--r-pill); }
.btn-danger:hover { background: rgba(232,80,58,0.06); border-color: rgba(232,80,58,0.25); }
.btn-add { width: 100%; padding: 18px; background: transparent; border: 2px dashed var(--border); color: var(--text-3); border-radius: var(--r); cursor: pointer; font-size: 0.92rem; font-weight: 600; transition: all var(--dur) var(--ease); font-family: inherit; }
.btn-add:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-dim); }

/* ====== Compare box ====== */
.compare-box { background: var(--bg-card); border-radius: var(--r-lg); padding: 28px; margin-bottom: 24px; border: 1px solid var(--border); box-shadow: var(--shadow); }
.compare-row { display: flex; gap: 14px; align-items: end; flex-wrap: wrap; }
.compare-row .field { flex: 1; min-width: 180px; }
.compare-row .field-sm { flex: 0 0 140px; }

/* ====== Card entry (My Cards) ====== */
.card-entry { background: var(--bg-card); border-radius: var(--r); padding: 20px; margin-bottom: 10px; border: 1px solid var(--border); display: flex; align-items: stretch; transition: all var(--dur) var(--ease); box-shadow: var(--shadow); }
.card-entry:hover { border-color: var(--border-hover); box-shadow: var(--shadow-lg); transform: translateY(-1px); }
.card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.card-name { font-size: 1.02rem; font-weight: 700; letter-spacing: -0.02em; color: var(--text-1); }
.card-rewards { display: flex; flex-wrap: wrap; gap: 5px; }
.reward-tag { background: var(--bg-inset); padding: 4px 10px; border-radius: var(--r-pill); font-size: 0.72rem; color: var(--text-2); border: 1px solid var(--border); }
.reward-tag span { color: var(--accent); font-weight: 700; }
.card-color-bar { width: 5px; border-radius: 5px; align-self: stretch; margin-right: 14px; flex-shrink: 0; }
.card-body { flex: 1; }
.card-notes { font-size: 0.72rem; color: var(--text-3); margin-top: 6px; }
.annual-note { font-size: 0.72rem; color: var(--text-3); margin-top: 2px; }

/* ====== Modal ====== */
.modal-overlay { display: none; position: fixed; inset: 0; background: rgba(26,34,51,0.5); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); z-index: 100; align-items: center; justify-content: center; }
.modal-overlay.open { display: flex; }
.modal { background: var(--bg-sub); border-radius: var(--r-lg); padding: 32px; width: 92%; max-width: 540px; max-height: 88vh; overflow-y: auto; border: 1px solid var(--border); box-shadow: var(--shadow-lg); animation: modalPop .25s var(--ease); }
@keyframes modalPop { from { opacity:0; transform:scale(.96) translateY(8px); } to { opacity:1; transform:scale(1) translateY(0); } }
.modal h2 { margin-bottom: 22px; font-size: 1.2rem; font-weight: 800; letter-spacing: -0.03em; color: var(--text-1); }
.modal-actions { display: flex; gap: 10px; margin-top: 26px; justify-content: flex-end; }
.category-rates { margin-top: 18px; }
.category-rates h3 { font-size: 0.92rem; color: var(--text-1); margin-bottom: 4px; font-weight: 700; }
.category-rates p { font-size: 0.78rem; color: var(--text-3); margin-bottom: 14px; }
.rate-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
.rate-row label { margin: 0; flex: 1; font-size: 0.84rem; color: var(--text-2); text-transform: none; letter-spacing: 0; }
.rate-row input { width: 90px; flex: none; text-align: right; }

/* ====== Search dropdown ====== */
.search-wrap { position: relative; }
.search-wrap input { padding-left: 38px; }
.search-icon { position: absolute; left: 13px; top: 50%; transform: translateY(-50%); color: var(--text-3); pointer-events: none; font-size: 0.92rem; }
.search-dropdown { position: absolute; top: 100%; left: 0; right: 0; background: var(--bg-sub); border: 1px solid var(--border); border-radius: var(--r); max-height: 360px; overflow-y: auto; z-index: 10; display: none; margin-top: 6px; box-shadow: var(--shadow-lg); }
.search-dropdown.open { display: block; }
.search-item { padding: 11px 16px; cursor: pointer; border-bottom: 1px solid var(--border); transition: background .12s; display: flex; align-items: center; gap: 10px; }
.search-item:last-child { border-bottom: none; }
.search-item:hover, .search-item.highlighted { background: var(--bg-inset); }
.search-item .si-name { font-weight: 700; font-size: 0.88rem; color: var(--text-1); }
.search-item .si-bank { color: var(--text-3); font-size: 0.75rem; margin-left: 6px; }
.search-item .si-desc { font-size: 0.72rem; color: var(--text-3); margin-top: 2px; }
.si-info { flex: 1; min-width: 0; }
.search-divider { padding: 8px 16px; font-size: 0.68rem; color: var(--accent); font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em; background: var(--accent-dim); border-bottom: 1px solid var(--border); }
.autofill-badge { display: inline-block; background: var(--accent-dim); color: var(--accent); font-size: 0.66rem; padding: 2px 8px; border-radius: var(--r-pill); margin-left: 6px; font-weight: 700; }
.manual-link { display: block; text-align: center; color: var(--text-3); font-size: 0.82rem; margin-top: 10px; cursor: pointer; padding: 6px; transition: color var(--dur); }
.manual-link:hover { color: var(--accent); }

/* ====== Results & Routes ====== */
.results { margin-top: 22px; }
.results-header { margin-bottom: 16px; }
.results-header h3 { font-size: 0.95rem; color: var(--text-2); margin-bottom: 4px; font-weight: 700; }
.results-header .savings-summary { font-size: 0.84rem; color: var(--green); font-weight: 700; }

.route-card { background: var(--bg-card); border-radius: var(--r); padding: 20px 22px; margin-bottom: 10px; border: 1px solid var(--border); transition: all var(--dur) var(--ease); box-shadow: var(--shadow); }
.route-card:hover { box-shadow: var(--shadow-lg); transform: translateY(-1px); }
.route-card.best { border-color: var(--green-border); background: var(--green-dim); border-left: 4px solid var(--green); }
.route-header { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
.route-rank { font-size: 1.2rem; font-weight: 800; color: var(--text-3); width: 34px; flex-shrink: 0; letter-spacing: -0.02em; }
.route-card.best .route-rank { color: var(--green); }
.route-title { flex: 1; min-width: 0; }
.route-title .name { font-weight: 700; font-size: 0.95rem; letter-spacing: -0.01em; color: var(--text-1); }
.route-title .type-tag { display: inline-block; font-size: 0.62rem; padding: 3px 9px; border-radius: var(--r-pill); margin-left: 8px; font-weight: 700; vertical-align: middle; text-transform: uppercase; letter-spacing: 0.04em; }
.route-title .type-tag.direct { background: #2d7ff915; color: var(--blue); border: 1px solid #2d7ff925; }
.route-title .type-tag.route { background: var(--accent-dim); color: var(--accent); border: 1px solid rgba(232,80,58,0.18); }
.route-reward { text-align: right; flex-shrink: 0; }
.route-reward .amount { font-size: 1.3rem; font-weight: 800; color: var(--accent); letter-spacing: -0.02em; }
.route-card.best .route-reward .amount { color: var(--green); }
.route-reward .label { font-size: 0.72rem; color: var(--text-3); }
.best-badge { display: inline-block; background: var(--green-dim); color: var(--green); font-size: 0.62rem; font-weight: 700; padding: 3px 10px; border-radius: var(--r-pill); margin-left: 8px; vertical-align: middle; border: 1px solid var(--green-border); text-transform: uppercase; letter-spacing: 0.04em; }

.route-steps { margin-top: 14px; padding: 16px; background: var(--bg-inset); border-radius: var(--r-sm); border: 1px solid var(--border); }
.route-step { display: flex; align-items: flex-start; gap: 10px; padding: 8px 0; }
.route-step:not(:last-child) { border-bottom: 1px solid var(--border); }
.step-num { width: 24px; height: 24px; border-radius: 50%; background: var(--accent); color: #fff; font-size: 0.72rem; font-weight: 700; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 1px; }
.step-body { flex: 1; }
.step-action { font-size: 0.84rem; color: var(--text-2); }
.step-card-used { font-size: 0.74rem; color: var(--blue); margin-top: 2px; font-weight: 600; }
.step-reward { font-size: 0.8rem; font-weight: 700; color: var(--green); flex-shrink: 0; }
.route-tip { margin-top: 12px; padding: 12px 16px; background: #f5a62308; border: 1px solid #f5a62320; border-radius: var(--r-sm); font-size: 0.76rem; color: #b07a1a; }
.route-tip::before { content: 'TIP '; font-weight: 800; letter-spacing: 0.04em; margin-right: 4px; }
.route-notes { font-size: 0.74rem; color: var(--text-3); margin-top: 6px; }
.route-savings { margin-top: 8px; font-size: 0.82rem; color: var(--green); font-weight: 700; }

.result-card { background: var(--bg-card); border-radius: var(--r); padding: 18px 22px; margin-bottom: 10px; border: 1px solid var(--border); display: flex; align-items: center; transition: all var(--dur) var(--ease); box-shadow: var(--shadow); }
.result-card:hover { box-shadow: var(--shadow-lg); transform: translateY(-1px); }
.result-card.best { border-color: var(--green-border); background: var(--green-dim); border-left: 4px solid var(--green); }
.result-rank { font-size: 1.3rem; font-weight: 800; color: var(--text-3); width: 36px; flex-shrink: 0; }
.result-card.best .result-rank { color: var(--green); }
.result-info { flex: 1; min-width: 0; }
.result-info .name { font-weight: 700; font-size: 1rem; color: var(--text-1); }
.result-info .detail { font-size: 0.82rem; color: var(--text-3); margin-top: 2px; }
.result-info .notes { font-size: 0.74rem; color: var(--text-3); margin-top: 3px; }
.result-reward { text-align: right; flex-shrink: 0; margin-left: 12px; }
.result-reward .amount { font-size: 1.3rem; font-weight: 800; color: var(--accent); }
.result-card.best .result-reward .amount { color: var(--green); }
.result-reward .label { font-size: 0.72rem; color: var(--text-3); }
.result-color-bar { width: 4px; border-radius: 3px; align-self: stretch; margin-right: 14px; min-height: 40px; flex-shrink: 0; }

.empty-state { text-align: center; padding: 60px 20px; color: var(--text-3); }
.empty-state .icon { font-size: 2.8rem; margin-bottom: 14px; opacity: 0.35; }
.empty-state p { margin-bottom: 6px; font-size: 0.9rem; }

/* ====== Share ====== */
.btn-share { display: inline-flex; align-items: center; gap: 6px; background: var(--bg-card); color: var(--text-2); font-size: 0.78rem; font-weight: 600; padding: 8px 16px; border-radius: var(--r-pill); border: 1px solid var(--border); cursor: pointer; transition: all var(--dur) var(--ease); }
.btn-share:hover { background: var(--bg-hover); color: var(--text-1); border-color: var(--border-hover); box-shadow: var(--shadow); }
.btn-share.copied { background: var(--green-dim); color: var(--green); border-color: var(--green-border); }

/* ====== Recommend ====== */
.rec-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 10px; margin-bottom: 16px; }
.rec-field label { font-size: 0.72rem; color: var(--text-3); margin-bottom: 3px; display: block; margin-top: 0; }
.rec-field input { width: 100%; }
.rec-card { background: var(--bg-card); border-radius: var(--r); padding: 22px; border: 1px solid var(--border); margin-bottom: 10px; transition: all var(--dur) var(--ease); box-shadow: var(--shadow); }
.rec-card:hover { box-shadow: var(--shadow-lg); transform: translateY(-1px); }
.rec-card.top-pick { border-color: var(--green-border); background: var(--green-dim); border-left: 4px solid var(--green); }
.rec-card .rec-rank { font-size: 0.7rem; font-weight: 800; color: var(--text-3); text-transform: uppercase; letter-spacing: 0.06em; }
.rec-card.top-pick .rec-rank { color: var(--green); }
.rec-card .rec-name { font-size: 1.08rem; font-weight: 800; margin: 4px 0; letter-spacing: -0.02em; color: var(--text-1); }
.rec-card .rec-bank { font-size: 0.8rem; color: var(--text-3); }
.rec-card .rec-stats { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 14px; }
.rec-stat { background: var(--bg-inset); border-radius: var(--r-sm); padding: 12px 14px; flex: 1; min-width: 90px; border: 1px solid var(--border); }
.rec-stat .stat-label { font-size: 0.66rem; color: var(--text-3); text-transform: uppercase; letter-spacing: 0.04em; font-weight: 600; }
.rec-stat .stat-value { font-size: 1.05rem; font-weight: 800; color: var(--accent); margin-top: 3px; letter-spacing: -0.02em; }
.rec-card .rec-fee { font-size: 0.78rem; color: var(--text-3); margin-top: 12px; }
.rec-card .rec-notes { font-size: 0.74rem; color: var(--text-3); margin-top: 6px; }
.rec-card .rec-milestones { margin-top: 14px; }
.milestone-bar { display: flex; align-items: center; gap: 8px; margin-bottom: 6px; }
.milestone-track { flex: 1; height: 6px; background: var(--bg-inset); border-radius: 4px; overflow: hidden; border: 1px solid var(--border); }
.milestone-fill { height: 100%; border-radius: 4px; background: linear-gradient(90deg, var(--accent), var(--green)); transition: width .4s var(--ease); }
.milestone-label { font-size: 0.7rem; color: var(--text-3); white-space: nowrap; }
.milestone-reward { font-size: 0.7rem; color: var(--green); font-weight: 700; white-space: nowrap; }

/* ====== Fee toggle ====== */
.fee-toggle { display: flex; align-items: center; gap: 8px; margin-top: 12px; }
.fee-toggle label { margin: 0; font-size: 0.8rem; color: var(--text-2); cursor: pointer; text-transform: none; letter-spacing: 0; }
.fee-toggle input { width: auto; cursor: pointer; accent-color: var(--accent); }

/* ====== Tags ====== */
.perk-tag { display: inline-block; background: var(--accent-dim); color: var(--accent); font-size: 0.68rem; padding: 3px 9px; border-radius: var(--r-pill); margin-right: 3px; margin-top: 3px; font-weight: 600; }
.excluded-tag { display: inline-block; background: rgba(232,80,58,0.06); color: var(--red); font-size: 0.66rem; padding: 2px 8px; border-radius: var(--r-pill); margin-left: 3px; font-weight: 600; }

/* ====== Apply ====== */
.btn-apply { display: inline-block; background: var(--accent); color: #fff; font-size: 0.72rem; font-weight: 700; padding: 5px 14px; border-radius: var(--r-pill); text-decoration: none; transition: all var(--dur) var(--ease); border: none; cursor: pointer; white-space: nowrap; }
.btn-apply:hover { background: var(--accent-hover); transform: translateY(-1px); box-shadow: 0 2px 8px rgba(232,80,58,0.25); }
.btn-apply-sm { font-size: 0.68rem; padding: 4px 12px; }
.apply-row { display: flex; align-items: center; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
.apply-row .apply-hint { font-size: 0.68rem; color: var(--text-3); }
.db-ok { color: var(--green); }
.db-warn { color: var(--yellow); }
.db-err { color: var(--red); }

/* ====== Color picker ====== */
.color-options { display: flex; gap: 8px; margin-top: 6px; }
.color-dot { width: 28px; height: 28px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; transition: all .15s; box-shadow: 0 1px 4px rgba(0,0,0,0.15); }
.color-dot:hover { transform: scale(1.12); }
.color-dot.selected { border-color: var(--text-1); transform: scale(1.18); box-shadow: 0 2px 8px rgba(0,0,0,0.2); }

/* ====== IO ====== */
.io-bar { display: flex; gap: 8px; margin-bottom: 16px; flex-wrap: wrap; }
.btn-io { background: var(--bg-card); color: var(--text-2); font-size: 0.78rem; font-weight: 600; padding: 8px 16px; border-radius: var(--r-pill); border: 1px solid var(--border); cursor: pointer; transition: all var(--dur) var(--ease); font-family: inherit; }
.btn-io:hover { background: var(--bg-hover); color: var(--text-1); border-color: var(--border-hover); box-shadow: var(--shadow); }

/* ====== Tracker ====== */
.tracker-month { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
.tracker-month select { width: auto; min-width: 140px; }
.tracker-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 16px; }
.tracker-field label { font-size: 0.72rem; color: var(--text-3); margin-bottom: 3px; display: block; margin-top: 0; }
.tracker-field input { width: 100%; }
.tracker-summary { background: var(--bg-card); border-radius: var(--r-sm); padding: 18px; margin-top: 14px; border: 1px solid var(--border); box-shadow: var(--shadow); }
.tracker-row { display: flex; justify-content: space-between; align-items: center; padding: 7px 0; border-bottom: 1px solid var(--border); }
.tracker-row:last-child { border-bottom: none; }
.tracker-cat { font-size: 0.84rem; color: var(--text-2); }
.tracker-amt { font-size: 0.84rem; color: var(--accent); font-weight: 700; }
.tracker-total { display: flex; justify-content: space-between; padding: 10px 0 0; margin-top: 6px; border-top: 2px solid var(--border-hover); font-weight: 800; }
.tracker-insight { background: var(--green-dim); border: 1px solid var(--green-border); border-radius: var(--r-sm); padding: 16px; margin-top: 16px; }
.tracker-insight h4 { font-size: 0.84rem; color: var(--green); margin-bottom: 8px; font-weight: 700; }
.tracker-insight p { font-size: 0.78rem; color: var(--text-2); margin-bottom: 4px; }
.tracker-insight .highlight { color: var(--green); font-weight: 700; }
.tracker-insight .missed { color: var(--red); font-weight: 700; }
.tracker-history { margin-top: 18px; }
.tracker-history h4 { font-size: 0.84rem; color: var(--text-2); margin-bottom: 8px; font-weight: 700; }
.history-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 16px; background: var(--bg-card); border-radius: var(--r-sm); margin-bottom: 6px; font-size: 0.82rem; border: 1px solid var(--border); transition: all var(--dur) var(--ease); box-shadow: var(--shadow); }
.history-row:hover { box-shadow: var(--shadow-lg); transform: translateY(-1px); }
.history-row .h-month { color: var(--text-1); font-weight: 700; }
.history-row .h-spend { color: var(--text-3); }
.history-row .h-reward { color: var(--green); font-weight: 700; }
.history-row .h-delete { color: var(--red); cursor: pointer; font-size: 0.74rem; margin-left: 8px; }

/* ====== Discontinued ====== */
.discontinued-badge { display: inline-block; background: rgba(232,80,58,0.08); color: var(--red); font-size: 0.64rem; font-weight: 700; padding: 3px 9px; border-radius: var(--r-pill); margin-left: 6px; letter-spacing: 0.03em; text-transform: uppercase; vertical-align: middle; border: 1px solid rgba(232,80,58,0.15); }
.discontinued-note { font-size: 0.72rem; color: var(--red); margin-top: 4px; opacity: 0.8; }
.search-item.discontinued { opacity: 0.5; }
.search-item.discontinued .card-mini { filter: grayscale(.7); }
.suggest-card.discontinued { opacity: 0.45; border-color: rgba(232,80,58,0.15); }
.suggest-card.discontinued .card-visual-lg { filter: grayscale(.7); }
.card-entry.discontinued { opacity: 0.5; border-color: rgba(232,80,58,0.15); }
.card-entry.discontinued .card-color-bar { filter: grayscale(.7); }
.route-card .discontinued-inline { font-size: 0.68rem; color: var(--red); font-weight: 700; margin-left: 6px; }
.route-card.discontinued { opacity: 0.55; border-color: rgba(232,80,58,0.15); }
.rec-card.discontinued { opacity: 0.5; border-color: rgba(232,80,58,0.15); }

/* ====== Mini card visual ====== */
.card-mini { width: 60px; height: 38px; border-radius: 6px; flex-shrink: 0; display: flex; flex-direction: column; justify-content: space-between; padding: 4px 5px; font-family: inherit; position: relative; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
.card-mini::before { content: ''; position: absolute; top: -8px; right: -8px; width: 24px; height: 24px; border-radius: 50%; background: rgba(255,255,255,0.12); }
.card-mini .cm-bank { font-size: 0.36rem; color: #ffffffcc; font-weight: 700; letter-spacing: 0.03em; text-transform: uppercase; line-height: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.card-mini .cm-name { font-size: 0.32rem; color: #ffffffaa; line-height: 1.1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.card-mini .cm-chip { width: 7px; height: 5px; border-radius: 1px; background: linear-gradient(135deg, #fbbf24, #d97706); position: absolute; top: 9px; left: 5px; }
.card-mini .cm-net { font-size: 0.34rem; color: #ffffff99; font-weight: 600; text-align: right; line-height: 1; }

/* ====== Suggestions ====== */
.suggest-section { margin-top: 30px; padding-top: 24px; border-top: 2px solid var(--border); }
.suggest-header { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; }
.suggest-header h3 { font-size: 0.92rem; color: var(--text-1); margin: 0; font-weight: 700; }
.suggest-header .suggest-badge { background: #e87d2f10; color: var(--orange); font-size: 0.66rem; font-weight: 700; padding: 3px 10px; border-radius: var(--r-pill); border: 1px solid #e87d2f20; text-transform: uppercase; letter-spacing: 0.04em; }
.suggest-card { background: var(--bg-card); border-radius: var(--r); padding: 16px 18px; margin-bottom: 8px; border: 1px solid var(--border); display: flex; align-items: center; gap: 14px; transition: all var(--dur) var(--ease); box-shadow: var(--shadow); }
.suggest-card:hover { box-shadow: var(--shadow-lg); transform: translateY(-1px); }
.suggest-card .card-visual-lg { width: 86px; height: 54px; border-radius: 8px; flex-shrink: 0; display: flex; flex-direction: column; justify-content: space-between; padding: 5px 7px; position: relative; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
.suggest-card .card-visual-lg::before { content: ''; position: absolute; top: -12px; right: -12px; width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.12); }
.suggest-card .card-visual-lg .cv-bank { font-size: 0.5rem; color: #ffffffcc; font-weight: 700; letter-spacing: 0.03em; text-transform: uppercase; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.suggest-card .card-visual-lg .cv-name { font-size: 0.44rem; color: #ffffffaa; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.suggest-card .card-visual-lg .cv-chip { width: 10px; height: 7px; border-radius: 1px; background: linear-gradient(135deg, #fbbf24, #d97706); position: absolute; top: 12px; left: 7px; }
.suggest-card .card-visual-lg .cv-net { font-size: 0.46rem; color: #ffffff88; font-weight: 600; text-align: right; }
.suggest-body { flex: 1; min-width: 0; }
.suggest-body .sb-name { font-weight: 700; font-size: 0.92rem; color: var(--text-1); letter-spacing: -0.01em; }
.suggest-body .sb-bank { font-size: 0.78rem; color: var(--text-3); }
.suggest-body .sb-rates { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 6px; }
.suggest-body .sb-tag { background: var(--bg-inset); padding: 3px 9px; border-radius: var(--r-pill); font-size: 0.7rem; color: var(--text-2); border: 1px solid var(--border); }
.suggest-body .sb-tag.best { background: var(--green-dim); color: var(--green); border-color: var(--green-border); font-weight: 600; }
.suggest-body .sb-fee { font-size: 0.72rem; color: var(--text-3); margin-top: 4px; }
.suggest-reward { text-align: right; flex-shrink: 0; margin-left: 8px; }
.suggest-reward .sr-amount { font-size: 1.15rem; font-weight: 800; color: var(--orange); letter-spacing: -0.02em; }
.suggest-reward .sr-label { font-size: 0.7rem; color: var(--text-3); }
.suggest-reward .sr-extra { font-size: 0.72rem; color: var(--green); font-weight: 700; }

/* ====== Fuel Surcharge Calculator ====== */
.fuel-header h3 { font-size: 1.05rem; font-weight: 800; color: var(--text-1); margin-bottom: 4px; letter-spacing: -0.02em; }
.fuel-header p { font-size: 0.82rem; color: var(--text-3); margin-bottom: 18px; line-height: 1.5; }
.fuel-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.fuel-field label { margin-top: 0; }
.fuel-info-row { display: flex; align-items: center; flex-wrap: wrap; gap: 4px; margin-top: 14px; font-size: 0.82rem; }
.fuel-info-label { color: var(--text-3); font-weight: 500; }
.fuel-info-value { color: var(--text-1); font-weight: 700; }
.fuel-info-value.fuel-loss { color: var(--red); }

.fuel-result-section { margin-top: 20px; }
.fuel-result-section h4 { font-size: 0.84rem; font-weight: 700; color: var(--text-2); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.04em; }
.fuel-card-row { background: var(--bg-card); border-radius: var(--r); padding: 16px 18px; margin-bottom: 8px; border: 1px solid var(--border); display: flex; align-items: center; gap: 14px; transition: all var(--dur) var(--ease); box-shadow: var(--shadow); }
.fuel-card-row:hover { box-shadow: var(--shadow-lg); transform: translateY(-1px); }
.fuel-card-row.fuel-best { border-left: 4px solid var(--green); background: var(--green-dim); }
.fuel-card-row.fuel-yours { border-left: 4px solid var(--accent); }
.fuel-card-info { flex: 1; min-width: 0; }
.fuel-card-info .fc-name { font-weight: 700; font-size: 0.92rem; color: var(--text-1); letter-spacing: -0.01em; }
.fuel-card-info .fc-bank { font-size: 0.76rem; color: var(--text-3); }
.fuel-card-info .fc-conditions { font-size: 0.72rem; color: var(--text-3); margin-top: 4px; }
.fuel-card-info .fc-yours-tag { display: inline-block; background: var(--accent-dim); color: var(--accent); font-size: 0.62rem; font-weight: 700; padding: 2px 8px; border-radius: var(--r-pill); margin-left: 6px; vertical-align: middle; text-transform: uppercase; letter-spacing: 0.03em; }
.fuel-card-savings { text-align: right; flex-shrink: 0; }
.fuel-card-savings .fc-amount { font-size: 1.15rem; font-weight: 800; color: var(--green); letter-spacing: -0.02em; }
.fuel-card-savings .fc-label { font-size: 0.68rem; color: var(--text-3); }
.fuel-card-details { display: flex; gap: 10px; margin-top: 8px; flex-wrap: wrap; }
.fuel-detail-tag { background: var(--bg-inset); padding: 3px 9px; border-radius: var(--r-pill); font-size: 0.68rem; color: var(--text-2); border: 1px solid var(--border); }
.fuel-detail-tag span { font-weight: 700; }
.fuel-detail-tag.savings span { color: var(--green); }
.fuel-detail-tag.reward span { color: var(--accent); }
.fuel-no-waiver { text-align: center; padding: 20px; color: var(--text-3); font-size: 0.84rem; }
.fuel-explainer { background: var(--bg-inset); border: 1px solid var(--border); border-radius: var(--r-sm); padding: 14px 16px; margin-top: 16px; }
.fuel-explainer h5 { font-size: 0.78rem; font-weight: 700; color: var(--text-2); margin-bottom: 6px; }
.fuel-explainer p { font-size: 0.74rem; color: var(--text-3); line-height: 1.5; margin-bottom: 4px; }
.fuel-explainer p:last-child { margin-bottom: 0; }
.fuel-summary-bar { display: flex; gap: 10px; margin-bottom: 16px; flex-wrap: wrap; }
.fuel-summary-stat { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--r-sm); padding: 14px 16px; flex: 1; min-width: 120px; box-shadow: var(--shadow); }
.fuel-summary-stat .fss-label { font-size: 0.66rem; color: var(--text-3); text-transform: uppercase; letter-spacing: 0.04em; font-weight: 600; }
.fuel-summary-stat .fss-value { font-size: 1.2rem; font-weight: 800; margin-top: 4px; letter-spacing: -0.02em; }
.fuel-summary-stat .fss-value.loss { color: var(--red); }
.fuel-summary-stat .fss-value.save { color: var(--green); }
.fuel-summary-stat .fss-value.neutral { color: var(--text-1); }
.fuel-summary-stat .fss-sub { font-size: 0.68rem; color: var(--text-3); margin-top: 2px; }
@media(max-width:640px) {
  .fuel-inputs { grid-template-columns: 1fr; }
  .fuel-info-row { flex-direction: column; align-items: flex-start; gap: 2px; }
  .fuel-info-row span[style] { margin-left: 0 !important; }
  .fuel-summary-bar { flex-direction: column; }
}

/* ====== Footer ====== */
.app-footer { text-align: center; padding: 32px 0 36px; }
.app-footer .footer-links { display: flex; align-items: center; justify-content: center; gap: 12px; flex-wrap: wrap; margin-bottom: 14px; }
.btn-coffee { display: inline-flex; align-items: center; gap: 6px; background: var(--bg-card); color: var(--yellow); font-weight: 700; font-size: 0.8rem; padding: 10px 20px; border-radius: var(--r-pill); text-decoration: none; transition: all var(--dur) var(--ease); border: 1px solid var(--border); box-shadow: var(--shadow); }
.btn-coffee:hover { box-shadow: var(--shadow-lg); transform: translateY(-1px); }
.db-status-bar { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; justify-content: center; font-size: 0.72rem; color: var(--text-3); margin-top: 12px; }
.db-status-bar .db-refresh { background: transparent; color: var(--accent); border: 1px solid var(--border); border-radius: var(--r-pill); padding: 4px 12px; cursor: pointer; font-size: 0.7rem; font-weight: 700; transition: all var(--dur) var(--ease); font-family: inherit; }
.db-status-bar .db-refresh:hover { border-color: var(--accent); background: var(--accent-dim); }
.data-source { text-align: center; font-size: 0.7rem; color: var(--text-3); padding: 12px 0; }
.data-source a { color: var(--accent); text-decoration: none; }
.data-source a:hover { text-decoration: underline; }

/* ====== Responsive ====== */
@media(max-width:640px) {
  .container { padding: 0 16px 20px; }
  h1 { font-size: 1.8rem; }
  .compare-row { flex-direction: column; gap: 10px; }
  .compare-row .field, .compare-row .field-sm { flex: none; min-width: 0; width: 100%; }
  .route-header { flex-wrap: wrap; gap: 8px; }
  .suggest-card { flex-wrap: wrap; gap: 10px; }
  .suggest-reward { text-align: left; margin-left: 0; }
  .rec-grid { grid-template-columns: 1fr 1fr; gap: 8px; }
  .rec-stat { min-width: 80px; }
}
</style>
</head>
<body>

<div class="container">
  <div class="app-header">
    <h1>CardPick</h1>
    <p class="subtitle">Find the best credit card for every purchase</p>
  </div>

  <div class="tabs">
    <div class="tab active" data-panel="compare"><span class="tab-icon">&#9878;</span><span class="tab-label">Compare</span></div>
    <div class="tab" data-panel="recommend"><span class="tab-icon">&#9733;</span><span class="tab-label">Recommend</span></div>
    <div class="tab" data-panel="tracker"><span class="tab-icon">&#9636;</span><span class="tab-label">Tracker</span></div>
    <div class="tab" data-panel="fuel"><span class="tab-icon">&#9981;</span><span class="tab-label">Fuel</span></div>
    <div class="tab" data-panel="mycards"><span class="tab-icon">&#128179;</span><span class="tab-label">My Cards</span></div>
  </div>

  <!-- COMPARE PANEL -->
  <div class="panel active" id="panel-compare">
    <div class="compare-box">
      <div class="compare-row">
        <div class="field">
          <label for="inp-purchase">What are you paying for?</label>
          <select id="inp-purchase"></select>
        </div>
        <div class="field-sm">
          <label for="inp-network">Card Network</label>
          <select id="inp-network">
            <option value="all" selected>All Cards</option>
            <option value="Visa">Visa</option>
            <option value="Mastercard">Mastercard</option>
            <option value="RuPay">RuPay</option>
            <option value="Amex">Amex</option>
            <option value="Diners">Diners Club</option>
          </select>
        </div>
        <div class="field-sm">
          <label for="inp-amount">Amount (&#8377;)</label>
          <input type="number" id="inp-amount" placeholder="1000" min="0" step="any">
        </div>
        <div style="padding-bottom:2px;">
          <button class="btn btn-primary" onclick="compare()">Find Best Route</button>
        </div>
      </div>
      <div class="fee-toggle">
        <input type="checkbox" id="inp-fee-adjust">
        <label for="inp-fee-adjust">Deduct annual fee (spread monthly) from rewards</label>
      </div>
    </div>
    <div id="share-bar" style="display:none;text-align:right;margin-bottom:8px;">
      <button class="btn-share" onclick="shareResults()">&#128279; Share Results</button>
    </div>
    <div class="results" id="results"></div>
  </div>

  <!-- RECOMMEND PANEL -->
  <div class="panel" id="panel-recommend">
    <div class="compare-box">
      <h3 style="font-size:1rem;color:var(--text-1);margin-bottom:4px;">What's your monthly spending?</h3>
      <p style="font-size:0.78rem;color:var(--text-3);margin-bottom:14px;">Enter approximate monthly spend per category. We'll find the best card for you.</p>
      <div class="rec-grid">
        <div class="rec-field"><label>Dining (&#8377;/mo)</label><input type="number" id="rec-dining" placeholder="0" min="0"></div>
        <div class="rec-field"><label>Groceries (&#8377;/mo)</label><input type="number" id="rec-groceries" placeholder="0" min="0"></div>
        <div class="rec-field"><label>Fuel (&#8377;/mo)</label><input type="number" id="rec-fuel" placeholder="0" min="0"></div>
        <div class="rec-field"><label>Travel (&#8377;/mo)</label><input type="number" id="rec-travel" placeholder="0" min="0"></div>
        <div class="rec-field"><label>Online Shopping (&#8377;/mo)</label><input type="number" id="rec-online" placeholder="0" min="0"></div>
        <div class="rec-field"><label>Entertainment (&#8377;/mo)</label><input type="number" id="rec-entertainment" placeholder="0" min="0"></div>
        <div class="rec-field"><label>Utilities (&#8377;/mo)</label><input type="number" id="rec-utilities" placeholder="0" min="0"></div>
        <div class="rec-field"><label>General / Other (&#8377;/mo)</label><input type="number" id="rec-general" placeholder="0" min="0"></div>
      </div>
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
        <button class="btn btn-primary" onclick="recommendCard()">Find Best Card</button>
        <div class="fee-toggle" style="margin-top:0;">
          <input type="checkbox" id="rec-fee-adjust" checked>
          <label for="rec-fee-adjust">Factor in annual fee</label>
        </div>
      </div>
    </div>
    <div id="rec-results"></div>
  </div>

  <!-- TRACKER PANEL -->
  <div class="panel" id="panel-tracker">
    <div class="compare-box">
      <h3 style="font-size:1rem;color:var(--text-1);margin-bottom:4px;">Monthly Spend Tracker</h3>
      <p style="font-size:0.78rem;color:var(--text-3);margin-bottom:14px;">Log your actual spending to see how much you're earning vs. how much you could earn with optimal routes.</p>
      <div class="tracker-month">
        <label for="trk-month" style="margin:0;white-space:nowrap;">Month:</label>
        <input type="month" id="trk-month" style="width:auto;">
      </div>
      <div class="tracker-grid">
        <div class="tracker-field"><label>Dining (&#8377;)</label><input type="number" id="trk-dining" placeholder="0" min="0"></div>
        <div class="tracker-field"><label>Groceries (&#8377;)</label><input type="number" id="trk-groceries" placeholder="0" min="0"></div>
        <div class="tracker-field"><label>Fuel (&#8377;)</label><input type="number" id="trk-fuel" placeholder="0" min="0"></div>
        <div class="tracker-field"><label>Travel (&#8377;)</label><input type="number" id="trk-travel" placeholder="0" min="0"></div>
        <div class="tracker-field"><label>Online Shopping (&#8377;)</label><input type="number" id="trk-online" placeholder="0" min="0"></div>
        <div class="tracker-field"><label>Entertainment (&#8377;)</label><input type="number" id="trk-entertainment" placeholder="0" min="0"></div>
        <div class="tracker-field"><label>Utilities (&#8377;)</label><input type="number" id="trk-utilities" placeholder="0" min="0"></div>
        <div class="tracker-field"><label>General / Other (&#8377;)</label><input type="number" id="trk-general" placeholder="0" min="0"></div>
      </div>
      <div style="display:flex;gap:10px;">
        <button class="btn btn-primary" onclick="saveTrackerMonth()">Save Month</button>
        <button class="btn btn-secondary" onclick="analyzeTracker()">Analyze</button>
      </div>
    </div>
    <div id="tracker-results"></div>
    <div id="tracker-history"></div>
  </div>

  <!-- FUEL SURCHARGE CALCULATOR PANEL -->
  <div class="panel" id="panel-fuel">
    <div class="compare-box">
      <div class="fuel-header">
        <h3>Fuel Surcharge Calculator</h3>
        <p>Credit cards charge ~1% surcharge + GST on fuel transactions at petrol pumps. Many cards waive this. See how much you can save.</p>
      </div>
      <div class="fuel-inputs">
        <div class="fuel-field">
          <label for="fuel-monthly">Monthly Fuel Spend (&#8377;)</label>
          <input type="number" id="fuel-monthly" placeholder="e.g. 5000" min="0">
        </div>
        <div class="fuel-field">
          <label for="fuel-per-txn">Avg. Per Fill-up (&#8377;)</label>
          <input type="number" id="fuel-per-txn" placeholder="e.g. 2000" min="0">
        </div>
      </div>
      <div class="fuel-info-row">
        <span class="fuel-info-label">Transactions/month:</span>
        <span class="fuel-info-value" id="fuel-txn-count">--</span>
        <span class="fuel-info-label" style="margin-left:16px;">Surcharge without waiver:</span>
        <span class="fuel-info-value fuel-loss" id="fuel-total-surcharge">--</span>
      </div>
      <button class="btn btn-primary" onclick="calcFuelSurcharge()" style="margin-top:16px;">Calculate Savings</button>
    </div>
    <div id="fuel-results"></div>
  </div>

  <!-- MY CARDS PANEL -->
  <div class="panel" id="panel-mycards">
    <div class="io-bar">
      <button class="btn-io" onclick="exportCards()">&#11147; Export Cards</button>
      <button class="btn-io" onclick="document.getElementById('import-file').click()">&#11149; Import Cards</button>
      <input type="file" id="import-file" accept=".json" style="display:none" onchange="importCards(event)">
    </div>
    <div id="cards-list"></div>
    <button class="btn-add" onclick="openModal()">+ Add Credit Card</button>
  </div>
</div>

<!-- ADD/EDIT CARD MODAL -->
<div class="modal-overlay" id="modal">
  <div class="modal">
    <h2 id="modal-title">Add Credit Card</h2>

    <label>Search & Select Your Card</label>
    <div class="search-wrap" id="card-search-wrap">
      <span class="search-icon">&#128269;</span>
      <input type="text" id="card-search" placeholder="Type card name... e.g. HDFC Regalia, SBI Cashback" autocomplete="off">
      <div class="search-dropdown" id="card-dropdown"></div>
    </div>
    <span class="manual-link" id="manual-toggle" onclick="toggleManualFields(true)">or enter details manually</span>

    <div id="manual-fields" style="display:none;">
      <label for="m-name">Card Name</label>
      <input type="text" id="m-name" placeholder="e.g. HDFC Regalia Gold">

      <label for="m-network">Network</label>
      <select id="m-network">
        <option value="Visa">Visa</option>
        <option value="Mastercard">Mastercard</option>
        <option value="RuPay">RuPay</option>
        <option value="Amex">Amex</option>
        <option value="Diners">Diners Club</option>
        <option value="Other">Other</option>
      </select>

      <label>Card Color</label>
      <div class="color-options" id="m-colors"></div>

      <div class="category-rates">
        <h3>Effective Cashback % by Category</h3>
        <p>All rates are in effective return %. For points cards, this is already converted to cash value.</p>
        <div id="m-rates"></div>
      </div>

      <div class="fee-section">
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;margin-top:16px;">
          <input type="checkbox" id="m-ltf" style="width:auto;accent-color:var(--green);cursor:pointer;" onchange="toggleFeeFields()">
          <span style="font-size:0.95rem;color:var(--green);font-weight:600;">Lifetime Free (LTF)</span>
        </label>
        <div id="fee-fields">
          <label for="m-joining-fee">Joining Fee (&#8377;)</label>
          <input type="number" id="m-joining-fee" placeholder="0" min="0" step="any">
          <label for="m-annual-fee">Annual Fee (&#8377;)</label>
          <input type="number" id="m-annual-fee" placeholder="0" min="0" step="any">
        </div>
      </div>

      <label for="m-cap">Monthly Reward Cap &#8377; (0 = no cap)</label>
      <input type="number" id="m-cap" placeholder="0" min="0" step="any">

      <label for="m-notes">Notes</label>
      <input type="text" id="m-notes" placeholder="Any special conditions...">
    </div>

    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" id="modal-save" onclick="saveCard()">Add Card</button>
    </div>
  </div>
</div>

<!-- Google AdSense Ad Unit — Replace data-ad-slot with your ad slot ID after approval -->
<div style="text-align:center;padding:16px 0 4px;max-width:900px;margin:0 auto;">
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-XXXXXXXXXXXXXXXX"
       data-ad-slot="XXXXXXXXXX"
       data-ad-format="auto"
       data-full-width-responsive="true"></ins>
  <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>

<div class="app-footer">
  <div class="footer-links">
    <a href="https://buymeacoffee.com/rinzleross" target="_blank" rel="noopener noreferrer" class="btn-coffee">&#9749; Buy me a coffee</a>
  </div>
  <div class="db-status-bar">
    <span id="db-status">Loading card database&hellip;</span>
    <button class="db-refresh" onclick="refreshCardDB()">Check for Updates</button>
  </div>
</div>

<script>
// ===================== CATEGORIES =====================
const CATEGORIES = [
  { key: 'dining',        label: 'Dining / Restaurants' },
  { key: 'groceries',     label: 'Groceries' },
  { key: 'fuel',          label: 'Fuel / Gas' },
  { key: 'travel',        label: 'Travel / Hotels / Flights' },
  { key: 'online',        label: 'Online Shopping' },
  { key: 'entertainment', label: 'Entertainment / Streaming' },
  { key: 'utilities',     label: 'Utilities / Bills' },
  { key: 'general',       label: 'General / Other' },
];

const COLORS = ['#3b82f6','#8b5cf6','#ec4899','#f97316','#22c55e','#ef4444','#14b8a6','#eab308'];

// ===================== PURCHASE TYPES =====================
const PURCHASE_TYPES = [
  { key:'mobile_recharge', label:'Mobile Recharge', group:'Bills & Recharges', directCat:'utilities' },
  { key:'electricity_bill', label:'Electricity Bill', group:'Bills & Recharges', directCat:'utilities' },
  { key:'dth_recharge', label:'DTH Recharge', group:'Bills & Recharges', directCat:'utilities' },
  { key:'broadband_bill', label:'Broadband / WiFi Bill', group:'Bills & Recharges', directCat:'utilities' },
  { key:'water_bill', label:'Water Bill', group:'Bills & Recharges', directCat:'utilities' },
  { key:'lpg_cylinder', label:'LPG Gas Cylinder', group:'Bills & Recharges', directCat:'utilities' },
  { key:'fastag_recharge', label:'FASTag Recharge', group:'Bills & Recharges', directCat:'utilities' },
  { key:'insurance_premium', label:'Insurance Premium', group:'Bills & Recharges', directCat:'utilities' },

  { key:'amazon_shopping', label:'Amazon Shopping', group:'Online Shopping', directCat:'online' },
  { key:'flipkart_shopping', label:'Flipkart Shopping', group:'Online Shopping', directCat:'online' },
  { key:'myntra_shopping', label:'Myntra Shopping', group:'Online Shopping', directCat:'online' },
  { key:'nykaa_shopping', label:'Nykaa Shopping', group:'Online Shopping', directCat:'online' },
  { key:'croma_shopping', label:'Croma Electronics', group:'Online Shopping', directCat:'online' },
  { key:'other_online', label:'Other Online Shopping', group:'Online Shopping', directCat:'online' },

  { key:'food_swiggy', label:'Swiggy (Food Delivery)', group:'Food & Groceries', directCat:'dining' },
  { key:'food_zomato', label:'Zomato (Food Delivery)', group:'Food & Groceries', directCat:'dining' },
  { key:'swiggy_instamart', label:'Swiggy Instamart (Groceries)', group:'Food & Groceries', directCat:'groceries' },
  { key:'restaurant', label:'Restaurant (Dine Out)', group:'Food & Groceries', directCat:'dining' },
  { key:'grocery_bigbasket', label:'BigBasket (Groceries)', group:'Food & Groceries', directCat:'groceries' },
  { key:'grocery_blinkit', label:'Blinkit / Zepto', group:'Food & Groceries', directCat:'groceries' },
  { key:'grocery_offline', label:'Grocery Store (Offline)', group:'Food & Groceries', directCat:'groceries' },

  { key:'flight_booking', label:'Flight Booking', group:'Travel', directCat:'travel' },
  { key:'hotel_booking', label:'Hotel Booking', group:'Travel', directCat:'travel' },
  { key:'train_irctc', label:'Train Ticket (IRCTC)', group:'Travel', directCat:'travel' },
  { key:'cab_ride', label:'Cab / Auto (Uber/Ola)', group:'Travel', directCat:'travel' },
  { key:'bus_booking', label:'Bus Ticket (RedBus)', group:'Travel', directCat:'travel' },

  { key:'fuel_indianoil', label:'Fuel - IndianOil', group:'Fuel', directCat:'fuel_indianoil' },
  { key:'fuel_hpcl', label:'Fuel - HP', group:'Fuel', directCat:'fuel_hpcl' },
  { key:'fuel_bpcl', label:'Fuel - BPCL', group:'Fuel', directCat:'fuel_bpcl' },

  { key:'movie_tickets', label:'Movie Tickets (BookMyShow/PVR)', group:'Entertainment', directCat:'entertainment' },
  { key:'ott_subscription', label:'OTT Subscription', group:'Entertainment', directCat:'entertainment' },

  { key:'rent_payment', label:'Rent Payment', group:'General', directCat:'general' },
  { key:'general_purchase', label:'General / Other', group:'General', directCat:'general' },
];

// ===================== CARD DATABASE =====================
// All rates are EFFECTIVE CASHBACK % (points already converted to ₹ value)
// Sources: Paisabazaar, BankBazaar, CardExpert, TechnoFino, official bank T&Cs (Feb 2026)
const CARD_DB = [
  // ==================== HDFC BANK ====================
  { id:'hdfc-infinia', name:'HDFC Infinia', bank:'HDFC Bank', network:'Visa', color:'#1e293b', joiningFee:12500, annualFee:12500, monthlyCap:0,
    rates:{dining:3.33,groceries:3.33,fuel:0,travel:3.33,online:3.33,entertainment:3.33,utilities:3.33,general:3.33},
    notes:'5 RP/₹150. 1 RP=₹1 via SmartBuy. 10x on SmartBuy (cap 15,000 bonus RP/mo, 25,000 total/statement, valid till Mar 2026). RP redemption max 5x/mo (from Feb 2026). Invite-only. Unlimited lounge. No fuel/wallet/rent.' },
  { id:'hdfc-diners-black', name:'HDFC Diners Club Black', bank:'HDFC Bank', network:'Diners', color:'#1e293b', joiningFee:10000, annualFee:10000, monthlyCap:0,
    rates:{dining:3.33,groceries:3.33,fuel:0,travel:3.33,online:3.33,entertainment:3.33,utilities:3.33,general:3.33},
    notes:'5 RP/₹150. 1 RP=₹1 via SmartBuy. 10x on SmartBuy (cap 15,000 bonus RP/mo, 25,000 total/statement). Welcome: Club Marriott + Swiggy One + Amazon Prime on ₹1.5L in 90 days. Monthly milestone: 2x ₹500 vouchers on ₹80K/mo spend. 10,000 Bonus RP on ₹4L/qtr. Unlimited lounge (1,300+). 6 golf/qtr. Fee waived on ₹8L spend. No fuel/wallet/rent.' },
  { id:'hdfc-regalia', name:'HDFC Regalia', bank:'HDFC Bank', network:'Visa', color:'#8b5cf6', joiningFee:2500, annualFee:2500, monthlyCap:0,
    rates:{dining:1.33,groceries:1.33,fuel:0,travel:1.33,online:1.33,entertainment:1.33,utilities:1.33,general:1.33},
    notes:'4 RP/₹150. 1 RP=₹0.50 SmartBuy. Up to 5x on SmartBuy. 7.5% dining discount via Swiggy Dineout (Good Food Trail). 24x7 concierge. 15,000 bonus RP milestone. No fuel/wallet/rent.' },
  { id:'hdfc-regalia-gold', name:'HDFC Regalia Gold', bank:'HDFC Bank', network:'Visa', color:'#eab308', joiningFee:2500, annualFee:2500, monthlyCap:0,
    rates:{dining:1.33,groceries:1.33,fuel:0,travel:1.33,online:6.67,entertainment:1.33,utilities:1.33,general:1.33},
    notes:'4 RP/₹150 base. 20 RP/₹150 (5x) on Nykaa, Myntra, M&S, Reliance Digital. 1 RP=₹0.50. Complimentary Swiggy One + MMT Black Gold membership. ₹1,500 voucher on ₹1.5L/qtr. ₹5,000 on ₹5L/yr. No fuel/wallet/rent.' },
  { id:'hdfc-regalia-first', name:'HDFC Regalia First', bank:'HDFC Bank', network:'Visa', color:'#8b5cf6', joiningFee:1000, annualFee:1000, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:1,online:1,entertainment:1,utilities:1,general:1},
    notes:'3 RP/₹150 (w.e.f. Sep 2024). 1 RP=₹0.50 (=1% effective). Bonus 7,500 RP on ₹6L + 5,000 on ₹9L/yr. 20% off dining via Swiggy Dineout. Renewal fee waived on ₹1L/yr. No fuel/wallet/EMI.', discontinued:true, discontinuedNote:'HDFC Bank stopped sourcing Regalia First. Replaced by HDFC Regalia Gold. Existing cards continue.' },
  { id:'hdfc-millennia', name:'HDFC Millennia', bank:'HDFC Bank', network:'Visa', color:'#3b82f6', joiningFee:1000, annualFee:1000, monthlyCap:0,
    rates:{dining:5,groceries:1,fuel:0,travel:1,online:5,entertainment:1,utilities:1,general:1},
    notes:'5% CashBack on Amazon, Flipkart, Myntra, Tata CLiQ, Swiggy, Zomato, Uber, BookMyShow, Sony LIV, Cult.fit, BigBasket. 1% others. ₹1,000 voucher or lounge on ₹1L spend/qtr. No fuel/wallet/rent.' },
  { id:'hdfc-moneyback-plus', name:'HDFC MoneyBack+', bank:'HDFC Bank', network:'Visa', color:'#14b8a6', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:5,groceries:1,fuel:0,travel:1,online:5,entertainment:1,utilities:1,general:1},
    notes:'10x CashPoints on Amazon, Flipkart, Swiggy, BigBasket (~5%). 2 CP/₹150 on others (~1%). Max 2,500 CP/mo. No fuel/wallet/rent.' },
  { id:'hdfc-swiggy', name:'HDFC Swiggy', bank:'HDFC Bank', network:'Visa', color:'#f97316', joiningFee:500, annualFee:500, monthlyCap:3500,
    rates:{dining:10,groceries:5,fuel:0,travel:1,online:5,entertainment:1,utilities:1,general:1},
    notes:'10% Swiggy (food/Instamart/Dineout) cap ₹1,500/mo. 5% select online cap ₹1,500/mo. 1% others cap ₹500/mo. Total cap ₹3,500/mo.', discontinued:true, discontinuedNote:'HDFC Bank stopped new issuance of Swiggy HDFC Credit Card from 10 Feb 2026. Existing cards continue to work.' },
  { id:'hdfc-tata-neu-infinity', name:'HDFC Tata Neu Infinity', bank:'HDFC Bank', network:'Visa', color:'#8b5cf6', joiningFee:1499, annualFee:1499, monthlyCap:0,
    rates:{dining:1.5,groceries:1.5,fuel:0,travel:1.5,online:5,entertainment:1.5,utilities:1.5,general:1.5},
    notes:'5% NeuCoins on Tata ecosystem (BigBasket, Croma, 1mg, Westside, Taj etc). 1.5% others. Cap 2,000 NeuCoins/mo per category. No fuel/wallet/rent.' },
  { id:'hdfc-tata-neu-plus', name:'HDFC Tata Neu Plus', bank:'HDFC Bank', network:'Visa', color:'#8b5cf6', joiningFee:499, annualFee:499, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:1,online:2,entertainment:1,utilities:1,general:1},
    notes:'2% NeuCoins on Tata ecosystem. 1% on all other spends. Entry-level Tata co-brand. No fuel/wallet/rent.' },
  { id:'hdfc-diners-privilege', name:'HDFC Diners Club Privilege', bank:'HDFC Bank', network:'Diners', color:'#334155', joiningFee:2500, annualFee:2500, monthlyCap:0,
    rates:{dining:6.67,groceries:1.33,fuel:0,travel:1.33,online:1.33,entertainment:1.33,utilities:1.33,general:1.33},
    notes:'20 RP/₹150 on Swiggy & Zomato (=6.67%). 4 RP/₹150 base (=1.33%). 1 RP=₹0.50. BookMyShow BOGO: 2 free tickets/mo (Fri-Sun, max ₹250/ticket). Quarterly voucher (O2 Spa/Lakme) on ₹1.5L spend. Welcome: ₹500 voucher on ₹75K in 90 days. Fee waived on ₹3L spend. No fuel/wallet/rent.' },
  { id:'hdfc-indianoil', name:'HDFC IndianOil', bank:'HDFC Bank', network:'Visa', color:'#ef4444', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:0.64,groceries:5,fuel:5,travel:0.64,online:0.64,entertainment:0.64,utilities:5,general:0.64},
    notes:'5% Fuel Points at IndianOil, groceries & bills. 1 FP/₹150 on others (~0.64%). 1% fuel surcharge waiver.' },
  { id:'hdfc-bharat-cashback', name:'HDFC Bharat Cashback', bank:'HDFC Bank', network:'RuPay', color:'#22c55e', joiningFee:500, annualFee:500, monthlyCap:1000,
    rates:{dining:1,groceries:1,fuel:5,travel:1,online:1,entertainment:1,utilities:5,general:1},
    notes:'5% on fuel (all brands). 5% on utility/telecom. 1% others. Cap ₹1,000/mo. RuPay benefits apply.' },
  { id:'hdfc-pixel-play', name:'HDFC Pixel Play', bank:'HDFC Bank', network:'Visa', color:'#ec4899', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:5,groceries:1,fuel:0,travel:1,online:5,entertainment:1,utilities:1,general:1},
    notes:'Up to 5% cashback on select online merchants. 1% on others. Fully digital card via PayZapp. Lifetime Free. Customizable card design.' },
  { id:'hdfc-marriott-bonvoy', name:'Marriott Bonvoy HDFC Diners', bank:'HDFC Bank', network:'Diners', color:'#8b5cf6', joiningFee:3000, annualFee:3000, monthlyCap:0,
    rates:{dining:1.33,groceries:1.33,fuel:0,travel:4,online:1.33,entertainment:1.33,utilities:1.33,general:1.33},
    notes:'8 Marriott Bonvoy points/₹150 on Marriott stays (~4% travel). 4 points/₹150 on others (~1.33%). First hotel co-brand in India.' },
  { id:'hdfc-6e-indigo', name:'6E Rewards HDFC IndiGo', bank:'HDFC Bank', network:'Diners', color:'#3b82f6', joiningFee:1500, annualFee:1500, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:3,online:1,entertainment:1,utilities:1,general:1},
    notes:'6E Rewards on IndiGo bookings (~3% travel). Base rewards on other spends. Good for frequent IndiGo flyers.' },
  { id:'hdfc-intermiles', name:'HDFC InterMiles Signature', bank:'HDFC Bank', network:'Visa', color:'#334155', joiningFee:2500, annualFee:2500, monthlyCap:0,
    rates:{dining:1.33,groceries:1.33,fuel:0,travel:3,online:1.33,entertainment:1.33,utilities:1.33,general:1.33},
    notes:'Accelerated InterMiles on travel (~3%). Base 4 RP/₹150 on others (~1.33%). Transfer to airline partners. 1% fuel surcharge waiver.' },
  { id:'hdfc-shoppers-stop', name:'HDFC Shoppers Stop', bank:'HDFC Bank', network:'Visa', color:'#ec4899', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:0.67,groceries:0.67,fuel:0,travel:0.67,online:0.67,entertainment:0.67,utilities:0.67,general:3},
    notes:'6 First Citizen points/₹150 at Shoppers Stop (~3%). 2 RP/₹150 on others (~0.67%). Best for Shoppers Stop regulars.' },
  { id:'hdfc-irctc-rupay', name:'HDFC IRCTC RuPay', bank:'HDFC Bank', network:'RuPay', color:'#ef4444', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'Up to 5% value back on IRCTC bookings. Base rewards on other spends. RuPay UPI benefits. For frequent train travelers.' },

  // ==================== SBI CARD ====================
  { id:'sbi-cashback', name:'SBI Cashback', bank:'SBI Card', network:'Visa', color:'#3b82f6', joiningFee:999, annualFee:999, monthlyCap:5000,
    rates:{dining:1,groceries:1,fuel:0,travel:5,online:5,entertainment:5,utilities:0,general:1},
    notes:'5% on online spends, 1% offline. Cap ₹5,000/statement. EXCLUDED: Utility bills, Insurance, Fuel, Rent, Wallet, Education, Jewellery, Railways — 0% on these even if paid online. Fee waived on ₹2L spend. Use Amazon GC route to bypass utility exclusion.' },
  { id:'sbi-elite', name:'SBI Card ELITE', bank:'SBI Card', network:'Visa', color:'#334155', joiningFee:4999, annualFee:4999, monthlyCap:0,
    rates:{dining:2.5,groceries:2.5,fuel:0,travel:0.5,online:0.5,entertainment:2.5,utilities:0.5,general:0.5},
    notes:'5x RP on dining, groceries, dept stores (~2.5%). 2 RP/₹100 base (~0.5%). 2 free movie tickets/mo via BookMyShow (worth ~₹500). Priority Pass lounge. Concierge (flowers, gifts, doctor). Welcome gift ₹5,000. Fee waived on ₹10L spend.' },
  { id:'sbi-prime', name:'SBI Card PRIME', bank:'SBI Card', network:'Visa', color:'#8b5cf6', joiningFee:2999, annualFee:2999, monthlyCap:0,
    rates:{dining:2.5,groceries:2.5,fuel:0,travel:0.5,online:0.5,entertainment:2.5,utilities:0.5,general:0.5},
    notes:'10 RP/₹100 on dining, groceries, movies (~2.5%). 2 RP/₹100 base (~0.5%). 20x RP on birthday (cap 2,000 RP). 4 golf rounds free + 50% off games + 1 lesson/mo. ITC Hotels membership (cards from Sep 2025). Welcome gift ₹3,000. Fee waived on ₹3L spend.' },
  { id:'sbi-simplyclick', name:'SBI SimplyCLICK', bank:'SBI Card', network:'Visa', color:'#8b5cf6', joiningFee:499, annualFee:499, monthlyCap:0,
    rates:{dining:0.25,groceries:0.25,fuel:0,travel:2.5,online:2.5,entertainment:2.5,utilities:0.25,general:0.25},
    notes:'10x RP on partners (Amazon, Apollo 24x7, BookMyShow, Cleartrip, Dominos, IGP, Myntra, Netmeds, Yatra) ~2.5%. 5x on other online ~1.25%. 1 RP/₹100 offline ~0.25%. Welcome: ₹500 Amazon GC. Fee waived on ₹1L spend.' },
  { id:'sbi-simplysave', name:'SBI SimplySAVE', bank:'SBI Card', network:'Visa', color:'#22c55e', joiningFee:499, annualFee:499, monthlyCap:0,
    rates:{dining:1.67,groceries:1.67,fuel:0,travel:0.17,online:0.17,entertainment:1.67,utilities:0.17,general:0.17},
    notes:'10 RP/₹150 on dining, groceries, movies, dept stores (~1.67%). 1 RP/₹150 on others (~0.17%). Good offline rewards card.' },
  { id:'sbi-bpcl-octane', name:'SBI BPCL Octane', bank:'SBI Card', network:'Visa', color:'#f97316', joiningFee:1499, annualFee:1499, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:7.25,travel:1,online:1,entertainment:1,utilities:1,general:1},
    notes:'Up to ₹7.25 back per ₹100 at BPCL pumps. 1% on others. 1% fuel surcharge waiver. Best fuel card for BPCL users.' },
  { id:'sbi-flipkart', name:'Flipkart SBI Card', bank:'SBI Card', network:'Visa', color:'#3b82f6', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:2.5,online:5,entertainment:1,utilities:1,general:1},
    notes:'5% on Flipkart/Myntra/Cleartrip. 2.5% on preferred partners. 1% on others. Fee waived on ₹3.5L spend. 1% fuel surcharge waiver.' },
  { id:'sbi-irctc-premier', name:'IRCTC SBI Card Premier', bank:'SBI Card', network:'Visa', color:'#ef4444', joiningFee:1500, annualFee:1500, monthlyCap:0,
    rates:{dining:0.2,groceries:0.2,fuel:0,travel:10,online:0.2,entertainment:0.2,utilities:0.2,general:0.2},
    notes:'10% value back on AC1/AC2/AC3/CC train bookings. 5% on air/catering via IRCTC. 1 RP/₹125 on others. Transaction charge waiver on IRCTC.' },
  { id:'sbi-phonepe-purple', name:'PhonePe SBI PURPLE', bank:'SBI Card', network:'RuPay', color:'#8b5cf6', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.25,groceries:0.25,fuel:0,travel:0.25,online:0.5,entertainment:0.25,utilities:0.75,general:0.25},
    notes:'3 RP/₹100 on PhonePe (~0.75%). 2 RP/₹100 online (~0.5%). 1 RP/₹100 others (~0.25%). Lifetime Free. UPI rewards via RuPay.' },
  { id:'sbi-titan', name:'Titan SBI Card', bank:'SBI Card', network:'Visa', color:'#eab308', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:1.5,groceries:1.5,fuel:0,travel:1.5,online:1.5,entertainment:1.5,utilities:1.5,general:7.5},
    notes:'7.5% cashback at World of Titan, Taneira, Fastrack, Sonata etc (cap ₹10K/qtr). 6 RP/₹100 on others (~1.5%). For Titan brand shoppers.' },
  { id:'sbi-aurum', name:'SBI Card AURUM', bank:'SBI Card', network:'Visa', color:'#eab308', joiningFee:9999, annualFee:9999, monthlyCap:0,
    rates:{dining:0.75,groceries:0.75,fuel:0,travel:3,online:0.75,entertainment:0.75,utilities:0.75,general:0.75},
    notes:'6 Travel Credits/₹200 on travel (~3%). 3 RP/₹200 on others (~0.75%). 5,000 Travel Credits welcome. Premium travel card.' },

  // ==================== ICICI BANK ====================
  { id:'icici-amazon-pay', name:'Amazon Pay ICICI', bank:'ICICI Bank', network:'Visa', color:'#f97316', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:1,online:5,entertainment:1,utilities:2,general:1},
    notes:'5% on Amazon (Prime), 3% (non-Prime). 2% on bill payments. 1% others. Lifetime Free. No fuel/wallet.' },
  { id:'icici-emeralde-private', name:'ICICI Emeralde Private Metal', bank:'ICICI Bank', network:'Visa', color:'#334155', joiningFee:20000, annualFee:20000, monthlyCap:0,
    rates:{dining:3,groceries:3,fuel:0,travel:3,online:3,entertainment:3,utilities:3,general:3},
    notes:'~3% reward rate. Unlimited domestic & international lounge. Unlimited golf. Up to 50% dining. No fuel/wallet/rent/gaming.' },
  { id:'icici-emeralde', name:'ICICI Emeralde', bank:'ICICI Bank', network:'Visa', color:'#22c55e', joiningFee:12000, annualFee:12000, monthlyCap:0,
    rates:{dining:1.5,groceries:1.5,fuel:0,travel:1.5,online:1.5,entertainment:1.5,utilities:1.5,general:1.5},
    notes:'~1.5% effective. Premium lounge access. Transport cap ₹20K/mo. 2% DCC markup. No fuel/wallet/rent/gaming.' },
  { id:'icici-sapphiro', name:'ICICI Sapphiro', bank:'ICICI Bank', network:'Visa', color:'#334155', joiningFee:3500, annualFee:3500, monthlyCap:0,
    rates:{dining:0.75,groceries:2,fuel:0,travel:0.75,online:0.75,entertainment:0.75,utilities:2,general:0.75},
    notes:'~0.75% base. ~2% on groceries & utilities. 6x-12x via iShop. 4,000 bonus RP on ₹4L spend. Fee waived on ₹6L spend. No fuel/wallet/rent/gaming.' },
  { id:'icici-rubyx', name:'ICICI Rubyx', bank:'ICICI Bank', network:'Visa', color:'#ef4444', joiningFee:3000, annualFee:3000, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:1,online:1,entertainment:1,utilities:1,general:0.5},
    notes:'2 RP/₹100 domestic (~1% with good redemption). 4 RP/₹100 international. Lounge access. Transport cap ₹20K/mo. No fuel/wallet/rent.' },
  { id:'icici-coral', name:'ICICI Coral', bank:'ICICI Bank', network:'Visa', color:'#ec4899', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:0.75,groceries:0.75,fuel:0,travel:0.75,online:0.75,entertainment:0.75,utilities:0.75,general:0.75},
    notes:'6 RP/₹200 (~0.75%). BOGO BookMyShow (₹25K spend in prior qtr). Transport cap ₹10K/mo. No fuel/wallet/rent/gaming.' },
  { id:'icici-platinum', name:'ICICI Platinum Chip', bank:'ICICI Bank', network:'Visa', color:'#94a3b8', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'Basic entry-level card. ~0.5% rewards. No joining/annual fee. Dining discounts. No fuel rewards.' },
  { id:'icici-hpcl-supersaver', name:'ICICI HPCL Super Saver', bank:'ICICI Bank', network:'Visa', color:'#f97316', joiningFee:499, annualFee:499, monthlyCap:0,
    rates:{dining:1,groceries:5,fuel:5,travel:1,online:1,entertainment:1,utilities:1,general:1},
    notes:'5% at HPCL pumps/HP Pay. 5% on groceries. 1% others. Best fuel card for HPCL users.' },
  { id:'icici-hpcl-coral', name:'ICICI HPCL Coral', bank:'ICICI Bank', network:'Visa', color:'#f97316', joiningFee:199, annualFee:199, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:2.5,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'2.5% discount on fuel at HPCL. 2 RP/₹100 on all spends (~0.5%). Entry-level fuel card ₹199 fee.' },
  { id:'icici-mmt', name:'MakeMyTrip ICICI', bank:'ICICI Bank', network:'Mastercard', color:'#ef4444', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:2,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'Up to 2 MyCash/₹100 on travel (~2%). Milestone MyCash benefits. ₹1,000 MakeMyTrip voucher on joining. No fuel rewards.' },

  // ==================== AXIS BANK ====================
  { id:'axis-magnus', name:'Axis Magnus', bank:'Axis Bank', network:'Visa', color:'#eab308', joiningFee:12500, annualFee:12500, monthlyCap:0,
    rates:{dining:1.2,groceries:1.2,fuel:0,travel:3.5,online:1.2,entertainment:1.2,utilities:1.2,general:1.2},
    notes:'12 EDGE pts/₹200 base (~1.2%). 25,000 bonus pts on ₹1L/mo spend. Up to 40% off dining at 4,000+ restaurants. Airport concierge across 29 cities. Unlimited domestic + international lounge. 2% forex. Fee waived on ₹25L spend.' },
  { id:'axis-reserve', name:'Axis Reserve', bank:'Axis Bank', network:'Visa', color:'#334155', joiningFee:50000, annualFee:50000, monthlyCap:0,
    rates:{dining:2,groceries:2,fuel:0,travel:4,online:2,entertainment:2,utilities:2,general:2},
    notes:'2x RP on international. ~4% on travel. ~2% base. 1.5% forex markup. Ultra-premium. Fee waived on ₹25L spend.' },
  { id:'axis-atlas', name:'Axis Atlas', bank:'Axis Bank', network:'Visa', color:'#334155', joiningFee:5000, annualFee:5000, monthlyCap:0,
    rates:{dining:1.5,groceries:1.5,fuel:0,travel:3.75,online:1.5,entertainment:1.5,utilities:1.5,general:1.5},
    notes:'5 EDGE Miles/₹100 on airlines & hotels (=3.75%). 2 Miles/₹100 others (=1.5%). 15+ airline transfer partners.', discontinued:true, discontinuedNote:'Axis Bank closed new Atlas applications from 31 Aug 2025. Replaced by Axis Olympus. Existing cards unaffected.' },
  { id:'axis-select', name:'Axis Select', bank:'Axis Bank', network:'Visa', color:'#8b5cf6', joiningFee:3000, annualFee:3000, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:1,online:1,entertainment:1,utilities:1,general:1},
    notes:'10,000 EDGE RP on activation. 6 complimentary golf rounds/yr. 5,000 RP on ₹3L spend milestone. ~1% base.' },
  { id:'axis-flipkart', name:'Axis Flipkart', bank:'Axis Bank', network:'Visa', color:'#3b82f6', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:4,groceries:1,fuel:0,travel:5,online:5,entertainment:1,utilities:0,general:1},
    notes:'7.5% Myntra (cap ₹4K/qtr). 5% Flipkart & Cleartrip (cap ₹4K/qtr). 4% Swiggy/Uber/PVR. 1% others. Welcome (Feb 2026): BMS ₹250 + Flipkart ₹250 voucher + 3-mo Myntra Insider on first txn in 30 days. No fuel/utility/rent.' },
  { id:'axis-flipkart-super-elite', name:'Axis Flipkart Super Elite', bank:'Axis Bank', network:'Visa', color:'#3b82f6', joiningFee:2500, annualFee:2500, monthlyCap:0,
    rates:{dining:2,groceries:2,fuel:0,travel:2,online:5,entertainment:2,utilities:0,general:2},
    notes:'Up to 12 SuperCoins/₹100 on Flipkart (Plus). 6 SC/₹100 non-Plus. 2 SC/₹100 others. ₹500 off Myntra. 15% off flights. Premium Flipkart co-brand.' },
  { id:'axis-ace', name:'Axis ACE', bank:'Axis Bank', network:'Visa', color:'#8b5cf6', joiningFee:499, annualFee:499, monthlyCap:0,
    rates:{dining:1.5,groceries:1.5,fuel:0,travel:1.5,online:1.5,entertainment:1.5,utilities:5,general:1.5},
    notes:'5% on utility bills (Google Pay, PhonePe, electricity, broadband). 1.5% others. Fee waived on ₹2L spend. No fuel rewards.' },
  { id:'axis-cashback', name:'Axis Cashback', bank:'Axis Bank', network:'Visa', color:'#22c55e', joiningFee:1000, annualFee:1000, monthlyCap:0,
    rates:{dining:0.75,groceries:0.75,fuel:0,travel:0.75,online:5,entertainment:0.75,utilities:0.5,general:0.75},
    notes:'2-7% cashback on online transactions (avg ~5%). 0.75% offline & travel. 0.5% on utilities. 5,000 EDGE RP welcome. Fee waived on ₹4L spend.' },
  { id:'axis-rewards', name:'Axis Rewards', bank:'Axis Bank', network:'Visa', color:'#22c55e', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:3.2,groceries:3.2,fuel:0,travel:0.4,online:0.4,entertainment:0.4,utilities:0,general:0.4},
    notes:'Up to 20 EDGE RP/₹125 on dining & grocery (10x = ~3.2%). 2 RP/₹125 base (~0.4%). 1,500 bonus RP monthly milestone. No fuel/utility.' },
  { id:'axis-airtel', name:'Axis Airtel', bank:'Axis Bank', network:'Visa', color:'#ef4444', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:10,groceries:10,fuel:0,travel:1,online:1,entertainment:1,utilities:10,general:1},
    notes:'25% on Airtel recharges. 10% on Swiggy/Zomato/BigBasket. 10% on utility bills via Airtel Thanks. 1% others.' },
  { id:'axis-myzone', name:'Axis MyZone', bank:'Axis Bank', network:'Visa', color:'#ec4899', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:4,groceries:0.4,fuel:0,travel:0.4,online:2,entertainment:0,utilities:0,general:0.4},
    notes:'0.4% base (4 EDGE RP/₹200 @ ₹0.20). 10x weekend dining partners (=4%). 5x weekend shopping (=2%). No RP on fuel/movies/utilities. BOGO movies. ₹120 off Swiggy. Often available as LTF.' },
  { id:'axis-horizon', name:'Axis Horizon (ex-Citi PremierMiles)', bank:'Axis Bank', network:'Visa', color:'#334155', joiningFee:3000, annualFee:3000, monthlyCap:0,
    rates:{dining:1.5,groceries:1.5,fuel:0,travel:3,online:1.5,entertainment:1.5,utilities:1.5,general:1.5},
    notes:'5,000 EDGE Miles welcome. Accelerated miles on travel (~3%). 2 miles/₹100 on others (~1.5%). Quarterly lounge access. Rebranded from Citi PremierMiles.' },
  { id:'axis-signature', name:'Axis Signature', bank:'Axis Bank', network:'Visa', color:'#8b5cf6', joiningFee:2000, annualFee:2000, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:2,online:1,entertainment:1,utilities:1,general:1},
    notes:'10 pts/₹200 domestic (~1%). 20 pts/₹200 international (~2%). 2 domestic lounge/qtr. Priority Pass. Insurance covers.' },
  { id:'axis-googlepay', name:'Axis Google Pay', bank:'Axis Bank', network:'Visa', color:'#22c55e', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:1,online:2,entertainment:1,utilities:2,general:1},
    notes:'Earn stars redeemable as cashback on Google Pay (1 star = ₹1). ~2% on online & bill payments. 15% off dining via EazyDiner. LTF variants available.' },
  { id:'indianoil-axis', name:'IndianOil Axis Bank', bank:'Axis Bank', network:'Visa', color:'#f97316', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:4.25,travel:1,online:1,entertainment:1,utilities:1,general:1},
    notes:'Up to 4.25% at IndianOil outlets. 1% others. 1% fuel surcharge waiver. Fee waived on ₹3.5L spend.' },

  // ==================== KOTAK MAHINDRA BANK ====================
  { id:'kotak-cashback-plus', name:'Kotak Cashback+', bank:'Kotak Bank', network:'Visa', color:'#3b82f6', joiningFee:750, annualFee:750, monthlyCap:500,
    rates:{dining:5,groceries:5,fuel:3,travel:0.5,online:0.5,entertainment:5,utilities:0,general:0.5},
    notes:'5% on online grocery, food delivery & entertainment. 3% on fuel (all brands). 0.5% on others. Cap 500 pts/cycle on accelerated categories. No utility/rent/insurance/wallet rewards. BOGO PVR.' },
  { id:'kotak-delight-platinum', name:'Kotak Delight Platinum', bank:'Kotak Bank', network:'Visa', color:'#ec4899', joiningFee:0, annualFee:0, monthlyCap:600,
    rates:{dining:10,groceries:1,fuel:0,travel:10,online:1,entertainment:10,utilities:1,general:1},
    notes:'Up to 10% on dining, travel & movies (cap ₹600/cycle for dining under ₹4K). 1% others. Lifetime Free.' },
  { id:'kotak-811', name:'Kotak 811 #DreamDifferent', bank:'Kotak Bank', network:'Visa', color:'#ef4444', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.3,groceries:0.3,fuel:0,travel:0.3,online:0.3,entertainment:0.3,utilities:0.3,general:0.3},
    notes:'3 RP/₹100 (1,000 RP = ₹100 → ~0.3%). Lifetime Free. Entry-level secured card. Min limit ₹5,000.' },
  { id:'kotak-urbane-gold', name:'Kotak Urbane Gold', bank:'Kotak Bank', network:'Visa', color:'#eab308', joiningFee:0, annualFee:199, monthlyCap:0,
    rates:{dining:0.3,groceries:0.3,fuel:0,travel:0.3,online:0.3,entertainment:0.3,utilities:0.3,general:0.3},
    notes:'3 RP/₹100 (1,000 RP = ₹100 → ~0.3%). 4 PVR tickets or 10,000 RP on ₹1L annual spend. 1% fuel surcharge waiver.' },
  { id:'kotak-league-platinum', name:'Kotak League Platinum', bank:'Kotak Bank', network:'Visa', color:'#8b5cf6', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.2,groceries:0.1,fuel:0,travel:0.1,online:0.2,entertainment:0.1,utilities:0.1,general:0.1},
    notes:'2 RP/₹100 online (~0.2%). 1 RP/₹100 others (~0.1%). 1% fuel surcharge waiver. Lifetime Free entry-level card.' },
  { id:'kotak-white', name:'Kotak White', bank:'Kotak Bank', network:'Visa', color:'#f1f5f9', joiningFee:3000, annualFee:3000, monthlyCap:0,
    rates:{dining:1.5,groceries:1.5,fuel:0,travel:1.5,online:1.5,entertainment:1.5,utilities:1.5,general:1.5},
    notes:'White Pass value redeemable for luxury brand vouchers (~1.5%). 8 domestic lounge visits/yr. 2% forex markup. Premium lifestyle card.' },
  { id:'kotak-privy-league', name:'Kotak Privy League Signature', bank:'Kotak Bank', network:'Visa', color:'#334155', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:1.33,groceries:1.33,fuel:0,travel:1.33,online:1.33,entertainment:1.33,utilities:1.33,general:1.33},
    notes:'8x RP/₹150 on special categories, 4x on others up to ₹2L, 8x on all above ₹2L (~1.33% avg). 2% forex markup on paid variant. Privy League customers.' },
  { id:'kotak-mojo', name:'Kotak Mojo', bank:'Kotak Bank', network:'Visa', color:'#ec4899', joiningFee:999, annualFee:999, monthlyCap:0,
    rates:{dining:0.25,groceries:0.25,fuel:0,travel:0.25,online:0.5,entertainment:0.25,utilities:0.25,general:0.25},
    notes:'2.5 Mojo pts/₹100 online (~0.5%). 1 Mojo pt/₹100 others (~0.25%). 8 domestic lounge/yr. Fee waived on ₹1L spend.' },
  { id:'kotak-myntra', name:'Kotak Myntra', bank:'Kotak Bank', network:'Visa', color:'#ec4899', joiningFee:599, annualFee:599, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:1,online:5,entertainment:1,utilities:1,general:1},
    notes:'Up to 5% cashback on Myntra. Welcome ₹500 Myntra voucher. Myntra Insider membership. 1% on others. Fee waived on spend threshold.', discontinued:true, discontinuedNote:'Kotak Myntra Card discontinued from 10 Jul 2025. Cardholders migrated to Kotak League Platinum or Zen Signature.' },
  { id:'kotak-indigo-xl', name:'Kotak IndiGo 6E Rewards XL Signature', bank:'Kotak Bank', network:'Visa', color:'#3b82f6', joiningFee:2500, annualFee:2500, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:3.5,online:1,entertainment:1,utilities:1,general:1},
    notes:'Up to 21 IndiGo BluChips/₹100 on IndiGo (~3.5% travel). IndiGo vouchers worth ₹16,000/yr. 8 lounge visits.' },
  { id:'kotak-indigo-platinum', name:'Kotak IndiGo 6E Rewards Platinum', bank:'Kotak Bank', network:'Visa', color:'#3b82f6', joiningFee:2500, annualFee:2500, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:2.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'Up to 19 IndiGo BluChips/₹100 on IndiGo (~2.5% travel). Welcome ticket ₹3,000. Priority boarding.' },
  { id:'kotak-silk-inspire', name:'Kotak Silk Inspire', bank:'Kotak Bank', network:'Visa', color:'#ec4899', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.3,groceries:0.3,fuel:0,travel:0.3,online:0.3,entertainment:0.3,utilities:0.3,general:0.3},
    notes:'Designed for women. ~0.3% rewards. Lifestyle privileges. Lifetime Free.' },
  { id:'kotak-indianoil', name:'Kotak IndianOil', bank:'Kotak Bank', network:'RuPay', color:'#f97316', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:4,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'Up to 4% fuel savings at IndianOil outlets. 0.5% on others. 1% fuel surcharge waiver.' },
  { id:'kotak-pvr', name:'PVR Kotak Platinum', bank:'Kotak Bank', network:'Visa', color:'#ef4444', joiningFee:499, annualFee:499, monthlyCap:0,
    rates:{dining:1,groceries:0.3,fuel:0,travel:0.3,online:0.3,entertainment:5,utilities:0.3,general:0.3},
    notes:'2 free PVR tickets/mo. 15% cashback on F&B at PVR. 5% on PVR ticket purchases. ~0.3% on others.' },

  // ==================== IDFC FIRST BANK ====================
  { id:'idfc-select', name:'IDFC FIRST Select', bank:'IDFC FIRST Bank', network:'Visa', color:'#3b82f6', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:2,groceries:2,fuel:0,travel:2,online:2,entertainment:2,utilities:0,general:2},
    notes:'3x up to ₹20K/mo, 10x after (1 RP/₹125 @ ₹0.25). Effective ~0.6% base, up to 2% on high spends. Lifetime Free. No fuel/utility/rent/gaming. Never-expiring RP.' },
  { id:'idfc-wealth', name:'IDFC FIRST Wealth', bank:'IDFC FIRST Bank', network:'Visa', color:'#334155', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:2.5,groceries:2.5,fuel:0,travel:2.5,online:2.5,entertainment:2.5,utilities:0,general:2.5},
    notes:'Best IDFC card. 10x = 2.5% (1 RP/₹100 @ ₹0.25). 1.5% forex markup. Lifetime Free. No fuel/utility/rent/gaming.' },
  { id:'idfc-millennia', name:'IDFC FIRST Millennia', bank:'IDFC FIRST Bank', network:'Visa', color:'#14b8a6', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:1.67,groceries:1.67,fuel:0,travel:1.67,online:1.67,entertainment:1.67,utilities:0,general:1.67},
    notes:'10x = 1.67% (1 RP/₹150 @ ₹0.25). 3x base ~0.5%. Lifetime Free. Entry-level. No fuel/utility/rent.' },
  { id:'idfc-classic', name:'IDFC FIRST Classic', bank:'IDFC FIRST Bank', network:'Visa', color:'#94a3b8', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:0.5,online:0.5,entertainment:0.5,utilities:0,general:0.5},
    notes:'Entry-level ~0.5% base. Lifetime Free. Lower income eligibility (₹25K/mo). No fuel/utility/rent.' },
  { id:'idfc-ashva', name:'IDFC FIRST Ashva', bank:'IDFC FIRST Bank', network:'Visa', color:'#8b5cf6', joiningFee:2999, annualFee:2999, monthlyCap:0,
    rates:{dining:2.5,groceries:2.5,fuel:0,travel:2.5,online:2.5,entertainment:2.5,utilities:0,general:2.5},
    notes:'Premium card ~2.5%. Lounge access. Rewards never expire. No fuel/utility/rent/gaming.' },
  { id:'idfc-hpcl', name:'IDFC FIRST HPCL Power+', bank:'IDFC FIRST Bank', network:'Visa', color:'#f97316', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:5,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'Accelerated rewards on HPCL fuel (~5%). 0.5% on others. Lifetime Free. Fuel surcharge waiver.' },

  // ==================== RBL BANK ====================
  { id:'rbl-indianoil-xtra', name:'IndianOil RBL XTRA', bank:'RBL Bank', network:'Mastercard', color:'#f97316', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:7.5,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'10 Fuel Points/₹100 at IOCL (~7.5%). 1 FP/₹100 others (~0.5%). Top fuel card for IndianOil. Fee waived on ₹2.5L spend.' },
  { id:'rbl-duet-plus', name:'RBL Paisabazaar Duet Plus', bank:'RBL Bank', network:'Mastercard', color:'#8b5cf6', joiningFee:0, annualFee:0, monthlyCap:500,
    rates:{dining:2.5,groceries:1,fuel:0,travel:2.5,online:1,entertainment:1,utilities:1,general:1},
    notes:'2.5% on travel & dining. 1% on others. Cap ₹500/mo. Lifetime Free.' },
  { id:'rbl-shoprite', name:'RBL ShopRite', bank:'RBL Bank', network:'Mastercard', color:'#22c55e', joiningFee:500, annualFee:500, monthlyCap:0,
    rates:{dining:1,groceries:3,fuel:1,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'Accelerated RP on grocery & fuel. ~3% groceries. ~1% fuel. 0.5% others.' },
  { id:'rbl-world-safari', name:'RBL World Safari', bank:'RBL Bank', network:'Mastercard', color:'#334155', joiningFee:3000, annualFee:3000, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:2.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'5 RP/₹100 on travel (~2.5%). 2 RP/₹100 domestic (~0.5%). Zero forex markup. Premium travel card.' },

  // ==================== FEDERAL BANK ====================
  { id:'scapia-federal', name:'Scapia Federal Bank', bank:'Federal Bank', network:'Visa', color:'#14b8a6', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:2,groceries:2,fuel:2,travel:4,online:2,entertainment:2,utilities:2,general:2},
    notes:'2% on all spends (incl. insurance & jewellery — rare). 4% on Scapia app travel bookings. Zero forex. Lifetime Free. Unlimited lounge access.' },

  // ==================== AMERICAN EXPRESS ====================
  { id:'amex-smartearn', name:'Amex SmartEarn', bank:'American Express', network:'Amex', color:'#3b82f6', joiningFee:495, annualFee:495, monthlyCap:0,
    rates:{dining:5,groceries:0.5,fuel:0,travel:0.5,online:5,entertainment:0.5,utilities:0,general:0.5},
    notes:'10x MR on Zomato/Ajio/Nykaa/BookMyShow/Uber (~5%). 5x on Amazon (~2.5%). 1 MR/₹50 base (~0.5%). Fee waived on ₹40K spend. No fuel/utility.' },
  { id:'amex-mrcc', name:'Amex Membership Rewards (MRCC)', bank:'American Express', network:'Amex', color:'#eab308', joiningFee:1000, annualFee:4500, monthlyCap:0,
    rates:{dining:2,groceries:2,fuel:0,travel:2,online:2,entertainment:2,utilities:0,general:2},
    notes:'1 MR/₹50 (~0.5% base). BUT milestone bonuses: 1,000 MR on 4x ₹1,500 txns/mo + 1,000 on ₹20K/mo → effective ~6% at ₹20K/mo spend. MR points never expire. No fuel/utility.' },
  { id:'amex-plat-travel', name:'Amex Platinum Travel', bank:'American Express', network:'Amex', color:'#334155', joiningFee:5000, annualFee:5000, monthlyCap:0,
    rates:{dining:0.6,groceries:0.6,fuel:0,travel:4,online:0.6,entertainment:0.6,utilities:0,general:0.6},
    notes:'1 MR/₹50 base (~0.6%). Milestones: 7,500 MR on ₹1.9L + 10,000 MR on ₹4L + Taj voucher ₹10K. Effective ~4% on travel-heavy spending. Changes coming Mar 2026.' },
  { id:'amex-gold', name:'Amex Gold (Charge Card)', bank:'American Express', network:'Amex', color:'#eab308', joiningFee:9000, annualFee:9000, monthlyCap:0,
    rates:{dining:2,groceries:2,fuel:2,travel:2,online:2,entertainment:2,utilities:2,general:2},
    notes:'4,000 MR welcome. 1,000 bonus MR on 6x ₹1K txns/mo. Earns on fuel too. 10x via Reward Multiplier portal. ~2% effective. MR never expire. Charge card (pay in full).' },

  // ==================== INDUSIND BANK ====================
  { id:'indusind-legend', name:'IndusInd Legend', bank:'IndusInd Bank', network:'Visa', color:'#3b82f6', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:1,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'2 RP/₹100 weekends (=₹1 → 1%). 1 RP/₹100 weekdays (=₹0.50 → 0.5%). 1 RP=₹0.50 cash. Lifetime Free. RP never expire. Cash redemption cap 5,000 RP/mo.' },
  { id:'indusind-tiger', name:'IndusInd Tiger', bank:'IndusInd Bank', network:'Visa', color:'#f97316', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:2.4,groceries:2.4,fuel:0,travel:2.4,online:2.4,entertainment:2.4,utilities:2.4,general:2.4},
    notes:'Up to 6 RP/₹100 @ ₹0.40 (=2.4%). Tier-based: 1.2% up to ₹1L, 7.2% above ₹5L/yr. Lifetime Free. Cash cap 5,000 RP/mo.' },
  { id:'indusind-platinum', name:'IndusInd Platinum', bank:'IndusInd Bank', network:'Visa', color:'#94a3b8', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.4,groceries:0.4,fuel:0,travel:0.4,online:0.4,entertainment:0.4,utilities:0.4,general:0.4},
    notes:'Up to 8x RP/₹100 (~0.4% base). Discount vouchers of top brands. Lifetime Free entry-level.' },
  { id:'indusind-eazydiner', name:'EazyDiner IndusInd', bank:'IndusInd Bank', network:'Visa', color:'#ef4444', joiningFee:2999, annualFee:2999, monthlyCap:0,
    rates:{dining:4,groceries:1,fuel:0,travel:1,online:2,entertainment:2,utilities:1,general:1},
    notes:'10 RP/₹100 on dining/shopping/entertainment (~4% dining). Up to 50% off dining via EazyDiner Prime. Premium dining card.' },
  { id:'indusind-nexxt', name:'IndusInd Nexxt', bank:'IndusInd Bank', network:'Visa', color:'#8b5cf6', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:2.5,groceries:1,fuel:0,travel:1,online:1,entertainment:1,utilities:1,general:1},
    notes:'India\'s first interactive card with buttons. 1%-2.5% rewards. Lifetime Free.' },

  // ==================== YES BANK ====================
  { id:'yes-paisasave', name:'YES BANK PaisaSave', bank:'YES Bank', network:'Visa', color:'#3b82f6', joiningFee:0, annualFee:499, monthlyCap:0,
    rates:{dining:6,groceries:1,fuel:0,travel:6,online:1,entertainment:1,utilities:1,general:1},
    notes:'6% on dining & travel (12 RP/₹200 @ 1:1). 1% others. Fee waived on ₹1.2L spend. Top dining+travel card.' },
  { id:'yes-prosperity-cashback', name:'YES Prosperity Cashback', bank:'YES Bank', network:'Visa', color:'#22c55e', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:1,online:1,entertainment:1,utilities:1,general:1},
    notes:'~1% cashback on all spends. Lifetime Free. Basic entry-level card from YES Bank.' },
  { id:'yes-first-exclusive', name:'YES FIRST Exclusive', bank:'YES Bank', network:'Visa', color:'#334155', joiningFee:10000, annualFee:10000, monthlyCap:0,
    rates:{dining:1.5,groceries:1.5,fuel:0,travel:3,online:1.5,entertainment:1.5,utilities:1.5,general:1.5},
    notes:'9 RP/₹200 on travel (~3%). 6 RP/₹200 base (~1.5%). Unlimited domestic lounge. Golf. Premium card from YES Bank.' },

  // ==================== STANDARD CHARTERED ====================
  { id:'sc-ultimate', name:'Standard Chartered Ultimate', bank:'Standard Chartered', network:'Visa', color:'#3b82f6', joiningFee:5000, annualFee:5000, monthlyCap:0,
    rates:{dining:3.3,groceries:3.3,fuel:0,travel:3.3,online:3.3,entertainment:3.3,utilities:3.3,general:3.3},
    notes:'~3.3% reward rate across all categories. Unlimited lounge access. Premium card. Fee waived on ₹6L spend. No fuel rewards.' },
  { id:'sc-easemytrip', name:'SC EaseMyTrip', bank:'Standard Chartered', network:'Visa', color:'#ef4444', joiningFee:999, annualFee:999, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:5,online:1,entertainment:1,utilities:1,general:1},
    notes:'Up to 12x points on EaseMyTrip (~5% travel). Base rewards on others (~1%). Good travel co-brand.' },
  { id:'sc-digismart', name:'SC DigiSmart', bank:'Standard Chartered', network:'Visa', color:'#14b8a6', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:0.5,online:2,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'5% cashback on online spend categories (avg ~2%). 0.5% others. Lifetime Free. Digital-first card.' },

  // ==================== HSBC ====================
  { id:'hsbc-travelone', name:'HSBC TravelOne', bank:'HSBC', network:'Visa', color:'#ef4444', joiningFee:3500, annualFee:3500, monthlyCap:0,
    rates:{dining:2,groceries:2,fuel:0,travel:4,online:2,entertainment:2,utilities:2,general:2},
    notes:'4 RP/₹100 on flights, travel, international (=4%). 2 RP/₹100 others (=2%). Zero forex markup. Fee waived on ₹4L spend.' },
  { id:'hsbc-live-plus', name:'HSBC Live+', bank:'HSBC', network:'Visa', color:'#22c55e', joiningFee:999, annualFee:999, monthlyCap:0,
    rates:{dining:10,groceries:10,fuel:0,travel:1,online:1,entertainment:1,utilities:1,general:1},
    notes:'10% cashback on dining, grocery & food delivery. 1% others. Fee waived on ₹2L spend. Great for dining & groceries.' },
  { id:'hsbc-cashback', name:'HSBC Cashback', bank:'HSBC', network:'Visa', color:'#3b82f6', joiningFee:750, annualFee:750, monthlyCap:0,
    rates:{dining:1.5,groceries:1.5,fuel:0,travel:1.5,online:1.5,entertainment:1.5,utilities:1.5,general:1.5},
    notes:'1.5% cashback across all categories. No caps on cashback. Fee waived on ₹1L spend. Simple & straightforward.' },
  { id:'hsbc-smart-value', name:'HSBC Smart Value', bank:'HSBC', network:'Visa', color:'#f97316', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:2.5,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'2.5% on fuel. 1% on dining & groceries. 0.5% others. Lifetime Free. Fuel surcharge waiver.' },
  { id:'hsbc-taj', name:'HSBC Taj Card', bank:'HSBC', network:'Visa', color:'#eab308', joiningFee:10000, annualFee:10000, monthlyCap:0,
    rates:{dining:5,groceries:1.5,fuel:0,travel:5,online:1.5,entertainment:1.5,utilities:1.5,general:1.5},
    notes:'5 RP/₹100 at Taj/Vivanta/Ginger hotels (=5%). 1.5 RP/₹100 others (=1.5%). 2 Taj stays + 1 Taj Palace stay on activation. Ultra-premium hotel card.' },

  // ==================== BANK OF BARODA ====================
  { id:'bob-cashback', name:'BOBCARD Cashback', bank:'Bank of Baroda', network:'Visa', color:'#f97316', joiningFee:500, annualFee:500, monthlyCap:1500,
    rates:{dining:1,groceries:1,fuel:0,travel:1,online:5,entertainment:1,utilities:1,general:1},
    notes:'5% on select online (4% accelerated + 1% base). 1% on others. Accelerated cap ₹1,500/mo (min 4 txns). 1% fuel surcharge waiver.' },
  { id:'bob-easy', name:'BOBCARD Easy', bank:'Bank of Baroda', network:'Visa', color:'#22c55e', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'~0.5% rewards on all spends. Lifetime Free entry-level card. Fuel surcharge waiver.' },
  { id:'bob-premier', name:'BOBCARD Premier', bank:'Bank of Baroda', network:'Visa', color:'#8b5cf6', joiningFee:2999, annualFee:2999, monthlyCap:0,
    rates:{dining:1.5,groceries:1.5,fuel:0,travel:1.5,online:1.5,entertainment:1.5,utilities:1.5,general:1.5},
    notes:'~1.5% rewards. Lounge access. Milestone benefits. Premium BOB card.' },

  // ==================== CANARA BANK ====================
  { id:'canara-visa-classic', name:'Canara Bank Visa Classic', bank:'Canara Bank', network:'Visa', color:'#3b82f6', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'2 RP/₹100 (1 RP=₹0.25 → 0.5%). Flat rate across all categories. Lifetime Free. Up to 50 days interest-free. No fuel rewards.' },
  { id:'canara-mc-world', name:'Canara Bank MasterCard World', bank:'Canara Bank', network:'Mastercard', color:'#334155', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'2 RP/₹100 (0.5%). LTF but ₹354 inactivity fee if spend <₹1L/yr. Domestic lounge: 3 self+2 guest/qtr. International: 2 self+2 guest/yr. 1% fuel surcharge waiver. GoIbibo: 12% off flights, 15% off hotels.' },
  { id:'canara-rupay-platinum', name:'Canara Bank RuPay Platinum', bank:'Canara Bank', network:'RuPay', color:'#94a3b8', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'2 RP/₹100 (0.5%). Lifetime Free. Basic RuPay card. Can be linked to UPI for CC-on-UPI payments. RuPay benefits apply.' },
  { id:'canara-rupay-select', name:'Canara Bank RuPay Select', bank:'Canara Bank', network:'RuPay', color:'#8b5cf6', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:5,groceries:0.5,fuel:0,travel:0.5,online:0.5,entertainment:0.5,utilities:5,general:0.5},
    notes:'5% cashback on dining & utility bills (cap ₹50/mo each → effective on first ₹1,000/mo per category). 0.5% on others. LTF (₹300 inactivity fee if spend <₹10K/yr). Domestic lounge 2/qtr. International 2/yr. 1% fuel surcharge waiver. RuPay CC on UPI supported.' },
  { id:'canara-rupay-select-secured', name:'Canara Bank RuPay Select Secured', bank:'Canara Bank', network:'RuPay', color:'#22c55e', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:5,groceries:0.5,fuel:0,travel:0.5,online:0.5,entertainment:0.5,utilities:5,general:0.5},
    notes:'Secured (FD-backed) variant. 5% cashback on dining & utility bills (cap ₹50/mo each). 0.5% on others. Limit ₹1L-50L based on FD. Lounge access. Concierge. RuPay CC on UPI supported.' },

  // ==================== OTHERS ====================
  { id:'onecard', name:'OneCard', bank:'OneCard (FPL)', network:'Visa', color:'#334155', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:1.25,groceries:1.25,fuel:0,travel:0.25,online:1.25,entertainment:0.25,utilities:0.25,general:0.25},
    notes:'5x on top 2 spend categories (~1.25%). 1x others (~0.25%). Auto-detected. Lifetime Free metal card. No fuel rewards.' },
  { id:'au-lit', name:'AU LIT Credit Card', bank:'AU Small Finance', network:'Visa', color:'#14b8a6', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:1,online:1,entertainment:1,utilities:3.5,general:1},
    notes:'3.5% on utility/bill payments. 1% all others. Lifetime Free.' },
  { id:'au-altura', name:'AU Altura Credit Card', bank:'AU Small Finance', network:'Visa', color:'#8b5cf6', joiningFee:499, annualFee:499, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:1,online:2,entertainment:1,utilities:2,general:1},
    notes:'2% on online & utility spends. 1% others. Lounge access. Fee waived on ₹1L spend.' },
  { id:'au-altura-plus', name:'AU Altura Plus', bank:'AU Small Finance', network:'Visa', color:'#8b5cf6', joiningFee:999, annualFee:999, monthlyCap:0,
    rates:{dining:1.5,groceries:1.5,fuel:0,travel:1.5,online:2.5,entertainment:1.5,utilities:2.5,general:1.5},
    notes:'2.5% on online & utility. 1.5% others. 4 lounge visits/qtr. Fee waived on ₹3L spend.' },
  { id:'fi-federal', name:'Fi Federal Bank (powered by OneCard)', bank:'Federal Bank', network:'Visa', color:'#eab308', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:1.25,groceries:1.25,fuel:0,travel:0.25,online:1.25,entertainment:0.25,utilities:0.25,general:0.25},
    notes:'5x on top 2 categories (~1.25%). 1x others (~0.25%). Powered by OneCard. Lifetime Free. No fuel rewards.' },

  // ==================== PNB (Punjab National Bank) ====================
  { id:'pnb-rupay-platinum', name:'PNB RuPay Platinum', bank:'Punjab National Bank', network:'RuPay', color:'#1e40af', joiningFee:0, annualFee:500, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0.5,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'1 RP/₹100 (1 RP=₹0.50 → 0.5%). Flat rate on all spends. Fee waived if used once/qtr. 300+ welcome bonus RP. UPI-linkable. Fuel surcharge waiver.' },
  { id:'pnb-rupay-select', name:'PNB RuPay Select', bank:'Punjab National Bank', network:'RuPay', color:'#1e3a5f', joiningFee:0, annualFee:750, monthlyCap:0,
    rates:{dining:0.67,groceries:0.67,fuel:0.67,travel:0.67,online:0.67,entertainment:0.67,utilities:0.67,general:0.67},
    notes:'2 RP/₹150 (1 RP=₹0.50 → 0.67%). Fee waived if used once/qtr. Lounge access (domestic+intl). 300+ welcome RP. Insurance coverage. Concierge. UPI-linkable.' },

  // ==================== UNION BANK OF INDIA ====================
  { id:'union-rupay-select', name:'Union Bank RuPay Select', bank:'Union Bank of India', network:'RuPay', color:'#ea580c', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:1,travel:1,online:1,entertainment:1,utilities:1,general:1},
    notes:'4 RP/₹100 (1 RP=₹0.25 → ~1%). 2 domestic lounge/qtr + 2 intl/yr. Amazon Prime + 3-mo Swiggy One membership. 1% fuel surcharge waiver. UPI-linkable.' },
  { id:'union-platinum', name:'Union Bank Platinum', bank:'Union Bank of India', network:'Visa', color:'#c2410c', joiningFee:0, annualFee:0, monthlyCap:50,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'0.5% on most categories. Cashback cap ₹50/mo on utility/wallet/IRCTC. No joining/annual fee. Insurance cover. 1% fuel surcharge waiver (₹200+ txns).' },
  { id:'union-carbon-hpcl', name:'Union Bank UNI CARBON HPCL', bank:'Union Bank of India', network:'RuPay', color:'#f97316', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:4,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'₹4 cashback/₹100 fuel at HPCL (4%) + 1.5% via HP Pay app. 2 RP/₹100 non-fuel (0.5%). Welcome ₹300 on first HPCL purchase. 1% fuel surcharge waiver. Insurance ₹10L. UPI-linkable.' },

  // ==================== INDIAN BANK ====================
  { id:'indian-bank-gold', name:'Indian Bank Gold', bank:'Indian Bank', network:'Visa', color:'#0369a1', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'1 RP/₹200 (1 RP=₹1 → 0.5%). No joining/annual fee. Air accident insurance ₹5L. Hospitalization cover up to ₹1L. 45 days interest-free. Fuel surcharge waiver.' },
  { id:'indian-bank-bharat', name:'Indian Bank Bharat', bank:'Indian Bank', network:'RuPay', color:'#0284c7', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'₹0.50 cashback/₹100 spent (0.5%). Max credit limit ₹20,000. Min ₹500 for redemption. Interest as low as 1.99%. UPI-linkable. Basic entry-level card.' },

  // ==================== BANK OF INDIA ====================
  { id:'boi-rupay-select', name:'Bank of India RuPay Select', bank:'Bank of India', network:'RuPay', color:'#b91c1c', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:1,travel:1,online:1,entertainment:1,utilities:1,general:1},
    notes:'2x RP on POS & e-commerce (~1%). 8 domestic lounge (2/qtr) + 2 intl/yr. Amazon Prime + 3-mo Swiggy One membership. 51 days interest-free. UPI-linkable. Star Rewardz program.' },
  { id:'boi-rupay-platinum', name:'Bank of India RuPay Platinum', bank:'Bank of India', network:'RuPay', color:'#dc2626', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0.5,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'2 Star Points/₹100 (~0.5%). 3 Star Points/₹100 on preferred merchants. Welcome gift vouchers. Concierge 24/7. Insurance ₹2L. 51 days interest-free. UPI-linkable.' },
  { id:'boi-mastercard-platinum', name:'BOI Mastercard Platinum Intl', bank:'Bank of India', network:'Mastercard', color:'#ef4444', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0.5,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'2 Star Points/₹100 (~0.5%). Accepted internationally. 3 lounge visits/yr. 51 days interest-free. EMI on purchases ₹5,000+.' },

  // ==================== CENTRAL BANK OF INDIA ====================
  { id:'central-world', name:'Central Bank World Credit Card', bank:'Central Bank of India', network:'Visa', color:'#7c3aed', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.75,groceries:0.75,fuel:0,travel:0.75,online:0.75,entertainment:0.75,utilities:0.75,general:0.75},
    notes:'3 RP/₹100 domestic, 4 RP/₹100 international (1 RP≈₹0.25 → 0.75% domestic, 1% intl). Loss protection ₹1L/day. Air accident insurance ₹10L. Fuel surcharge waiver ₹400-₹4,000.' },

  // ==================== INDIAN OVERSEAS BANK ====================
  { id:'iob-rupay-select', name:'IOB RuPay Select', bank:'Indian Overseas Bank', network:'RuPay', color:'#059669', joiningFee:0, annualFee:1000, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'Super-premium RuPay variant. 2 domestic lounge/qtr + 2 intl/yr. 1% fuel surcharge waiver (₹400-₹5,000, cap ₹250/cycle). Accident insurance ₹10L (NPCI). Fee may be waived on spend threshold.' },
  { id:'iob-visa-classic', name:'IOB Visa Classic', bank:'Indian Overseas Bank', network:'Visa', color:'#14b8a6', joiningFee:0, annualFee:0, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'RP on POS & e-commerce (~0.5%). Credit limit up to ₹5L. Up to 4 add-on cards. Fuel surcharge waiver. Basic entry-level card.' },

  // ==================== BAJAJ FINSERV (RBL SUPERCARDS) ====================
  { id:'bajaj-rbl-world-prime', name:'Bajaj Finserv RBL World Prime SuperCard', bank:'RBL Bank', network:'Visa', color:'#1e3a5f', joiningFee:3499, annualFee:3499, monthlyCap:0,
    rates:{dining:1,groceries:1,fuel:0,travel:1,online:1,entertainment:1,utilities:1,general:1},
    notes:'2 RP/₹100 (~1%). 12,000 welcome RP on ₹2K spend in 30 days. 10K bonus at ₹1.5L annual, 20K at ₹3.5L. BOGO movie (2x/mo BMS). 8 domestic lounge/yr. EMI card + cash card + loan card in one.' },
  { id:'bajaj-rbl-platinum-prime', name:'Bajaj Finserv RBL Platinum Prime SuperCard', bank:'RBL Bank', network:'Visa', color:'#475569', joiningFee:999, annualFee:999, monthlyCap:0,
    rates:{dining:0.5,groceries:0.5,fuel:0,travel:0.5,online:0.5,entertainment:0.5,utilities:0.5,general:0.5},
    notes:'2 RP/₹100 (~0.5%). 5x RP on Bajaj Finserv partner electronics. 4,000 welcome RP. 10K bonus at ₹1.5L annual spend. Fuel surcharge waiver ₹100/mo. EMI + cash + loan card in one.' },

  // ==================== KOTAK (Additional) ====================
  { id:'kotak-zen', name:'Kotak Zen Signature', bank:'Kotak Mahindra', network:'Visa', color:'#e11d48', joiningFee:1500, annualFee:1500, monthlyCap:0,
    rates:{dining:0.83,groceries:0.83,fuel:0,travel:0.83,online:0.83,entertainment:0.83,utilities:0,general:0.83},
    notes:'5 Zen Points/₹150 base (0.83%). 10 Zen Points/₹150 on shopping/lifestyle/jewellery (1.67%). Cap 6,500 pts/cycle. No pts on fuel/wallet/rent/gaming. 1 Zen Pt=₹0.20-0.25. Fee waived on ₹1.5L spend. Milestone: 7,500 pts at ₹3L or 15,000 pts at ₹6L/yr.' },
  { id:'kotak-royale', name:'Kotak Royale Signature', bank:'Kotak Mahindra', network:'Visa', color:'#9333ea', joiningFee:1499, annualFee:999, monthlyCap:0,
    rates:{dining:0.66,groceries:0.33,fuel:0,travel:0.66,online:0.33,entertainment:0.33,utilities:0,general:0.33},
    notes:'4 RP/₹150 on hotels/airlines/dining/travel (0.66%). 2 RP/₹150 others (0.33%). 1 RP=₹0.20-0.25. No pts on fuel/wallet/rent/gaming. Annual fee waived on ₹1L spend. Milestone: 10K pts at ₹4L or 30K at ₹8L/yr.' },
];

// ===================== SMARTBUY RATES (HDFC portal) =====================
// rate = effective %, cap = max bonus RP per month (incremental 9x portion)
// Infinia/Diners Black: 15,000 bonus RP/mo. Regalia: similar caps. Valid till Mar 2026.
const SMARTBUY_RATES = {
  'hdfc-infinia':      { rate:33.3, capPerMonth:15000 },
  'hdfc-diners-black': { rate:33.3, capPerMonth:15000 },
  'hdfc-regalia':      { rate:13.3, capPerMonth:7500 },
  'hdfc-regalia-gold': { rate:13.3, capPerMonth:7500 },
  'hdfc-regalia-first':{ rate:6.7,  capPerMonth:5000 },
  'hdfc-millennia':    { rate:5,    capPerMonth:5000 },
  'hdfc-moneyback-plus':{ rate:5,   capPerMonth:2500 },
  'hdfc-tata-neu-infinity':{ rate:5,capPerMonth:5000 },
  'hdfc-diners-privilege':{ rate:6.7,capPerMonth:7500 },
  'hdfc-pixel-play':   { rate:5,    capPerMonth:5000 },
};

// ===================== APPLY / AFFILIATE LINKS =====================
// Replace these with your affiliate tracking URLs once you sign up with partners
const APPLY_LINKS = {
  // HDFC Bank
  'hdfc-infinia':           'https://www.hdfcbank.com/personal/pay/cards/credit-cards/infinia-credit-card',
  'hdfc-diners-black':      'https://www.hdfcbank.com/personal/pay/cards/credit-cards/diners-club-black-credit-card',
  'hdfc-diners-privilege':  'https://www.hdfcbank.com/personal/pay/cards/credit-cards/diners-club-privilege-credit-card',
  'hdfc-regalia':           'https://www.hdfcbank.com/personal/pay/cards/credit-cards/regalia-credit-card',
  'hdfc-regalia-gold':      'https://www.hdfcbank.com/personal/pay/cards/credit-cards/regalia-gold-credit-card',
  'hdfc-regalia-first':     'https://www.hdfcbank.com/personal/pay/cards/credit-cards/regalia-first-credit-card',
  'hdfc-millennia':         'https://www.hdfcbank.com/personal/pay/cards/credit-cards/millennia-credit-card',
  'hdfc-swiggy':            'https://www.hdfcbank.com/personal/pay/cards/credit-cards/swiggy-hdfc-bank-credit-card',
  'hdfc-tata-neu-plus':     'https://www.hdfcbank.com/personal/pay/cards/credit-cards/tata-neu-plus-hdfc-bank-credit-card',
  'hdfc-tata-neu-infinity': 'https://www.hdfcbank.com/personal/pay/cards/credit-cards/tata-neu-infinity-hdfc-bank-credit-card',
  'hdfc-moneyback-plus':    'https://www.hdfcbank.com/personal/pay/cards/credit-cards/moneyback-plus-credit-card',
  'hdfc-pixel-play':        'https://www.hdfcbank.com/personal/pay/cards/credit-cards/pixel-play-credit-card',
  'hdfc-freedom':           'https://www.hdfcbank.com/personal/pay/cards/credit-cards/freedom-credit-card',
  'hdfc-indianoil':         'https://www.hdfcbank.com/personal/pay/cards/credit-cards/indianoil-hdfc-bank-credit-card',
  // SBI Card
  'sbi-cashback':           'https://www.sbicard.com/en/personal/credit-cards/cashback/cashback-sbi-card.page',
  'sbi-elite':              'https://www.sbicard.com/en/personal/credit-cards/premium/sbi-card-elite.page',
  'sbi-prime':              'https://www.sbicard.com/en/personal/credit-cards/premium/sbi-card-prime.page',
  'sbi-simplyclick':        'https://www.sbicard.com/en/personal/credit-cards/shopping/simplyclick-sbi-card.page',
  'sbi-simplysave':         'https://www.sbicard.com/en/personal/credit-cards/shopping/simplysave-sbi-card.page',
  'sbi-bpcl':               'https://www.sbicard.com/en/personal/credit-cards/travel-fuel/bpcl-sbi-card.page',
  'sbi-pulse':              'https://www.sbicard.com/en/personal/credit-cards/premium/sbi-card-pulse.page',
  'sbi-flipkart':           'https://www.sbicard.com/en/personal/credit-cards/shopping/flipkart-sbi-card.page',
  // ICICI Bank
  'icici-amazon-pay':       'https://www.icicibank.com/card/credit-cards/amazon-pay-credit-card',
  'icici-emeralde':         'https://www.icicibank.com/card/credit-cards/emeralde-credit-card',
  'icici-sapphiro':         'https://www.icicibank.com/card/credit-cards/sapphiro-credit-card',
  'icici-coral':            'https://www.icicibank.com/card/credit-cards/coral-credit-card',
  'icici-rubyx':            'https://www.icicibank.com/card/credit-cards/rubyx-credit-card',
  'icici-platinum-chip':    'https://www.icicibank.com/card/credit-cards/platinum-chip-credit-card',
  'icici-mmt':              'https://www.icicibank.com/card/credit-cards/makemytrip-icici-bank-credit-card',
  // Axis Bank
  'axis-magnus':            'https://www.axisbank.com/credit-card/magnus-credit-card',
  'axis-atlas':             'https://www.axisbank.com/credit-card/atlas-credit-card',
  'axis-ace':               'https://www.axisbank.com/credit-card/ace-credit-card',
  'axis-flipkart':          'https://www.axisbank.com/credit-card/flipkart-axis-bank-credit-card',
  'axis-myzone':            'https://www.axisbank.com/credit-card/my-zone-credit-card',
  'axis-vistara':           'https://www.axisbank.com/credit-card/vistara-credit-card',
  // Kotak
  'kotak-811-1':            'https://www.kotak.com/en/personal-banking/cards/credit-cards/811-credit-card.html',
  'kotak-league-platinum':  'https://www.kotak.com/en/personal-banking/cards/credit-cards/league-platinum-credit-card.html',
  // IDFC FIRST
  'idfc-classic':           'https://www.idfcfirstbank.com/credit-card/classic',
  'idfc-select':            'https://www.idfcfirstbank.com/credit-card/select',
  'idfc-millennia':         'https://www.idfcfirstbank.com/credit-card/millennia',
  'idfc-wealth':            'https://www.idfcfirstbank.com/credit-card/wealth',
  // Amex
  'amex-mrcc':              'https://www.americanexpress.com/in/credit-cards/membership-rewards-credit-card/',
  'amex-smartearn':         'https://www.americanexpress.com/in/credit-cards/smartearn-credit-card/',
  'amex-plat-travel':       'https://www.americanexpress.com/in/credit-cards/platinum-travel-credit-card/',
  'amex-gold':              'https://www.americanexpress.com/in/credit-cards/gold-card/',
  // Others
  'onecard':                'https://www.getonecard.app/',
  'au-lit':                 'https://www.aubank.in/credit-card/lit-credit-card',
  'au-vetta':               'https://www.aubank.in/credit-card/vetta-credit-card',
  'scapia':                 'https://scapia.com/',
  'rbl-shoprite':           'https://www.rblbank.com/credit-cards/shoprite-credit-card',
  'indusind-legend':        'https://www.indusind.com/in/en/personal/cards/credit-card/legend-credit-card.html',
  'hsbc-cashback':          'https://www.hsbc.co.in/credit-cards/cashback/',
  'bob-eterna':             'https://www.bankofbaroda.in/personal-banking/digital-products/cards/credit-card/bob-eterna-credit-card',
  'yes-marquee':            'https://www.yesbank.in/personal-banking/yes-first/credit-cards/yes-first-marquee',
  'sc-ultimate':            'https://www.sc.com/in/credit-cards/ultimate/',
  'canara-rupay-select':    'https://canarabank.com/User_page.aspx?otherlinkid=228',
  'canara-rupay-platinum':  'https://canarabank.com/User_page.aspx?otherlinkid=228',
  'pnb-rupay-platinum':    'https://www.pnbcard.in/credit-card.html',
  'pnb-rupay-select':      'https://www.pnbcard.in/credit-card.html',
  'union-rupay-select':    'https://www.unionbankofindia.bank.in/en/details/rupay-select-credit-card',
  'union-platinum':        'https://www.unionbankofindia.bank.in/en/details/rupay-select-credit-card',
  'union-carbon-hpcl':     'https://www.unionbankofindia.bank.in/en/details/rupay-select-credit-card',
  'indian-bank-gold':      'https://www.indianbank.in/departments/credit-card/',
  'indian-bank-bharat':    'https://www.indianbank.in/departments/credit-card/',
  'boi-rupay-select':      'https://www.bankofindia.co.in/creditcard',
  'boi-rupay-platinum':    'https://www.bankofindia.co.in/creditcard',
  'boi-mastercard-platinum':'https://www.bankofindia.co.in/creditcard',
  'central-world':         'https://www.centralbankofindia.co.in/en/credit-cards',
  'iob-rupay-select':      'https://www.iob.bank.in/en/credit-card',
  'iob-visa-classic':      'https://www.iob.bank.in/en/credit-card',
  'bajaj-rbl-world-prime': 'https://www.bajajfinserv.in/bajaj-finserv-rbl-bank-supercard',
  'bajaj-rbl-platinum-prime':'https://www.bajajfinserv.in/bajaj-finserv-rbl-bank-supercard',
  'kotak-zen':             'https://www.kotak.bank.in/en/personal-banking/cards/credit-cards/zen-signature-credit-card.html',
  'kotak-royale':          'https://www.kotak.bank.in/en/personal-banking/cards/credit-cards/royale-signature-credit-card.html',
};

// ===================== ROUTE TEMPLATES =====================
const ROUTE_TEMPLATES = [
  // --- Amazon Gift Card routes ---
  { id:'amazon-gc-bills', name:'Amazon Gift Card \u2192 Pay on Amazon',
    purchaseTypes:['mobile_recharge','electricity_bill','dth_recharge','broadband_bill','water_bill','lpg_cylinder','fastag_recharge','insurance_premium'],
    steps:[
      { label:'Buy Amazon Gift Card on Amazon.in', cardCat:'online' },
      { label:'Use GC balance to pay bill/recharge on Amazon', cardCat:null }
    ],
    tip:'Amazon GC purchase codes as online shopping. Your card\'s online rate applies instead of utility rate. GC valid for 1 year.',
    notes:'Check Amazon Pay > Offers for additional cashback. Some billers may charge ₹5-15 convenience fee.'
  },
  { id:'amazon-gc-shopping', name:'Amazon Gift Card \u2192 Amazon Shopping',
    purchaseTypes:['amazon_shopping'],
    steps:[
      { label:'Buy Amazon Gift Card with best online-rate card', cardCat:'online' },
      { label:'Shop on Amazon using GC balance', cardCat:null }
    ],
    tip:'Useful if you have a card with higher online rate than Amazon Pay ICICI (5%). Also helps when your primary card is at monthly cap.',
    notes:'Compare with direct payment via Amazon Pay ICICI (5% for Prime members).'
  },
  { id:'amazon-gc-swiggy', name:'Swiggy GC via Amazon \u2192 Swiggy',
    purchaseTypes:['food_swiggy','swiggy_instamart'],
    steps:[
      { label:'Buy Swiggy Gift Card on Amazon.in', cardCat:'online' },
      { label:'Use Swiggy GC for food delivery / Instamart', cardCat:null }
    ],
    tip:'Uses your online rate instead of dining/grocery rate. Compare with HDFC Swiggy card (10% direct on Swiggy).',
    notes:'Swiggy GCs available on Amazon. Check expiry before buying large amounts.'
  },
  { id:'amazon-gc-zomato', name:'Zomato GC via Amazon \u2192 Zomato',
    purchaseTypes:['food_zomato'],
    steps:[
      { label:'Buy Zomato Gift Card on Amazon.in', cardCat:'online' },
      { label:'Use Zomato GC for food delivery', cardCat:null }
    ],
    tip:'Uses online rate instead of dining rate. Good when your online card rate > dining rate.',
    notes:'Zomato GCs sold on Amazon.'
  },
  { id:'amazon-gc-bms', name:'BookMyShow GC via Amazon \u2192 Movies',
    purchaseTypes:['movie_tickets'],
    steps:[
      { label:'Buy BookMyShow Gift Card on Amazon.in', cardCat:'online' },
      { label:'Book movie tickets with BMS GC', cardCat:null }
    ],
    tip:'Some cards offer BOGO on BookMyShow directly (ICICI Coral, SBI ELITE 2 free/mo). Compare total value including BOGO.',
    notes:'Uses online rate instead of entertainment rate.'
  },
  { id:'amazon-gc-bigbasket', name:'BigBasket GC via Amazon \u2192 Groceries',
    purchaseTypes:['grocery_bigbasket'],
    steps:[
      { label:'Buy BigBasket Gift Card on Amazon.in', cardCat:'online' },
      { label:'Use GC for grocery shopping on BigBasket', cardCat:null }
    ],
    tip:'HDFC Tata Neu cards give 5% on BigBasket via Tata Neu app. Compare both routes.',
    notes:'Uses online rate instead of grocery rate.'
  },
  { id:'amazon-gc-ott', name:'Amazon GC \u2192 OTT via Amazon Pay',
    purchaseTypes:['ott_subscription'],
    steps:[
      { label:'Buy Amazon Gift Card on Amazon.in', cardCat:'online' },
      { label:'Pay OTT subscription via Amazon Pay balance', cardCat:null }
    ],
    tip:'Netflix, Hotstar, Prime Video etc. can be paid via Amazon Pay.',
    notes:'Uses online rate instead of entertainment rate. Check if your OTT accepts Amazon Pay.'
  },

  // --- Flipkart Gift Card routes ---
  { id:'flipkart-gc', name:'Flipkart Gift Card \u2192 Flipkart Shopping',
    purchaseTypes:['flipkart_shopping'],
    steps:[
      { label:'Buy Flipkart Gift Card on Flipkart.com', cardCat:'online' },
      { label:'Shop on Flipkart using GC balance', cardCat:null }
    ],
    tip:'Compare with Flipkart SBI (5%) or Axis Flipkart (5%) direct rates.',
    notes:'GC purchase codes as online shopping.'
  },
  { id:'flipkart-gc-myntra', name:'Myntra GC via Flipkart \u2192 Myntra',
    purchaseTypes:['myntra_shopping'],
    steps:[
      { label:'Buy Myntra Gift Card on Flipkart.com', cardCat:'online' },
      { label:'Shop on Myntra using GC', cardCat:null }
    ],
    tip:'HDFC Regalia Gold gives 5x on Myntra directly. Axis Flipkart gives 7.5% on Myntra.',
    notes:'Uses online rate. Myntra GCs available on Flipkart.'
  },
  { id:'flipkart-gc-cleartrip', name:'Flipkart GC \u2192 Cleartrip Flight',
    purchaseTypes:['flight_booking'],
    steps:[
      { label:'Buy Flipkart Gift Card on Flipkart.com', cardCat:'online' },
      { label:'Book flight on Cleartrip using Flipkart GC', cardCat:null }
    ],
    tip:'Cleartrip is Flipkart-owned and accepts Flipkart GC/SuperCoins.',
    notes:'Uses online rate instead of travel rate for the GC purchase step.'
  },
  { id:'flipkart-gc-recharge', name:'Flipkart GC \u2192 Recharge on Flipkart',
    purchaseTypes:['mobile_recharge','dth_recharge'],
    steps:[
      { label:'Buy Flipkart Gift Card on Flipkart.com', cardCat:'online' },
      { label:'Recharge on Flipkart using GC balance', cardCat:null }
    ],
    tip:'Flipkart offers mobile and DTH recharges.',
    notes:'Uses online rate instead of utility rate.'
  },

  // --- HDFC SmartBuy routes ---
  { id:'smartbuy-amazon-gc', name:'HDFC SmartBuy \u2192 Amazon Voucher',
    purchaseTypes:['amazon_shopping','mobile_recharge','electricity_bill','dth_recharge','broadband_bill','insurance_premium','ott_subscription'],
    steps:[
      { label:'Buy Amazon voucher via HDFC SmartBuy portal', cardCat:'_smartbuy' },
      { label:'Use Amazon voucher for purchase', cardCat:null }
    ],
    bankRequired:'HDFC',
    tip:'Infinia/Diners Black earn ~33% via SmartBuy (10x points). Regalia ~13%. Best stacking route in India.',
    notes:'Only for HDFC credit card holders. SmartBuy Amazon voucher cap: ₹10,000/txn (buy multiple). Check SmartBuy availability.'
  },
  { id:'smartbuy-flipkart-gc', name:'HDFC SmartBuy \u2192 Flipkart Voucher',
    purchaseTypes:['flipkart_shopping','myntra_shopping'],
    steps:[
      { label:'Buy Flipkart voucher via HDFC SmartBuy', cardCat:'_smartbuy' },
      { label:'Use Flipkart voucher for shopping', cardCat:null }
    ],
    bankRequired:'HDFC',
    tip:'Same 10x multiplier as Amazon voucher route. Infinia/Diners Black ~33%.',
    notes:'Only for HDFC card holders.'
  },
  { id:'smartbuy-flights', name:'HDFC SmartBuy \u2192 Flight Booking',
    purchaseTypes:['flight_booking'],
    steps:[
      { label:'Book flight via HDFC SmartBuy portal', cardCat:'_smartbuy' }
    ],
    bankRequired:'HDFC',
    tip:'Infinia/Diners Black: ~33% effective via 10x points. Even Regalia gets ~13%.',
    notes:'Only for HDFC card holders. SmartBuy partners: EaseMyTrip, Cleartrip etc.'
  },
  { id:'smartbuy-hotels', name:'HDFC SmartBuy \u2192 Hotel Booking',
    purchaseTypes:['hotel_booking'],
    steps:[
      { label:'Book hotel via HDFC SmartBuy portal', cardCat:'_smartbuy' }
    ],
    bankRequired:'HDFC',
    tip:'10x reward points on SmartBuy hotel bookings with premium HDFC cards.',
    notes:'Only for HDFC card holders.'
  },
  { id:'smartbuy-trains', name:'HDFC SmartBuy \u2192 Train Booking',
    purchaseTypes:['train_irctc'],
    steps:[
      { label:'Book train via HDFC SmartBuy IRCTC', cardCat:'_smartbuy' }
    ],
    bankRequired:'HDFC',
    tip:'SmartBuy has IRCTC integration. 10x points for Infinia/Diners Black.',
    notes:'Only for HDFC card holders.'
  },

  // --- Tata Neu ecosystem ---
  { id:'tataneu-bigbasket', name:'Tata Neu App \u2192 BigBasket',
    purchaseTypes:['grocery_bigbasket'],
    steps:[
      { label:'Order BigBasket via Tata Neu app', cardCat:'online' },
      { label:'Earn NeuCoins from Tata Neu platform (+1%)', cardCat:null, platformBonus:1 }
    ],
    tip:'HDFC Tata Neu Infinity card gives 5% NeuCoins on all Tata ecosystem purchases via this app.',
    notes:'~1% additional NeuCoins from Tata Neu platform. Best with HDFC Tata Neu cards.'
  },
  { id:'tataneu-croma', name:'Tata Neu App \u2192 Croma',
    purchaseTypes:['croma_shopping'],
    steps:[
      { label:'Order on Croma via Tata Neu app', cardCat:'online' },
      { label:'Earn NeuCoins from Tata Neu platform (+1%)', cardCat:null, platformBonus:1 }
    ],
    tip:'HDFC Tata Neu Infinity gives 5% on Croma via Tata Neu.',
    notes:'~1% additional NeuCoins from platform.'
  },

  // --- PhonePe / Google Pay routes ---
  { id:'phonpe-bills', name:'Pay via PhonePe (Credit Card on UPI)',
    purchaseTypes:['mobile_recharge','electricity_bill','dth_recharge','broadband_bill','water_bill','lpg_cylinder'],
    steps:[
      { label:'Pay bill/recharge on PhonePe using credit card', cardCat:'utilities' }
    ],
    tip:'Axis ACE gives 5% on all utility bills paid via PhonePe/Google Pay. Check if your card supports CC on UPI.',
    notes:'RuPay cards can be linked to UPI directly. Visa/Mastercard CC on UPI support expanding.'
  },
  { id:'gpay-bills', name:'Pay via Google Pay (Credit Card)',
    purchaseTypes:['mobile_recharge','electricity_bill','dth_recharge','broadband_bill','water_bill'],
    steps:[
      { label:'Pay bill/recharge on Google Pay using credit card', cardCat:'utilities' }
    ],
    tip:'Axis ACE & Axis Google Pay cards give enhanced rewards on Google Pay. Google Pay occasionally offers scratch cards.',
    notes:'Check CC on UPI availability with your bank.'
  },

  // --- Airtel Thanks ---
  { id:'airtel-recharge', name:'Airtel Thanks App \u2192 Recharge',
    purchaseTypes:['mobile_recharge','dth_recharge','broadband_bill'],
    steps:[
      { label:'Pay via Airtel Thanks app using credit card', cardCat:'utilities' }
    ],
    tip:'Axis Airtel card gives 25% on Airtel recharges and 10% on utility bills via Airtel Thanks. Only for Airtel subscribers.',
    notes:'Best with Axis Airtel card. Other cards get standard utility rate.'
  },

  // --- Platform-specific travel ---
  { id:'cleartrip-flights', name:'Cleartrip \u2192 Flight Booking',
    purchaseTypes:['flight_booking'],
    steps:[
      { label:'Book flight on Cleartrip using credit card', cardCat:'travel' }
    ],
    tip:'Flipkart SBI card gives 5% on Cleartrip. Axis Flipkart also gives enhanced rates.',
    notes:'Cleartrip is Flipkart-owned.'
  },
  { id:'easemytrip-flights', name:'EaseMyTrip \u2192 Flight Booking',
    purchaseTypes:['flight_booking'],
    steps:[
      { label:'Book flight on EaseMyTrip using credit card', cardCat:'travel' }
    ],
    tip:'SC EaseMyTrip card gives ~5% on EaseMyTrip bookings.',
    notes:'Good for Standard Chartered EaseMyTrip card holders.'
  },
  { id:'irctc-direct', name:'IRCTC Direct \u2192 Train Ticket',
    purchaseTypes:['train_irctc'],
    steps:[
      { label:'Book on IRCTC using credit card', cardCat:'travel' }
    ],
    tip:'SBI IRCTC Premier gives 10% value back on AC classes. HDFC IRCTC RuPay gives 5%.',
    notes:'IRCTC charges ₹15-30 convenience fee per transaction.'
  },

  // --- Rent payment (with fees) ---
  { id:'cred-rent', name:'CRED RentPay \u2192 Rent',
    purchaseTypes:['rent_payment'],
    steps:[
      { label:'Pay rent via CRED RentPay', cardCat:'general', feePercent:2 }
    ],
    tip:'Only worth it if your card\'s general rate > 2% platform fee. CRED also offers cashback/coins occasionally.',
    notes:'Platform charges ~2% fee. Net reward = card rate - 2%. Many cards exclude rent from rewards.'
  },
  { id:'nobroker-rent', name:'NoBroker Pay \u2192 Rent',
    purchaseTypes:['rent_payment'],
    steps:[
      { label:'Pay rent via NoBroker', cardCat:'general', feePercent:1.5 }
    ],
    tip:'Slightly lower fee than CRED. Ensure your card gives rewards on rent transactions.',
    notes:'Platform charges ~1.5% fee. Net reward = card rate - 1.5%.'
  },

  // --- Nykaa via Amazon ---
  { id:'amazon-gc-nykaa', name:'Nykaa GC via Amazon \u2192 Nykaa',
    purchaseTypes:['nykaa_shopping'],
    steps:[
      { label:'Buy Nykaa Gift Card on Amazon.in', cardCat:'online' },
      { label:'Shop on Nykaa using GC', cardCat:null }
    ],
    tip:'Amex SmartEarn gives 10x on Nykaa directly (~5%). Compare with GC route.',
    notes:'Nykaa GCs available on Amazon.'
  },

  // --- Scapia travel ---
  { id:'scapia-travel', name:'Scapia App \u2192 Travel Booking',
    purchaseTypes:['flight_booking','hotel_booking'],
    steps:[
      { label:'Book via Scapia app using Scapia Federal card', cardCat:'travel' }
    ],
    tip:'Scapia Federal gives 4% on travel via Scapia app (vs 2% elsewhere). Zero forex markup.',
    notes:'Only for Scapia Federal Bank card holders.'
  },

  // ===== UPI ROUTES (RuPay CC on UPI + CC on UPI) =====

  // --- RuPay CC on UPI: offline merchants ---
  { id:'rupay-upi-offline', name:'RuPay CC on UPI \u2192 Offline Store Payment',
    purchaseTypes:['grocery_offline','restaurant','general_purchase'],
    networkRequired:'RuPay',
    steps:[
      { label:'Pay via UPI QR using RuPay credit card linked to PhonePe/GPay', cardCat:'general' }
    ],
    tip:'RuPay credit cards work on UPI at any QR code merchant. Earn card rewards even at small shops that don\'t accept card swipes.',
    notes:'Link RuPay CC to PhonePe, Google Pay, CRED, or Paytm. Card\'s general/category rate applies. NPCI occasionally runs RuPay UPI cashback schemes.'
  },
  { id:'rupay-upi-grocery', name:'RuPay CC on UPI \u2192 Grocery Store',
    purchaseTypes:['grocery_offline'],
    networkRequired:'RuPay',
    steps:[
      { label:'Pay at grocery store via UPI QR using RuPay CC', cardCat:'groceries' }
    ],
    tip:'Works at kirana stores, supermarkets, any UPI QR. Your card\'s grocery rate applies even at shops that don\'t have a POS machine.',
    notes:'RuPay CC on UPI supported on PhonePe, Google Pay, CRED, Paytm.'
  },
  { id:'rupay-upi-dining', name:'RuPay CC on UPI \u2192 Restaurant',
    purchaseTypes:['restaurant'],
    networkRequired:'RuPay',
    steps:[
      { label:'Pay at restaurant via UPI QR using RuPay CC', cardCat:'dining' }
    ],
    tip:'Earn dining rewards at restaurants that only accept UPI. Card\'s dining rate applies.',
    notes:'RuPay CC on UPI accepted at all UPI QR merchants.'
  },
  { id:'rupay-upi-fuel', name:'RuPay CC on UPI \u2192 Fuel Station',
    purchaseTypes:['fuel_indianoil','fuel_hpcl','fuel_bpcl'],
    networkRequired:'RuPay',
    steps:[
      { label:'Pay at fuel station via UPI using RuPay CC', cardCat:'fuel' }
    ],
    tip:'Pay at any fuel station UPI QR. Avoids fuel surcharge that applies on card swipe. Card\'s fuel rate applies.',
    notes:'UPI payment avoids the 1% fuel surcharge (up to ₹500-1000 cap) charged on POS swipe. Net saving could be higher.'
  },

  // --- RuPay CC on UPI: bills & recharges ---
  { id:'rupay-upi-recharge', name:'RuPay CC on UPI \u2192 Recharge/Bills',
    purchaseTypes:['mobile_recharge','electricity_bill','dth_recharge','broadband_bill','water_bill','lpg_cylinder'],
    networkRequired:'RuPay',
    steps:[
      { label:'Pay bill/recharge via PhonePe/GPay using RuPay CC on UPI', cardCat:'utilities' }
    ],
    tip:'RuPay CC on UPI works seamlessly for bill payments on PhonePe, Google Pay, Paytm. Same card rewards as POS/online.',
    notes:'NPCI sometimes runs additional cashback for RuPay CC on UPI transactions (₹50-150/month). Check npci.org.in for active offers.'
  },

  // --- RuPay CC on UPI: online shopping ---
  { id:'rupay-upi-online', name:'RuPay CC on UPI \u2192 Online Shopping',
    purchaseTypes:['amazon_shopping','flipkart_shopping','myntra_shopping','other_online','food_swiggy','food_zomato','grocery_bigbasket','grocery_blinkit','swiggy_instamart'],
    networkRequired:'RuPay',
    steps:[
      { label:'Pay online using UPI with RuPay CC linked', cardCat:'online' }
    ],
    tip:'Select UPI as payment method on Amazon/Flipkart/Swiggy/Zomato and pay with RuPay CC linked to your UPI app. Card\'s online rate applies.',
    notes:'Many online merchants offer UPI-specific discounts that stack with your card rewards. RuPay CC on UPI is widely accepted.'
  },

  // --- CC on UPI (general - Visa/MC/RuPay where supported) ---
  { id:'cc-upi-bills', name:'CC on UPI \u2192 Bill Payment',
    purchaseTypes:['mobile_recharge','electricity_bill','dth_recharge','broadband_bill','water_bill','lpg_cylinder'],
    steps:[
      { label:'Pay bill on PhonePe/GPay using credit card via UPI', cardCat:'utilities' }
    ],
    tip:'Credit card on UPI now supports Visa/Mastercard on select banks (Axis, HDFC, ICICI, Kotak etc.) in addition to RuPay. Check your bank\'s support.',
    notes:'CC on UPI expanding: RuPay (full support), Visa/MC (Axis, HDFC, ICICI, Kotak, SBI). Merchant must support UPI autopay or CC-on-UPI.'
  },
  { id:'cc-upi-offline', name:'CC on UPI \u2192 Offline Merchant',
    purchaseTypes:['grocery_offline','restaurant','general_purchase'],
    steps:[
      { label:'Pay at UPI QR merchant using credit card on UPI', cardCat:'general' }
    ],
    tip:'Earn card rewards at UPI-only merchants. Visa/MC CC on UPI rolling out on Axis, HDFC, ICICI, Kotak banks.',
    notes:'Check if your bank supports CC on UPI for your card network. RuPay has widest support.'
  },

  // --- NPCI RuPay cashback route ---
  { id:'rupay-npci-cashback', name:'RuPay UPI + NPCI Cashback Scheme',
    purchaseTypes:['mobile_recharge','electricity_bill','dth_recharge','grocery_offline','restaurant','general_purchase','fuel_indianoil','fuel_hpcl','fuel_bpcl'],
    networkRequired:'RuPay',
    steps:[
      { label:'Pay via RuPay CC on UPI', cardCat:'_inherit' },
      { label:'NPCI RuPay UPI cashback (when active)', cardCat:null, platformBonus:0.5 }
    ],
    tip:'NPCI periodically runs RuPay credit card on UPI promotional cashback of ₹50-150/month. Check current offers on npci.org.in or your UPI app.',
    notes:'Estimated ~0.5% average platform bonus when NPCI scheme is active. Varies by period — verify current offer before relying on this.'
  },

  // ===== FUEL LOYALTY PROGRAMS =====
  { id:'hppay-fuel', name:'HP Pay App → HPCL Fuel',
    purchaseTypes:['fuel_hpcl'],
    steps:[
      { label:'Pay for fuel at HPCL via HP Pay app using credit card', cardCat:'fuel_hpcl' },
      { label:'HP Pay loyalty points + fuel surcharge waiver (~1%)', cardCat:null, platformBonus:1 }
    ],
    tip:'HP Pay avoids the 1% fuel surcharge charged on POS card swipe. Additional HP Pay loyalty rewards and seasonal cashback offers from the app.',
    notes:'Link your CC to HP Pay. Surcharge of ~1% (up to ₹500) is avoided on UPI/app payments vs POS swipe. HP Pay often has bank-specific fuel cashback promotions.'
  },
  { id:'iocl-xtrarewards', name:'IndianOil XTRA Rewards → IOCL Fuel',
    purchaseTypes:['fuel_indianoil'],
    steps:[
      { label:'Pay at IndianOil and earn XTRA Rewards with linked card', cardCat:'fuel_indianoil' },
      { label:'XTRA Rewards loyalty points (~0.75%)', cardCat:null, platformBonus:0.75 }
    ],
    tip:'Register your card on IndianOil XTRA Rewards app to earn additional loyalty points on every fuel purchase, stacked with card rewards.',
    notes:'IndianOil XTRA Rewards: 1 point per ₹100 fuel spend. Points redeemable for fuel. Free to join. Also gives birthday/anniversary bonus points.'
  },
  { id:'bpcl-smartdrive', name:'BPCL SmartDrive → BPCL Fuel',
    purchaseTypes:['fuel_bpcl'],
    steps:[
      { label:'Pay at BPCL station with SmartDrive linked card', cardCat:'fuel_bpcl' },
      { label:'BPCL SmartDrive loyalty points (~1%)', cardCat:null, platformBonus:1 }
    ],
    tip:'BPCL SmartDrive gives ~1% back as loyalty points on fuel. SBI BPCL card holders get 13x reward points at BPCL (~4.3% effective). Stack loyalty with card rewards.',
    notes:'Free to join BPCL SmartDrive. Points redeemable for fuel and merchandise. SBI BPCL card is the best pairing for BPCL fuel.'
  },

  // ===== DINING PLATFORM ROUTES =====
  { id:'eazydiner-restaurant', name:'EazyDiner → Restaurant Dining',
    purchaseTypes:['restaurant'],
    steps:[
      { label:'Book restaurant via EazyDiner app, pay with card', cardCat:'dining' },
      { label:'EazyDiner bill discount (~15% avg)', cardCat:null, platformBonus:15 }
    ],
    tip:'EazyDiner offers 10-40% off at 5,000+ partner restaurants. IndusInd EazyDiner card includes free EazyDiner Prime (up to 50% off). HDFC Diners Privilege/Black get enhanced EazyDiner offers.',
    notes:'Discount varies by restaurant (10-40%). EazyDiner Prime: ₹1,199/yr (free with IndusInd EazyDiner card). Card rewards earned on the discounted amount actually paid. Available in 20+ cities.'
  },
  { id:'swiggy-dineout', name:'Swiggy Dineout → Restaurant Dining',
    purchaseTypes:['restaurant'],
    steps:[
      { label:'Book restaurant via Swiggy Dineout, pay with card', cardCat:'dining' },
      { label:'Swiggy Dineout bill discount (~10% avg)', cardCat:null, platformBonus:10 }
    ],
    tip:'Swiggy Dineout offers 10-40% off at partner restaurants. HDFC Swiggy card holders get extra Dineout benefits. Swiggy One members get enhanced discounts.',
    notes:'Discount varies by restaurant (10-40%). Card rewards earned on amount actually paid. Available in 35+ cities. Pro tip: stack with bank offers visible on the Swiggy app.'
  },
  { id:'dineout-restaurant', name:'Dineout (Times Prime) → Restaurant',
    purchaseTypes:['restaurant'],
    steps:[
      { label:'Book restaurant via Dineout app, pay with card', cardCat:'dining' },
      { label:'Dineout bill discount (~10% avg)', cardCat:null, platformBonus:10 }
    ],
    tip:'Dineout (by Times Internet) offers 10-30% off at partner restaurants. Times Prime members get additional perks and higher discounts.',
    notes:'Dineout Passport gives flat 25% off at select premium restaurants. Card rewards earned on actual amount paid.'
  },
  { id:'magicpin-restaurant', name:'magicpin → Restaurant Dining',
    purchaseTypes:['restaurant'],
    steps:[
      { label:'Pay at restaurant via magicpin, use card on UPI', cardCat:'dining' },
      { label:'magicpin cashback rewards (~8% avg)', cardCat:null, platformBonus:8 }
    ],
    tip:'magicpin gives cashback as magicpin credits (usable at other merchants) when you pay at partner restaurants. Works via UPI — link your CC to UPI for card rewards too.',
    notes:'Cashback varies 5-15% across restaurants. Credits valid for 30 days. Works at offline restaurants with UPI QR. Stack with CC on UPI rewards.'
  },

  // ===== HOTEL & TRAVEL PLATFORM ROUTES =====
  { id:'accor-hotels', name:'Accor ALL → Hotel Booking',
    purchaseTypes:['hotel_booking'],
    steps:[
      { label:'Book hotel on ALL.com / Accor app with card', cardCat:'travel' },
      { label:'Accor ALL loyalty points + member rates (~5%)', cardCat:null, platformBonus:5 }
    ],
    tip:'Accor ALL loyalty: ~5% back as points. HDFC Diners Black includes complimentary Accor Plus membership (50% off dining at Accor hotels, 1 free night/year). Always book directly on ALL.com for loyalty points.',
    notes:'Accor brands: Ibis, Novotel, Pullman, Sofitel, Mercure, Fairmont. Accor Plus (₹15,000/yr) is free with HDFC Diners Black. Points redeemable for stays. Member-only rates typically 5-10% lower.'
  },
  { id:'marriott-hotels', name:'Marriott Bonvoy → Hotel Booking',
    purchaseTypes:['hotel_booking'],
    steps:[
      { label:'Book directly on Marriott.com with card', cardCat:'travel' },
      { label:'Marriott Bonvoy loyalty points (~5%)', cardCat:null, platformBonus:5 }
    ],
    tip:'HDFC Marriott Bonvoy card earns enhanced Bonvoy points on stays. Bonvoy Elite members get free upgrades, late checkout, breakfast. HDFC Regalia Gold milestones give Marriott/Taj vouchers. Book directly for best loyalty earning.',
    notes:'Marriott Bonvoy points: ~₹0.7-1/point. 30+ brands (JW Marriott, Sheraton, Westin, Le Meridien, W etc). Gold/Platinum Elite unlocks serious perks. Always book via Marriott.com, not OTAs.'
  },
  { id:'taj-hotels', name:'Taj/IHCL Direct → Hotel Booking',
    purchaseTypes:['hotel_booking'],
    steps:[
      { label:'Book on Taj website/app with card', cardCat:'travel' },
      { label:'Taj InnerCircle / NeuCoins loyalty (~4%)', cardCat:null, platformBonus:4 }
    ],
    tip:'HDFC Regalia Gold milestone vouchers (₹1,500-5,000) are redeemable at Taj properties. Taj InnerCircle members earn NeuCoins on stays. Book directly on tajhotels.com for loyalty benefits.',
    notes:'Taj InnerCircle Gold+ members get complimentary upgrades and late checkout. Tata Neu integration means NeuCoins earned are usable across Tata ecosystem (BigBasket, Croma, 1mg etc).'
  },
  { id:'itc-hotels', name:'ITC Hotels Direct → Hotel Booking',
    purchaseTypes:['hotel_booking'],
    steps:[
      { label:'Book on ITC Hotels website with card', cardCat:'travel' },
      { label:'ITC WelcomRewards loyalty (~3%)', cardCat:null, platformBonus:3 }
    ],
    tip:'ITC WelcomRewards program gives loyalty points on direct bookings. Book on itchotels.com for best rate guarantee and loyalty earning.',
    notes:'ITC hotel brands: ITC Grand, WelcomHotel, Mementos, Storii. Loyalty points redeemable for stays and dining at ITC properties.'
  },
  { id:'mmt-flights', name:'MakeMyTrip → Flight Booking',
    purchaseTypes:['flight_booking'],
    steps:[
      { label:'Book flight on MakeMyTrip using credit card', cardCat:'travel' },
      { label:'MMT rewards + bank offers (~2%)', cardCat:null, platformBonus:2 }
    ],
    tip:'ICICI MakeMyTrip card gives ~5% on MMT bookings. MMT regularly runs bank-specific instant discount offers (₹500-2,000 off). Check active bank offers on MMT before booking.',
    notes:'MMT MyRewards loyalty gives additional cashback. ICICI, HDFC, SBI, Axis frequently have active MMT promotions. MMT myBiz for business travel perks.'
  },
  { id:'mmt-hotels', name:'MakeMyTrip → Hotel Booking',
    purchaseTypes:['hotel_booking'],
    steps:[
      { label:'Book hotel on MakeMyTrip using credit card', cardCat:'travel' },
      { label:'MMT rewards + bank offers (~2%)', cardCat:null, platformBonus:2 }
    ],
    tip:'MMT hotel bookings stack bank offers with MMT loyalty rewards. Compare with direct hotel loyalty programs (Marriott, Taj, Accor) which give better long-term value.',
    notes:'OTA booking means no hotel loyalty points. But MMT often has lower prices + bank discounts. Best for one-off bookings at non-chain hotels.'
  },
  { id:'goibibo-flights', name:'Goibibo → Flight Booking',
    purchaseTypes:['flight_booking'],
    steps:[
      { label:'Book flight on Goibibo using credit card', cardCat:'travel' },
      { label:'Goibibo goCash+ rewards (~1.5%)', cardCat:null, platformBonus:1.5 }
    ],
    tip:'Goibibo (MakeMyTrip group) offers goCash+ on bookings. Bank offers often same as MMT. Goibibo Plus members get extra perks.',
    notes:'goCash+ earned on bookings is usable for future Goibibo/MMT bookings. Compare prices across MMT, Goibibo, and ixigo.'
  },
  { id:'goibibo-hotels', name:'Goibibo → Hotel Booking',
    purchaseTypes:['hotel_booking'],
    steps:[
      { label:'Book hotel on Goibibo using credit card', cardCat:'travel' },
      { label:'Goibibo goCash+ rewards (~2%)', cardCat:null, platformBonus:2 }
    ],
    tip:'Goibibo often has competitive hotel rates. goCash+ earned is typically higher on hotels than flights.',
    notes:'Compare rates across MMT, Goibibo, direct hotel websites, and SmartBuy (for HDFC users) for best deal.'
  },
  { id:'ixigo-flights', name:'ixigo → Flight Booking',
    purchaseTypes:['flight_booking'],
    steps:[
      { label:'Book flight on ixigo using credit card', cardCat:'travel' },
      { label:'ixigo money rewards (~1%)', cardCat:null, platformBonus:1 }
    ],
    tip:'ixigo offers fare alerts and price predictions. ixigo money rewards on every booking. Occasionally has exclusive bank offers.',
    notes:'ixigo money can be used for future bookings. Good for price comparison across airlines.'
  },

  // ===== CAB / RIDE ROUTES =====
  { id:'uber-cab', name:'Uber → Cab Ride',
    purchaseTypes:['cab_ride'],
    steps:[
      { label:'Pay for Uber ride using linked credit card', cardCat:'travel' },
      { label:'Uber Pro rewards (~1%)', cardCat:null, platformBonus:1 }
    ],
    tip:'Link your best travel-rate card to Uber. Axis ACE gives 5% on Uber payments via PhonePe. ICICI Coral gives complimentary Uber rides with milestone spend. Uber Pro loyalty tiers give additional ride discounts.',
    notes:'Uber codes as travel for most cards. Check if your card gives enhanced rewards on ride-hailing. RuPay CC on UPI also works on Uber.'
  },
  { id:'ola-cab', name:'Ola → Cab Ride',
    purchaseTypes:['cab_ride'],
    steps:[
      { label:'Pay for Ola ride using linked credit card', cardCat:'travel' },
      { label:'Ola offers (~1%)', cardCat:null, platformBonus:1 }
    ],
    tip:'Link your card to Ola for credit card rewards on rides. SBI cards sometimes have Ola-specific offers. Ola Money postpaid can give additional cashback.',
    notes:'Check Ola app for active bank-specific promotions before riding.'
  },

  // ===== BUS BOOKING ROUTE =====
  { id:'redbus-bus', name:'RedBus → Bus Ticket',
    purchaseTypes:['bus_booking'],
    steps:[
      { label:'Book bus on RedBus using credit card', cardCat:'travel' },
      { label:'RedBus rewards + bank offers (~2%)', cardCat:null, platformBonus:2 }
    ],
    tip:'RedBus frequently runs bank-specific offers (₹100-250 off). SBI, ICICI, HDFC cards often have active RedBus promotions.',
    notes:'Check current bank offers on RedBus before booking. redBus Trip Guarantee adds protection.'
  },

  // ===== ADDITIONAL BILL PAYMENT ROUTES =====
  { id:'paytm-bills', name:'Paytm → Bill Payment',
    purchaseTypes:['mobile_recharge','electricity_bill','dth_recharge','broadband_bill','water_bill','lpg_cylinder'],
    steps:[
      { label:'Pay bill on Paytm using credit card / CC on UPI', cardCat:'utilities' },
      { label:'Paytm cashback offers (~0.5%)', cardCat:null, platformBonus:0.5 }
    ],
    tip:'Paytm runs frequent cashback promotions on bill payments. RuPay CC on UPI works on Paytm. Check active bank offers and Paytm coupons.',
    notes:'Cashback varies by offer period. Paytm supports CC on UPI for RuPay and select Visa/MC banks. Compare with PhonePe and Google Pay.'
  },
  { id:'cred-bills', name:'CRED → Bill Payment',
    purchaseTypes:['electricity_bill','broadband_bill','water_bill'],
    steps:[
      { label:'Pay bill on CRED using credit card', cardCat:'utilities' },
      { label:'CRED cashback / coins (~0.5%)', cardCat:null, platformBonus:0.5 }
    ],
    tip:'CRED gives CRED coins on bill payments (redeemable for cashback/vouchers). CRED occasionally runs flash sales with higher cashback. Premium members get better offers.',
    notes:'CRED coins value varies. Best used during CRED flash sales for 2-5x value. Also useful for discovering new card offers.'
  },

  // ===== TELECOM APP ROUTES =====
  { id:'myjio-recharge', name:'MyJio App \u2192 Jio Recharge',
    purchaseTypes:['mobile_recharge','broadband_bill'],
    steps:[
      { label:'Recharge Jio via MyJio app using credit card', cardCat:'utilities' },
      { label:'MyJio cashback/data bonus offers (~1%)', cardCat:null, platformBonus:1 }
    ],
    tip:'MyJio app frequently offers cashback and bonus data on prepaid recharges. Amex SmartEarn gives 10x on Jio. Check MyJio for active bank offers before recharging.',
    notes:'JioFiber/JioAirFiber broadband also payable via MyJio. Jio bundles OTT subs (JioCinema, Netflix) with annual plans \u2014 often better value than separate subscriptions.'
  },
  { id:'vi-recharge', name:'Vi App \u2192 Vodafone Idea Recharge',
    purchaseTypes:['mobile_recharge'],
    steps:[
      { label:'Recharge Vi number via Vi app using credit card', cardCat:'utilities' },
      { label:'Vi app recharge cashback offers (~0.5%)', cardCat:null, platformBonus:0.5 }
    ],
    tip:'Vi app runs cashback/coupon offers on prepaid recharges. Check Vi app offers section and active bank discount coupons.',
    notes:'Vi postpaid bills also payable via the app. Limited bank offer partnerships compared to Airtel/Jio.'
  },

  // ===== ADDITIONAL BILL PAYMENT / FINTECH PLATFORMS =====
  { id:'freecharge-bills', name:'Freecharge \u2192 Bill Payment',
    purchaseTypes:['mobile_recharge','electricity_bill','dth_recharge','broadband_bill','water_bill'],
    steps:[
      { label:'Pay bill on Freecharge using credit card', cardCat:'utilities' },
      { label:'Freecharge cashback deals (~1%)', cardCat:null, platformBonus:1 }
    ],
    tip:'Freecharge is owned by Axis Bank \u2014 Axis cards frequently get exclusive 5-10% cashback on Freecharge. Non-Axis cards also get standard cashback offers.',
    notes:'Check Freecharge coupons section before paying. Axis ACE 5% stacks with Freecharge cashback. Supports direct credit card payments.'
  },
  { id:'mobikwik-bills', name:'Mobikwik \u2192 Bill Payment',
    purchaseTypes:['mobile_recharge','electricity_bill','dth_recharge','broadband_bill','water_bill','lpg_cylinder'],
    steps:[
      { label:'Pay bill on Mobikwik using credit card', cardCat:'utilities' },
      { label:'Mobikwik SuperCash rewards (~1%)', cardCat:null, platformBonus:1 }
    ],
    tip:'Mobikwik gives SuperCash rewards on bill payments (redeemable up to 10% of next txn). Mobikwik ZIP (BNPL) also earns SuperCash on purchases.',
    notes:'SuperCash has per-txn usage limits. Check active offers in Mobikwik app. Supports CC on UPI for RuPay cards.'
  },
  { id:'amazon-pay-bills', name:'Amazon Pay \u2192 Direct Bill Payment',
    purchaseTypes:['mobile_recharge','electricity_bill','dth_recharge','broadband_bill','water_bill','lpg_cylinder','insurance_premium'],
    steps:[
      { label:'Pay bill directly via Amazon Pay using credit card', cardCat:'utilities' },
      { label:'Amazon Pay cashback offers (~1%)', cardCat:null, platformBonus:1 }
    ],
    tip:'ICICI Amazon Pay card gives 2% on bill payments (vs 1% elsewhere). Amazon frequently runs bill payment cashback offers (\u20b910-50). Check Amazon Pay > Offers tab.',
    notes:'Different from Amazon GC route \u2014 this is direct bill payment on Amazon. ICICI Amazon Pay 2% applies here. Compare with GC route (online rate) for best value.'
  },

  // ===== FASTag ROUTE =====
  { id:'fastag-apps', name:'FASTag Recharge via Payment Apps',
    purchaseTypes:['fastag_recharge'],
    steps:[
      { label:'Recharge FASTag via Paytm/PhonePe/GPay/bank app using CC', cardCat:'utilities' },
      { label:'App-specific FASTag cashback offers (~0.5%)', cardCat:null, platformBonus:0.5 }
    ],
    tip:'Paytm, PhonePe, Google Pay all support FASTag recharge via credit card. Paytm often runs FASTag-specific cashback. Axis ACE 5% applies on FASTag recharge via PhonePe/GPay.',
    notes:'FASTag codes as utility payment. RuPay CC on UPI works for FASTag recharge. Bank FASTag apps (HDFC/ICICI/SBI) may also give loyalty points.'
  },

  // ===== INSURANCE PLATFORM ROUTES =====
  { id:'policybazaar-insurance', name:'PolicyBazaar \u2192 Insurance Premium',
    purchaseTypes:['insurance_premium'],
    steps:[
      { label:'Buy/renew insurance on PolicyBazaar using credit card', cardCat:'utilities' },
      { label:'PolicyBazaar gift card/cashback offers (~1%)', cardCat:null, platformBonus:1 }
    ],
    tip:'PolicyBazaar offers Amazon/Flipkart gift cards on insurance purchases. Compare quotes across insurers. Scapia Federal gives rare 2% on insurance. HDFC SmartBuy Amazon GC route may beat direct payment.',
    notes:'Health, motor, term life, travel insurance available. Cashback typically as gift vouchers. Compare with HDFC SmartBuy \u2192 Amazon GC \u2192 pay insurance on Amazon route.'
  },
  { id:'acko-insurance', name:'Acko \u2192 Insurance (Direct-to-Consumer)',
    purchaseTypes:['insurance_premium'],
    steps:[
      { label:'Buy Acko insurance directly using credit card', cardCat:'utilities' },
      { label:'Acko savings \u2014 no agent commission (~3%)', cardCat:null, platformBonus:3 }
    ],
    tip:'Acko is direct-to-consumer \u2014 typically 10-15% cheaper premiums than traditional insurers (no agent commission). Pay with credit card for additional rewards.',
    notes:'Acko offers car, bike, health, and travel insurance. Lower premiums by cutting agent middleman. Compare with PolicyBazaar quotes.'
  },
  { id:'digit-insurance', name:'Go Digit \u2192 Insurance Premium',
    purchaseTypes:['insurance_premium'],
    steps:[
      { label:'Buy Digit insurance using credit card', cardCat:'utilities' },
      { label:'Digit competitive pricing (~2%)', cardCat:null, platformBonus:2 }
    ],
    tip:'Go Digit offers competitively priced motor and health insurance with fast claims. Direct online purchase avoids agent fees.',
    notes:'Digit Insurance: known for simple claims process. Motor, health, travel, and property insurance. Compare with Acko and PolicyBazaar for best rate.'
  },

  // ===== ENTERTAINMENT DIRECT ROUTES =====
  { id:'bms-direct', name:'BookMyShow \u2192 Movie Tickets (Direct)',
    purchaseTypes:['movie_tickets'],
    steps:[
      { label:'Book movie tickets on BookMyShow using credit card', cardCat:'entertainment' },
      { label:'BookMyShow bank BOGO/discount offers (~10%)', cardCat:null, platformBonus:10 }
    ],
    tip:'BOGO: HDFC Diners Privilege (2 free/mo), ICICI Coral (BOGO on \u20b925K spend/qtr), SBI ELITE (2 free/mo). Amex SmartEarn & SBI SimplyClick give 10x on BMS. Check BMS Offers tab for active bank deals.',
    notes:'Bank BOGO = ~50% off on 2 tickets. 10% shown as conservative average across all users. Also check Bajaj RBL World Prime (BOGO 2x/mo on BMS). BMS convenience fee earns card rewards.'
  },
  { id:'pvr-inox-direct', name:'PVR INOX \u2192 Movie Tickets',
    purchaseTypes:['movie_tickets'],
    steps:[
      { label:'Book movie at PVR INOX website/app using credit card', cardCat:'entertainment' },
      { label:'PVR INOX bank offers + F&B deals (~8%)', cardCat:null, platformBonus:8 }
    ],
    tip:'Kotak PVR: 2 free tickets/mo + 15% F&B cashback. Axis Flipkart gives 4% at PVR. SBI cards often have PVR BOGO. Check PVR Privilege/Passport for loyalty points.',
    notes:'PVR INOX Passport loyalty program gives free tickets on points. Multiple bank BOGO tie-ups. Buy F&B combos for best value. Kotak PVR is the king of movie cards.'
  },

  // ===== FOOD DELIVERY MEMBERSHIP ROUTES =====
  { id:'swiggy-one-food', name:'Swiggy One \u2192 Swiggy Food Delivery',
    purchaseTypes:['food_swiggy','swiggy_instamart'],
    steps:[
      { label:'Order on Swiggy with Swiggy One membership using card', cardCat:'dining' },
      { label:'Swiggy One free delivery + extra discounts (~5%)', cardCat:null, platformBonus:5 }
    ],
    tip:'Swiggy One saves \u20b930-60/order on delivery + extra restaurant discounts. HDFC Diners Black includes complimentary Swiggy One. HDFC Swiggy card gives 10% on all Swiggy orders (cap \u20b91,500/mo).',
    notes:'Swiggy One: \u20b9149/3mo or \u20b9399/year. Free delivery on orders above \u20b9149. Extra discounts on restaurants and Instamart. Well worth it for 3+ orders/month.'
  },
  { id:'zomato-gold-food', name:'Zomato Gold \u2192 Zomato Food Delivery',
    purchaseTypes:['food_zomato'],
    steps:[
      { label:'Order on Zomato with Zomato Gold membership using card', cardCat:'dining' },
      { label:'Zomato Gold free delivery + discounts (~5%)', cardCat:null, platformBonus:5 }
    ],
    tip:'Zomato Gold: free delivery, extra discounts, priority support. HDFC Diners Privilege gives 6.67% on Zomato orders. Stack membership savings with card dining rewards.',
    notes:'Zomato Gold: \u20b9149/3mo or \u20b9399/year. Free delivery on orders above \u20b9149. 5-20% extra off at select restaurants. Similar value to Swiggy One.'
  },

  // ===== DINING PLATFORMS (additional) =====
  { id:'zomato-dining-out', name:'Zomato Pay \u2192 Restaurant Dining',
    purchaseTypes:['restaurant'],
    steps:[
      { label:'Pay at restaurant via Zomato Pay (scan QR in Zomato app)', cardCat:'dining' },
      { label:'Zomato Pay cashback credits (~10%)', cardCat:null, platformBonus:10 }
    ],
    tip:'Zomato Pay gives Zomato credits (~10%) when paying at partner restaurants via QR scan. Credits usable on next Zomato order. Stack with card dining rewards.',
    notes:'Zomato Pay at partner restaurants only. Scan QR at restaurant to pay via Zomato app. Credits expire in 7 days. Zomato Gold members may get higher cashback.'
  },

  // ===== QUICK COMMERCE / GROCERY APPS =====
  { id:'zepto-grocery', name:'Zepto \u2192 Quick Commerce Grocery',
    purchaseTypes:['grocery_blinkit'],
    steps:[
      { label:'Order groceries on Zepto using credit card', cardCat:'groceries' },
      { label:'Zepto bank offers + Zepto Pass savings (~3%)', cardCat:null, platformBonus:3 }
    ],
    tip:'Zepto frequently runs bank card offers (\u20b950-100 off). HDFC, ICICI, Axis cards often have active Zepto promotions. Zepto Pass: free delivery + extra discounts.',
    notes:'10-minute delivery. Bank offers are seasonal but frequent. Zepto Pass (from \u20b929/mo) gives free delivery and extra discounts. Kotak Cashback+ gives 5% on food delivery.'
  },
  { id:'blinkit-grocery', name:'Blinkit \u2192 Quick Commerce Grocery',
    purchaseTypes:['grocery_blinkit'],
    steps:[
      { label:'Order on Blinkit using credit card', cardCat:'groceries' },
      { label:'Blinkit bank offers + Zomato Gold benefits (~2%)', cardCat:null, platformBonus:2 }
    ],
    tip:'Blinkit (Zomato-owned) gives additional discounts to Zomato Gold members. HDFC, SBI, ICICI often have active Blinkit bank offers. Check Blinkit payment page for deals.',
    notes:'10-minute delivery in major cities. Zomato Gold membership gives extra Blinkit perks. Bank card offers available seasonally. Card grocery rate applies.'
  },
  { id:'jiomart-grocery', name:'JioMart \u2192 Online Grocery',
    purchaseTypes:['grocery_blinkit'],
    steps:[
      { label:'Order groceries on JioMart using credit card', cardCat:'groceries' },
      { label:'JioMart prices + JioCoins rewards (~2%)', cardCat:null, platformBonus:2 }
    ],
    tip:'JioMart offers competitive grocery prices. JioCoins earned on purchases are redeemable across Jio ecosystem. Amex SmartEarn gives 10x on Jio merchants.',
    notes:'JioMart available via app and WhatsApp ordering. JioCoins add to savings. Bank offers available seasonally. Good alternative to BigBasket/Blinkit.'
  },
  { id:'dmart-ready', name:'DMart Ready \u2192 Grocery',
    purchaseTypes:['grocery_blinkit','grocery_offline'],
    steps:[
      { label:'Order on DMart Ready (online), pay with credit card', cardCat:'groceries' },
      { label:'DMart everyday low pricing (~5% cheaper vs others)', cardCat:null, platformBonus:3 }
    ],
    tip:'DMart Ready offers lowest grocery prices (wholesale-style pricing). Order online for pickup at DMart store or slot delivery. Credit card accepted on app.',
    notes:'DMart prices typically 5-15% lower than Blinkit/Zepto/BigBasket. Pickup model saves delivery charges. Limited delivery areas. Best for bulk monthly grocery shopping.'
  },

  // ===== ONLINE SHOPPING PLATFORMS =====
  { id:'tatacliq-shopping', name:'Tata CLiQ \u2192 Online Shopping',
    purchaseTypes:['other_online'],
    steps:[
      { label:'Shop on Tata CLiQ using credit card', cardCat:'online' },
      { label:'Tata CLiQ NeuCoins + bank offers (~2%)', cardCat:null, platformBonus:2 }
    ],
    tip:'HDFC Millennia gives 5% on Tata CLiQ. HDFC Tata Neu Infinity: 5% NeuCoins. Tata CLiQ Luxury for premium brands. NeuCoins usable across Tata ecosystem.',
    notes:'Tata CLiQ is authorized brand store (guaranteed genuine products). NeuCoins redeemable at BigBasket, Croma, 1mg, Westside, Taj. Compare with Amazon/Flipkart for pricing.'
  },
  { id:'ajio-shopping', name:'AJIO \u2192 Fashion Shopping',
    purchaseTypes:['other_online'],
    steps:[
      { label:'Shop on AJIO using credit card', cardCat:'online' },
      { label:'AJIO SuperCoin loyalty + bank offers (~3%)', cardCat:null, platformBonus:3 }
    ],
    tip:'Amex SmartEarn gives 10x on AJIO (~5%). AJIO frequently runs bank card offers (extra 10-15% off). Check AJIO payment page for active bank promotions.',
    notes:'AJIO is Reliance-owned fashion platform. AJIO Luxe for premium brands. Bank offers stack with sale discounts. SuperCoin loyalty program for repeat buyers.'
  },
  { id:'reliance-digital', name:'Reliance Digital \u2192 Electronics',
    purchaseTypes:['croma_shopping','other_online'],
    steps:[
      { label:'Buy electronics on Reliance Digital (online/store) using CC', cardCat:'online' },
      { label:'Reliance Digital bank offers + JioCoins (~2%)', cardCat:null, platformBonus:2 }
    ],
    tip:'HDFC Regalia Gold gives 5x on Reliance Digital. Frequent bank No Cost EMI and instant discount offers. JioCoins earned on purchases. Compare with Croma via Tata Neu.',
    notes:'Reliance Digital: online + 2,000+ offline stores. JioCoins redeemable across Jio ecosystem. Bank card promotions frequent on electronics (\u20b91,000-5,000 off).'
  },
  { id:'nykaa-direct', name:'Nykaa \u2192 Beauty & Wellness',
    purchaseTypes:['nykaa_shopping'],
    steps:[
      { label:'Shop on Nykaa directly using credit card', cardCat:'online' },
      { label:'Nykaa rewards + bank offers (~2%)', cardCat:null, platformBonus:2 }
    ],
    tip:'Amex SmartEarn gives 10x on Nykaa (~5%). HDFC Regalia Gold gives 5x on Nykaa. Nykaa Pink Friday sales offer up to 50% off + bank card instant discounts.',
    notes:'Nykaa Privé loyalty program gives rewards and early access to sales. Bank offers stack with sale prices. Compare with Amazon GC route for online rate arbitrage.'
  },

  // ===== HEALTH / PHARMACY =====
  { id:'1mg-pharmacy', name:'1mg (Tata Health) \u2192 Pharmacy',
    purchaseTypes:['other_online'],
    steps:[
      { label:'Order medicines on 1mg using credit card', cardCat:'online' },
      { label:'1mg discounts + NeuCoins via Tata Neu (~2%)', cardCat:null, platformBonus:2 }
    ],
    tip:'HDFC Tata Neu Infinity gives 5% NeuCoins on 1mg (Tata ecosystem). 1mg offers 15-25% off medicines by default. Order via Tata Neu app for extra NeuCoins.',
    notes:'1mg is part of Tata ecosystem. Prescription medicines, OTC products, lab tests. Order via Tata Neu app for +1% NeuCoins. Card online rate applies.'
  },
  { id:'apollo247-pharmacy', name:'Apollo 24|7 \u2192 Pharmacy & Health',
    purchaseTypes:['other_online'],
    steps:[
      { label:'Order on Apollo 24|7 using credit card', cardCat:'online' },
      { label:'Apollo Circle savings + partner offers (~2%)', cardCat:null, platformBonus:2 }
    ],
    tip:'SBI SimplyClick gives 10x on Apollo 24|7 (~2.5%). Apollo Circle membership gives extra 15-20% off medicines. Doctor teleconsultations also available.',
    notes:'Apollo 24|7 is SBI SimplyClick 10x partner. Circle membership (\u20b9199/3mo): extra discounts on medicines and tests. Lab home collection available.'
  },
  { id:'netmeds-pharmacy', name:'Netmeds \u2192 Pharmacy',
    purchaseTypes:['other_online'],
    steps:[
      { label:'Order medicines on Netmeds using credit card', cardCat:'online' },
      { label:'Netmeds discounts + NeuCoins via Reliance (~1.5%)', cardCat:null, platformBonus:1.5 }
    ],
    tip:'Netmeds (Reliance-owned) offers 15-20% off medicines. Check for bank card cashback offers. Alternative to 1mg and Apollo for medicine orders.',
    notes:'Netmeds is Reliance-owned pharmacy platform. Regular bank card offers. NeuPass/JioCoins loyalty integration. Prescription upload required for Rx medicines.'
  },

  // ===== TRAVEL PLATFORMS =====
  { id:'yatra-flights', name:'Yatra \u2192 Flight Booking',
    purchaseTypes:['flight_booking','hotel_booking'],
    steps:[
      { label:'Book on Yatra.com using credit card', cardCat:'travel' },
      { label:'Yatra eCash rewards + bank offers (~1.5%)', cardCat:null, platformBonus:1.5 }
    ],
    tip:'SBI SimplyClick gives 10x on Yatra (~2.5%). Yatra eCash loyalty gives rewards on bookings. Frequent bank card offers for instant discounts.',
    notes:'Yatra is SBI SimplyClick 10x partner \u2014 best when using SBI SimplyClick. eCash earned on flights and hotels. Compare with MMT/SmartBuy for best price.'
  },
  { id:'rapido-cab', name:'Rapido \u2192 Auto/Bike Ride',
    purchaseTypes:['cab_ride'],
    steps:[
      { label:'Book Rapido ride, pay via UPI with CC linked', cardCat:'travel' },
      { label:'Rapido lower fares + offers (~2%)', cardCat:null, platformBonus:2 }
    ],
    tip:'Rapido is often 20-30% cheaper than Uber/Ola for short distances (auto & bike). Pay via UPI (link CC to UPI app) for card rewards. RuPay CC on UPI works well.',
    notes:'Rapido: auto, bike taxi, and cab rides. Typically the cheapest ride option in most cities. CC on UPI supported for payments. Card travel rate applies.'
  },
  { id:'abhibus-bus', name:'AbhiBus \u2192 Bus Ticket',
    purchaseTypes:['bus_booking'],
    steps:[
      { label:'Book bus on AbhiBus using credit card', cardCat:'travel' },
      { label:'AbhiBus aBucks rewards + bank offers (~1.5%)', cardCat:null, platformBonus:1.5 }
    ],
    tip:'AbhiBus aBucks loyalty rewards on bookings. Bank card offers frequently available. Compare prices with RedBus for best deal.',
    notes:'AbhiBus popular in South India. aBucks redeemable on future bookings. Bank card promotions available seasonally. Card travel rate applies.'
  },
  { id:'confirmtkt-train', name:'ConfirmTkt \u2192 Train Ticket',
    purchaseTypes:['train_irctc'],
    steps:[
      { label:'Book train via ConfirmTkt app using credit card', cardCat:'travel' },
      { label:'ConfirmTkt prediction + offers (~0.5%)', cardCat:null, platformBonus:0.5 }
    ],
    tip:'ConfirmTkt shows confirmation probability for waitlisted tickets. Can auto-book and auto-cancel tickets. Small convenience fee but saves effort.',
    notes:'ConfirmTkt: prediction engine for waitlist confirmation. Auto-booking feature. Compare with direct IRCTC for lowest fee. Card travel rate applies.'
  },

  // ===== RENT PAYMENT (Additional) =====
  { id:'mygate-rent', name:'MyGate Pay \u2192 Rent Payment',
    purchaseTypes:['rent_payment'],
    steps:[
      { label:'Pay rent/maintenance via MyGate using credit card', cardCat:'general', feePercent:1.5 }
    ],
    tip:'MyGate charges ~1.5% platform fee for CC rent payments. Useful if your apartment society already uses MyGate. Covers rent + society maintenance.',
    notes:'Net reward = card rate \u2212 1.5% fee. Only worth it if card general rate exceeds 1.5%. Many apartment societies integrated with MyGate for payments.'
  },
  { id:'payrent-rent', name:'PayRent / Cheq \u2192 Rent Payment',
    purchaseTypes:['rent_payment'],
    steps:[
      { label:'Pay rent via PayRent/Cheq using credit card', cardCat:'general', feePercent:1.75 }
    ],
    tip:'PayRent, Cheq, Red Giraffes are alternative rent payment platforms. Fees range 1.5-2%. Compare across platforms for lowest processing fee.',
    notes:'Net reward = card rate \u2212 platform fee (~1.75%). Compare with CRED (2%), NoBroker (1.5%), MyGate (1.5%). Some offer occasional cashback to reduce effective fee.'
  },

  // ===== BAJAJ FINSERV / EMI =====
  { id:'bajaj-finserv-shopping', name:'Bajaj Finserv \u2192 EMI Shopping',
    purchaseTypes:['other_online','croma_shopping'],
    steps:[
      { label:'Buy on Bajaj Finserv marketplace / No Cost EMI with card', cardCat:'online' },
      { label:'No Cost EMI savings + Bajaj coins (~3%)', cardCat:null, platformBonus:3 }
    ],
    tip:'Bajaj Finserv RBL cards get 5x on partner electronics. No Cost EMI across 1M+ products saves 5-8% in interest. Bajaj marketplace often has exclusive bank instant discounts.',
    notes:'No Cost EMI saves interest effectively. Bajaj coins loyalty program. Wide electronics and lifestyle range. EMI card + credit card combo for max flexibility.'
  },

  // ===== DIGITAL GOLD & INVESTMENT =====
  { id:'digital-gold', name:'Digital Gold via Payment Apps',
    purchaseTypes:['general_purchase'],
    steps:[
      { label:'Buy digital gold on PhonePe/Paytm/GPay using credit card', cardCat:'general' },
      { label:'Gold price appreciation + offers (~0.5%)', cardCat:null, platformBonus:0.5 }
    ],
    tip:'Buy digital gold (24K, 99.9% purity) via PhonePe, Google Pay, Paytm using credit card. Earns card rewards on purchase. Gold backed by Augmont/MMTC-PAMP.',
    notes:'Platform-specific: PhonePe Gold, Google Pay Gold, Paytm Gold. Card general rate applies. Occasional gold-specific cashback offers. Gold redeemable or sellable anytime. Spread: ~3% buy-sell difference.'
  },

  // ===== EDUCATION / EDTECH =====
  { id:'edtech-payments', name:'EdTech \u2192 Course Payment',
    purchaseTypes:['general_purchase','other_online'],
    steps:[
      { label:'Pay for online course (Coursera/Udemy/UpGrad) using CC', cardCat:'online' },
      { label:'EdTech bank offers + platform discounts (~2%)', cardCat:null, platformBonus:2 }
    ],
    tip:'UpGrad, Simplilearn, Great Learning, Coursera, Udemy frequently run bank card EMI offers and instant discounts. No Cost EMI available on premium courses. Card online rate applies.',
    notes:'Education payments generally earn full card rewards (unlike rent/fuel which some cards exclude). Bank No Cost EMI tie-ups frequent on edtech platforms.'
  },
];

// ===================== CARD DB LOADER =====================
// Set this to your GitHub raw URL once hosted, e.g.:
// 'https://raw.githubusercontent.com/YourUsername/cardpick-db/main/cards.json'
const DB_URL = 'https://raw.githubusercontent.com/rinzler-oss/CardPick/main/cards.json';

let DB_VERSION = 'embedded';
let DB_LAST_UPDATED = null;

async function loadCardDB(url) {
  const statusEl = document.getElementById('db-status');
  try {
    const resp = await fetch(url || DB_URL, { cache: 'no-cache' });
    if (!resp.ok) throw new Error('HTTP ' + resp.status);
    const data = await resp.json();
    if (data.cards && data.cards.length > 0) {
      // Replace CARD_DB contents
      CARD_DB.length = 0;
      data.cards.forEach(c => CARD_DB.push(c));
      // Replace SMARTBUY_RATES
      if (data.smartbuyRates) {
        Object.keys(SMARTBUY_RATES).forEach(k => delete SMARTBUY_RATES[k]);
        Object.assign(SMARTBUY_RATES, data.smartbuyRates);
      }
      // Replace APPLY_LINKS
      if (data.applyLinks) {
        Object.keys(APPLY_LINKS).forEach(k => delete APPLY_LINKS[k]);
        Object.assign(APPLY_LINKS, data.applyLinks);
      }
      // Replace ROUTE_TEMPLATES
      if (data.routeTemplates && data.routeTemplates.length > 0) {
        ROUTE_TEMPLATES.length = 0;
        data.routeTemplates.forEach(r => ROUTE_TEMPLATES.push(r));
      }
      DB_VERSION = data.version || '?';
      DB_LAST_UPDATED = data.lastUpdated || null;
      statusEl.innerHTML = '<span class="db-ok">Card DB v' + esc(DB_VERSION) + '</span> &middot; Updated: ' + esc(DB_LAST_UPDATED || 'unknown') + ' &middot; ' + CARD_DB.length + ' cards + ' + ROUTE_TEMPLATES.length + ' routes loaded';
      // Re-populate dropdown if open
      if (searchInput) searchInput.dispatchEvent(new Event('input'));
    } else {
      throw new Error('Empty or invalid card data');
    }
  } catch (e) {
    console.warn('CardDB fetch failed, using embedded data:', e.message);
    statusEl.innerHTML = '<span class="db-warn">Using embedded card data</span> &middot; ' + CARD_DB.length + ' cards &middot; <span style="color:var(--text-3)">Fetch failed: ' + esc(e.message) + '</span>';
  }
}

function refreshCardDB() {
  const statusEl = document.getElementById('db-status');
  statusEl.innerHTML = 'Checking for updates&hellip;';
  loadCardDB().then(() => {
    // Refresh the user's card list display in case DB data changed
    renderCards();
  });
}

// ===================== STATE =====================
let cards = [];
let editingIdx = -1;
let selectedDbCard = null;

function save() { /* no persistence — resets on refresh */ }

// ===================== TABS =====================
document.querySelectorAll('.tab').forEach(t => {
  t.addEventListener('click', () => {
    document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
    document.querySelectorAll('.panel').forEach(x => x.classList.remove('active'));
    t.classList.add('active');
    document.getElementById('panel-' + t.dataset.panel).classList.add('active');
  });
});

// ===================== RENDER CARDS =====================
function renderCards() {
  const list = document.getElementById('cards-list');
  if (cards.length === 0) {
    list.innerHTML = '<div class="empty-state"><div class="icon">&#128179;</div><p>No cards added yet.</p><p style="font-size:0.85rem">Add your credit cards to start comparing rewards.</p></div>';
    return;
  }
  list.innerHTML = cards.map((c, i) => {
    const tags = CATEGORIES.filter(cat => c.rates[cat.key] > 0).map(cat => {
      return '<span class="reward-tag">' + cat.label.split('/')[0].trim() + ' <span>' + c.rates[cat.key] + '%</span></span>';
    }).join('');
    const isDc = isCardDiscontinued(c);
    const dcBadge = isDc ? ' <span class="discontinued-badge">Discontinued</span>' : '';
    const dcNoteText = getDiscontinuedNote(c);
    const dcNote = isDc ? '<div class="discontinued-note">' + esc(dcNoteText || 'This card is discontinued and not open for new applications.') + '</div>' : '';
    return '<div class="card-entry' + (isDc ? ' discontinued' : '') + '">' +
      '<div class="card-color-bar" style="background:' + (c.color || COLORS[0]) + '"></div>' +
      '<div class="card-body">' +
        '<div class="card-header">' +
          '<span class="card-name">' + esc(c.name) + ' <span style="font-size:0.78rem;color:var(--text-3);font-weight:400">' + esc(c.network) + '</span>' + dcBadge + '</span>' +
          '<span>' +
            '<button class="btn btn-danger" onclick="editCard(' + i + ')" style="margin-right:4px;color:var(--blue);border-color:var(--border)">Edit</button>' +
            '<button class="btn btn-danger" onclick="deleteCard(' + i + ')">Delete</button>' +
          '</span>' +
        '</div>' +
        '<div class="card-rewards">' + (tags || '<span style="color:var(--text-3);font-size:0.85rem">No reward rates set</span>') + '</div>' +
        (c.ltf ? '<div class="annual-note" style="color:var(--green)">Lifetime Free</div>' :
          ((c.joiningFee > 0 ? '<div class="annual-note">Joining fee: ' + fmt(c.joiningFee) + '</div>' : '') +
           (c.annualFee > 0 ? '<div class="annual-note">Annual fee: ' + fmt(c.annualFee) + '</div>' : '') +
           (!c.joiningFee && !c.annualFee ? '<div class="annual-note" style="color:var(--green)">Lifetime Free</div>' : ''))) +
        (c.monthlyCap > 0 ? '<div class="annual-note">Monthly reward cap: ' + fmt(c.monthlyCap) + '</div>' : '') +
        dcNote +
        (c.notes ? '<div class="card-notes">' + esc(c.notes) + '</div>' : '') +
        (c.dbId && APPLY_LINKS[c.dbId] ? '<div class="apply-row">' + applyBtn(c.dbId, false) + '<span class="apply-hint">Don\'t have this card yet?</span></div>' : '') +
      '</div>' +
    '</div>';
  }).join('');
}

// ===================== SEARCH DROPDOWN =====================
const searchInput = document.getElementById('card-search');
const dropdown = document.getElementById('card-dropdown');
let highlightedIdx = -1;

// --- Fuzzy search helpers ---
function editDistance(a, b) {
  if (a.length === 0) return b.length;
  if (b.length === 0) return a.length;
  const dp = Array.from({ length: a.length + 1 }, () => new Array(b.length + 1));
  for (let i = 0; i <= a.length; i++) dp[i][0] = i;
  for (let j = 0; j <= b.length; j++) dp[0][j] = j;
  for (let i = 1; i <= a.length; i++) {
    for (let j = 1; j <= b.length; j++) {
      dp[i][j] = a[i - 1] === b[j - 1]
        ? dp[i - 1][j - 1]
        : 1 + Math.min(dp[i - 1][j], dp[i][j - 1], dp[i - 1][j - 1]);
    }
  }
  return dp[a.length][b.length];
}

function fuzzyTokenScore(token, words) {
  // Returns a score: 0 = no match, higher = better match
  let best = 0;
  for (const w of words) {
    // Exact match
    if (w === token) { best = Math.max(best, 100); continue; }
    // Prefix match (e.g. "cash" matches "cashback")
    if (w.startsWith(token)) { best = Math.max(best, 80); continue; }
    // Contains match (e.g. "back" in "cashback")
    if (w.includes(token)) { best = Math.max(best, 60); continue; }
    // Token is prefix of word or word is prefix of token (e.g. "diner" vs "diners")
    if (token.startsWith(w)) { best = Math.max(best, 70); continue; }
    // Fuzzy: edit distance relative to length
    if (token.length >= 3) {
      const maxDist = token.length <= 4 ? 1 : token.length <= 7 ? 2 : 3;
      const dist = editDistance(token, w);
      if (dist <= maxDist) {
        best = Math.max(best, 50 - dist * 10);
        continue;
      }
      // Also check fuzzy against word prefix of same length as token
      if (w.length > token.length) {
        const prefix = w.substring(0, token.length);
        const prefDist = editDistance(token, prefix);
        if (prefDist <= maxDist) {
          best = Math.max(best, 40 - prefDist * 10);
        }
      }
    }
  }
  return best;
}

function scoreCard(card, tokens) {
  const text = (card.name + ' ' + card.bank + ' ' + (card.notes || '')).toLowerCase();
  const words = text.split(/[\s/,.()\-]+/).filter(Boolean);
  let totalScore = 0;
  for (const token of tokens) {
    // Quick check: if the full text contains the token as substring, fast path
    if (text.includes(token)) {
      // Bonus if it's in the name specifically
      totalScore += card.name.toLowerCase().includes(token) ? 90 : 60;
    } else {
      const s = fuzzyTokenScore(token, words);
      if (s === 0) return 0; // All tokens must match
      totalScore += s;
    }
  }
  return totalScore;
}
// --- End fuzzy search helpers ---

searchInput.addEventListener('input', () => {
  const q = searchInput.value.trim().toLowerCase();
  if (q.length === 0) { dropdown.classList.remove('open'); return; }

  const tokens = q.split(/\s+/).filter(Boolean);

  // Score every card and filter non-zero matches
  const scored = [];
  for (const c of CARD_DB) {
    const s = scoreCard(c, tokens);
    if (s > 0) scored.push({ card: c, score: s });
  }
  scored.sort((a, b) => b.score - a.score);
  const matches = scored.map(s => s.card);

  if (matches.length === 0) {
    dropdown.innerHTML = '<div class="search-item"><span class="si-name" style="color:var(--text-3)">No matching cards found</span></div>';
    dropdown.classList.add('open');
    return;
  }

  // Group by bank, preserving relevance order
  const byBank = {};
  const bankOrder = [];
  matches.forEach(c => {
    if (!byBank[c.bank]) { byBank[c.bank] = []; bankOrder.push(c.bank); }
    byBank[c.bank].push(c);
  });

  let html = '';
  for (const bank of bankOrder) {
    html += '<div class="search-divider">' + esc(bank) + '</div>';
    byBank[bank].forEach(c => {
      const topRate = Math.max(...Object.values(c.rates));
      const topCat = CATEGORIES.find(cat => c.rates[cat.key] === topRate);
      const dcBadge = c.discontinued ? '<span class="discontinued-badge">Discontinued</span>' : '';
      html += '<div class="search-item' + (c.discontinued ? ' discontinued' : '') + '" data-id="' + c.id + '">' +
        cardMini(c) +
        '<div class="si-info">' +
          '<div><span class="si-name">' + esc(c.name) + '</span>' +
          dcBadge +
          (c.annualFee === 0 && (c.joiningFee || 0) === 0 && !c.discontinued ? ' <span style="color:var(--green);font-size:0.7rem;font-weight:600">LTF</span>' : '') +
          '</div>' +
          '<div class="si-desc">' + (c.discontinued ? esc(c.discontinuedNote || 'No longer available for new applications') : 'Best: ' + topRate + '% on ' + (topCat ? topCat.label.split('/')[0].trim() : 'N/A') +
          (c.annualFee > 0 ? ' | Fee: &#8377;' + c.annualFee : '')) + '</div>' +
        '</div>' +
      '</div>';
    });
  }

  dropdown.innerHTML = html;
  dropdown.classList.add('open');
  highlightedIdx = -1;

  dropdown.querySelectorAll('.search-item[data-id]').forEach(el => {
    el.addEventListener('click', () => selectDbCard(el.dataset.id));
  });
});

searchInput.addEventListener('keydown', (e) => {
  const items = dropdown.querySelectorAll('.search-item[data-id]');
  if (!items.length) return;
  if (e.key === 'ArrowDown') {
    e.preventDefault();
    highlightedIdx = Math.min(highlightedIdx + 1, items.length - 1);
    items.forEach((el, i) => el.classList.toggle('highlighted', i === highlightedIdx));
    items[highlightedIdx]?.scrollIntoView({ block: 'nearest' });
  } else if (e.key === 'ArrowUp') {
    e.preventDefault();
    highlightedIdx = Math.max(highlightedIdx - 1, 0);
    items.forEach((el, i) => el.classList.toggle('highlighted', i === highlightedIdx));
    items[highlightedIdx]?.scrollIntoView({ block: 'nearest' });
  } else if (e.key === 'Enter') {
    e.preventDefault();
    if (highlightedIdx >= 0 && items[highlightedIdx]) {
      selectDbCard(items[highlightedIdx].dataset.id);
    }
  }
});

document.addEventListener('click', (e) => {
  if (!document.getElementById('card-search-wrap').contains(e.target)) {
    dropdown.classList.remove('open');
  }
});

function selectDbCard(id) {
  selectedDbCard = CARD_DB.find(c => c.id === id);
  if (!selectedDbCard) return;

  dropdown.classList.remove('open');
  searchInput.value = selectedDbCard.name;

  // Show manual fields and auto-fill
  toggleManualFields(true);

  document.getElementById('m-name').value = selectedDbCard.name;
  document.getElementById('m-network').value = selectedDbCard.network === 'Diners' ? 'Diners' :
    (selectedDbCard.network === 'RuPay' ? 'RuPay' : selectedDbCard.network);
  // Fee fields
  const dbIsLtf = selectedDbCard.annualFee === 0 && (selectedDbCard.joiningFee || 0) === 0;
  document.getElementById('m-ltf').checked = dbIsLtf;
  document.getElementById('m-joining-fee').value = selectedDbCard.joiningFee || '';
  document.getElementById('m-annual-fee').value = selectedDbCard.annualFee || '';
  toggleFeeFields();
  document.getElementById('m-cap').value = selectedDbCard.monthlyCap || '';
  document.getElementById('m-notes').value = selectedDbCard.notes || '';

  CATEGORIES.forEach(cat => {
    const el = document.getElementById('rate-' + cat.key);
    if (el) el.value = selectedDbCard.rates[cat.key] || '';
  });

  document.querySelectorAll('.color-dot').forEach(d => {
    d.classList.toggle('selected', d.dataset.color === selectedDbCard.color);
  });

  // Flash the fields to show auto-fill
  document.getElementById('manual-fields').style.animation = 'none';
  document.getElementById('manual-fields').offsetHeight; // reflow
}

// ===================== MANUAL FIELDS TOGGLE =====================
function toggleManualFields(show) {
  document.getElementById('manual-fields').style.display = show ? 'block' : 'none';
  document.getElementById('manual-toggle').textContent = show ? 'hide manual fields' : 'or enter details manually';
  document.getElementById('manual-toggle').onclick = () => toggleManualFields(!show);
}

// ===================== MODAL =====================
function openModal(idx) {
  editingIdx = idx !== undefined ? idx : -1;
  selectedDbCard = null;
  const modal = document.getElementById('modal');

  document.getElementById('modal-title').textContent = editingIdx >= 0 ? 'Edit Credit Card' : 'Add Credit Card';
  document.getElementById('modal-save').textContent = editingIdx >= 0 ? 'Save Changes' : 'Add Card';

  // Build rate rows
  document.getElementById('m-rates').innerHTML = CATEGORIES.map(cat =>
    '<div class="rate-row"><label>' + cat.label + '</label><input type="number" id="rate-' + cat.key + '" placeholder="0" min="0" step="any"></div>'
  ).join('');

  // Build color dots
  document.getElementById('m-colors').innerHTML = COLORS.map((c, i) =>
    '<div class="color-dot' + (i === 0 ? ' selected' : '') + '" style="background:' + c + '" data-color="' + c + '" onclick="pickColor(this)"></div>'
  ).join('');

  // Reset search
  searchInput.value = '';
  dropdown.classList.remove('open');

  if (editingIdx >= 0) {
    // Editing existing card — show fields with current data
    const c = cards[editingIdx];
    toggleManualFields(true);
    document.getElementById('card-search-wrap').style.display = 'none';
    document.getElementById('manual-toggle').style.display = 'none';

    document.getElementById('m-name').value = c.name;
    document.getElementById('m-network').value = c.network;
    // Fee fields
    document.getElementById('m-ltf').checked = !!c.ltf;
    document.getElementById('m-joining-fee').value = c.joiningFee || '';
    document.getElementById('m-annual-fee').value = c.annualFee || '';
    toggleFeeFields();
    document.getElementById('m-cap').value = c.monthlyCap || '';
    document.getElementById('m-notes').value = c.notes || '';
    CATEGORIES.forEach(cat => {
      document.getElementById('rate-' + cat.key).value = c.rates[cat.key] || '';
    });
    document.querySelectorAll('.color-dot').forEach(d => {
      d.classList.toggle('selected', d.dataset.color === (c.color || COLORS[0]));
    });
  } else {
    // Adding new card — show search, hide manual until selected
    toggleManualFields(false);
    document.getElementById('card-search-wrap').style.display = 'block';
    document.getElementById('manual-toggle').style.display = 'block';
    document.getElementById('m-name').value = '';
    document.getElementById('m-network').value = 'Visa';
    document.getElementById('m-ltf').checked = false;
    document.getElementById('m-joining-fee').value = '';
    document.getElementById('m-annual-fee').value = '';
    toggleFeeFields();
    document.getElementById('m-cap').value = '';
    document.getElementById('m-notes').value = '';
  }

  modal.classList.add('open');
  if (editingIdx < 0) setTimeout(() => searchInput.focus(), 100);
}

function closeModal() { document.getElementById('modal').classList.remove('open'); }

function pickColor(el) {
  document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('selected'));
  el.classList.add('selected');
}

function toggleFeeFields() {
  const isLtf = document.getElementById('m-ltf').checked;
  document.getElementById('fee-fields').style.display = isLtf ? 'none' : 'block';
  if (isLtf) {
    document.getElementById('m-joining-fee').value = '';
    document.getElementById('m-annual-fee').value = '';
  }
}

function saveCard() {
  const name = document.getElementById('m-name').value.trim();
  if (!name) { alert('Please enter a card name or select one from the search.'); return; }

  const rates = {};
  CATEGORIES.forEach(cat => {
    rates[cat.key] = parseFloat(document.getElementById('rate-' + cat.key).value) || 0;
  });

  const isLtf = document.getElementById('m-ltf').checked;

  const card = {
    name,
    network: document.getElementById('m-network').value,
    rates,
    ltf: isLtf,
    joiningFee: isLtf ? 0 : (parseFloat(document.getElementById('m-joining-fee').value) || 0),
    annualFee: isLtf ? 0 : (parseFloat(document.getElementById('m-annual-fee').value) || 0),
    monthlyCap: parseFloat(document.getElementById('m-cap').value) || 0,
    notes: document.getElementById('m-notes').value.trim(),
    color: document.querySelector('.color-dot.selected')?.dataset.color || COLORS[0],
    dbId: selectedDbCard ? selectedDbCard.id : (editingIdx >= 0 && cards[editingIdx].dbId ? cards[editingIdx].dbId : null),
    bank: selectedDbCard ? selectedDbCard.bank : (editingIdx >= 0 && cards[editingIdx].bank ? cards[editingIdx].bank : ''),
    discontinued: selectedDbCard ? !!selectedDbCard.discontinued : (editingIdx >= 0 ? !!cards[editingIdx].discontinued : false),
    discontinuedNote: selectedDbCard ? (selectedDbCard.discontinuedNote || '') : (editingIdx >= 0 ? (cards[editingIdx].discontinuedNote || '') : ''),
  };

  if (editingIdx >= 0) {
    cards[editingIdx] = card;
  } else {
    cards.push(card);
  }
  save();
  renderCards();
  closeModal();
}

function editCard(i) { openModal(i); }

function deleteCard(i) {
  if (confirm('Delete "' + cards[i].name + '"?')) {
    cards.splice(i, 1);
    save();
    renderCards();
  }
}

// ===================== POPULATE PURCHASE SELECT =====================
(function initPurchaseSelect() {
  const sel = document.getElementById('inp-purchase');
  const groups = {};
  PURCHASE_TYPES.forEach(pt => {
    if (!groups[pt.group]) groups[pt.group] = [];
    groups[pt.group].push(pt);
  });
  for (const g in groups) {
    const og = document.createElement('optgroup');
    og.label = g;
    groups[g].forEach(pt => {
      const o = document.createElement('option');
      o.value = pt.key;
      o.textContent = pt.label;
      if (pt.key === 'general_purchase') o.selected = true;
      og.appendChild(o);
    });
    sel.appendChild(og);
  }
})();

// ===================== FUEL BRAND RATES =====================
// Co-branded fuel cards: accelerated rate at their partner pump, base rate at others
// cardId → { brand: 'fuel_bpcl'|'fuel_hpcl'|'fuel_indianoil', brandRate, otherRate }
const FUEL_BRAND_RATES = {
  'sbi-bpcl-octane':    { brand:'fuel_bpcl',     brandRate:7.25, otherRate:1 },
  'sbi-bpcl':           { brand:'fuel_bpcl',     brandRate:5,    otherRate:1 },
  'hdfc-indianoil':     { brand:'fuel_indianoil', brandRate:5,    otherRate:0.64 },
  'indianoil-axis':     { brand:'fuel_indianoil', brandRate:4.25, otherRate:1 },
  'kotak-indianoil':    { brand:'fuel_indianoil', brandRate:4,    otherRate:0.5 },
  'idfc-hpcl':          { brand:'fuel_hpcl',     brandRate:5,    otherRate:0.5 },
  'union-carbon-hpcl':  { brand:'fuel_hpcl',     brandRate:4,    otherRate:0.5 },
};
const FUEL_BRAND_CATS = ['fuel_indianoil','fuel_hpcl','fuel_bpcl'];

// ===================== ROUTE ENGINE =====================
function getCardRate(card, category, amount) {
  const cardId = card.dbId || card.id || '';
  // Check exclusions — for fuel brand categories, also check generic 'fuel' exclusion
  const exclList = EXCLUSIONS[cardId];
  if (exclList) {
    if (exclList.includes(category)) return { rate: 0, reward: 0, excluded: true };
    if (FUEL_BRAND_CATS.includes(category) && exclList.includes('fuel')) return { rate: 0, reward: 0, excluded: true };
  }
  // Resolve fuel brand categories to the correct rate
  let rate;
  if (FUEL_BRAND_CATS.includes(category)) {
    const fb = FUEL_BRAND_RATES[cardId];
    if (fb) {
      // Co-branded fuel card: high rate at partner pump, base rate elsewhere
      rate = (category === fb.brand) ? fb.brandRate : fb.otherRate;
    } else {
      // Regular card: use generic fuel rate for all pump brands
      rate = card.rates['fuel'] || card.rates[category] || 0;
    }
  } else {
    rate = card.rates[category] || 0;
  }
  let reward = amount * rate / 100;
  // Per-category cap — check both specific and generic fuel
  if (CATEGORY_CAPS[cardId]) {
    const cap = CATEGORY_CAPS[cardId][category] || (FUEL_BRAND_CATS.includes(category) ? CATEGORY_CAPS[cardId]['fuel'] : undefined);
    if (cap) reward = Math.min(reward, cap);
  }
  // Overall monthly cap
  if (card.monthlyCap > 0) reward = Math.min(reward, card.monthlyCap);
  return { rate, reward, excluded: false };
}

function getSmartBuyRate(card, amount) {
  if (!card.dbId || !SMARTBUY_RATES[card.dbId]) return null;
  const sb = SMARTBUY_RATES[card.dbId];
  let reward = amount * sb.rate / 100;
  // Cap reward based on monthly RP cap (approximate: bonus RP × ₹1 value)
  if (sb.capPerMonth && reward > sb.capPerMonth) reward = sb.capPerMonth;
  return { rate: sb.rate, reward };
}

function cardMatchesBank(card, bankRequired) {
  if (!bankRequired) return true;
  const b = (card.bank || card.name || '').toUpperCase();
  return b.includes(bankRequired.toUpperCase());
}

function cardMatchesNetwork(card, networkFilter) {
  if (!networkFilter || networkFilter === 'all') return true;
  return (card.network || '').toLowerCase() === networkFilter.toLowerCase();
}

// Check if a card is discontinued (from card object or DB lookup by dbId)
function escHtml(str) {
  if (!str) return '';
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function isCardDiscontinued(card) {
  if (card.discontinued) return true;
  if (card.dbId) {
    const db = CARD_DB.find(c => c.id === card.dbId);
    if (db && db.discontinued) return true;
  }
  return false;
}

function getDiscontinuedNote(card) {
  if (card.discontinuedNote) return card.discontinuedNote;
  if (card.dbId) {
    const db = CARD_DB.find(c => c.id === card.dbId);
    if (db && db.discontinuedNote) return db.discontinuedNote;
  }
  return '';
}

// ===================== FUEL SURCHARGE CALCULATOR =====================
const FUEL_SURCHARGE_RATE = 1; // 1% surcharge
const FUEL_GST_ON_SURCHARGE = 18; // 18% GST on the surcharge
// Effective surcharge = 1% + (18% of 1%) = 1.18%
const FUEL_EFFECTIVE_SURCHARGE = FUEL_SURCHARGE_RATE * (1 + FUEL_GST_ON_SURCHARGE / 100); // 1.18

// Lookup: cardId → { minTxn, maxTxn, monthlyCap }
// Most cards: waive 1% on ₹400-₹5000, cap ₹250/month
const FUEL_WAIVER_DB = {
  'hdfc-indianoil':       { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'hdfc-intermiles':      { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'sbi-bpcl-octane':      { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'sbi-flipkart':         { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'indianoil-axis':       { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'kotak-urbane-gold':    { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'kotak-league-platinum':{ minTxn:400, maxTxn:5000, monthlyCap:250 },
  'kotak-indianoil':      { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'idfc-hpcl':            { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'hsbc-smart-value':     { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'bob-cashback':         { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'bob-easy':             { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'canara-mc-world':      { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'canara-rupay-select':  { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'pnb-rupay-platinum':   { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'union-rupay-select':   { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'union-platinum':       { minTxn:200, maxTxn:5000, monthlyCap:250 },
  'union-carbon-hpcl':    { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'indian-bank-gold':     { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'central-world':        { minTxn:400, maxTxn:4000, monthlyCap:250 },
  'iob-rupay-select':     { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'iob-visa-classic':     { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'bajaj-rbl-platinum-prime':{ minTxn:400, maxTxn:5000, monthlyCap:100 },
  'kotak-zen':            { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'hdfc-regalia-gold':    { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'hdfc-millennia':       { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'sbi-cashback':         { minTxn:400, maxTxn:5000, monthlyCap:250 },
  'axis-ace':             { minTxn:400, maxTxn:5000, monthlyCap:250 },
};

function getFuelWaiver(card) {
  // Check card object first (for user-added cards)
  if (card.fuelSurchargeWaiver) return card.fuelSurchargeWaiver;
  // Check lookup DB by card id or dbId
  const id = card.dbId || card.id;
  if (id && FUEL_WAIVER_DB[id]) return FUEL_WAIVER_DB[id];
  return null;
}

function calcFuelSurcharge() {
  const monthlySpend = parseFloat(document.getElementById('fuel-monthly').value) || 0;
  const perTxn = parseFloat(document.getElementById('fuel-per-txn').value) || 0;
  const resultsDiv = document.getElementById('fuel-results');

  if (monthlySpend <= 0 || perTxn <= 0) {
    resultsDiv.innerHTML = '<div class="empty-state"><div class="icon">&#9981;</div><p>Enter your monthly fuel spend and average fill-up amount to see savings.</p></div>';
    return;
  }

  const txnCount = Math.ceil(monthlySpend / perTxn);
  const totalSurcharge = monthlySpend * FUEL_EFFECTIVE_SURCHARGE / 100;

  // Update info row
  document.getElementById('fuel-txn-count').textContent = txnCount;
  document.getElementById('fuel-total-surcharge').textContent = '₹' + totalSurcharge.toFixed(0);

  // Build list of all cards with waiver info
  const allResults = [];
  const userCardIds = new Set();

  // Process user's saved cards
  cards.forEach(c => {
    const id = c.dbId || c.id;
    userCardIds.add(id);
    const waiver = getFuelWaiver(c);
    const fuelRate = (c.rates && c.rates.fuel) || 0;
    const savings = calcWaiverSavings(waiver, perTxn, txnCount, monthlySpend);
    const fuelReward = monthlySpend * fuelRate / 100;
    allResults.push({
      id: id,
      name: c.name,
      bank: c.bank || '',
      color: c.color || '#888',
      isUser: true,
      waiver: waiver,
      surchargeWaived: savings,
      fuelRewardRate: fuelRate,
      fuelReward: fuelReward,
      totalBenefit: savings + fuelReward,
      discontinued: isCardDiscontinued(c)
    });
  });

  // Process all DB cards not in user's list
  CARD_DB.forEach(c => {
    if (userCardIds.has(c.id)) return;
    const waiver = getFuelWaiver(c);
    const fuelRate = (c.rates && c.rates.fuel) || 0;
    if (!waiver && fuelRate <= 0) return; // skip cards with no fuel benefit at all
    const savings = calcWaiverSavings(waiver, perTxn, txnCount, monthlySpend);
    const fuelReward = monthlySpend * fuelRate / 100;
    allResults.push({
      id: c.id,
      name: c.name,
      bank: c.bank || '',
      color: c.color || '#888',
      isUser: false,
      waiver: waiver,
      surchargeWaived: savings,
      fuelRewardRate: fuelRate,
      fuelReward: fuelReward,
      totalBenefit: savings + fuelReward,
      discontinued: c.discontinued || false
    });
  });

  // Sort by total benefit descending
  allResults.sort((a, b) => b.totalBenefit - a.totalBenefit);

  // Find best savings
  const bestSaving = allResults.length > 0 ? allResults[0].totalBenefit : 0;
  const bestWaiver = allResults.length > 0 ? allResults[0].surchargeWaived : 0;

  // Render results
  let html = '';

  // Summary bar
  html += '<div class="fuel-summary-bar">';
  html += '<div class="fuel-summary-stat"><div class="fss-label">Monthly Fuel Spend</div><div class="fss-value neutral">₹' + monthlySpend.toLocaleString('en-IN') + '</div><div class="fss-sub">' + txnCount + ' transaction' + (txnCount > 1 ? 's' : '') + '</div></div>';
  html += '<div class="fuel-summary-stat"><div class="fss-label">Surcharge (No Waiver)</div><div class="fss-value loss">-₹' + totalSurcharge.toFixed(0) + '</div><div class="fss-sub">1% + 18% GST = 1.18%</div></div>';
  html += '<div class="fuel-summary-stat"><div class="fss-label">Best Total Benefit</div><div class="fss-value save">₹' + bestSaving.toFixed(0) + '/mo</div><div class="fss-sub">' + (bestWaiver > 0 ? '₹' + bestWaiver.toFixed(0) + ' waiver + rewards' : 'fuel rewards') + '</div></div>';
  html += '</div>';

  // User's cards section
  const userResults = allResults.filter(r => r.isUser);
  if (userResults.length > 0) {
    html += '<div class="fuel-result-section">';
    html += '<h4>Your Cards</h4>';
    userResults.forEach((r, i) => html += renderFuelRow(r, i === 0 && r.totalBenefit > 0 && r.totalBenefit === allResults[0].totalBenefit));
    html += '</div>';
  }

  // All other cards
  const otherResults = allResults.filter(r => !r.isUser);
  if (otherResults.length > 0) {
    html += '<div class="fuel-result-section">';
    html += '<h4>' + (userResults.length > 0 ? 'Other Cards with Fuel Benefits' : 'Cards with Fuel Benefits') + '</h4>';
    otherResults.forEach((r, i) => html += renderFuelRow(r, !userResults.some(u => u.totalBenefit >= r.totalBenefit) && i === 0 && r.totalBenefit > 0));
    html += '</div>';
  }

  if (allResults.length === 0) {
    html += '<div class="fuel-no-waiver">No cards with fuel benefits found. Add your cards in the My Cards tab.</div>';
  }

  // Explainer
  html += '<div class="fuel-explainer">';
  html += '<h5>How fuel surcharge works</h5>';
  html += '<p>When you swipe a credit card at a fuel station, a <strong>1% surcharge</strong> is added to the transaction, plus <strong>18% GST</strong> on that surcharge (effective ~1.18%).</p>';
  html += '<p>Cards with fuel surcharge waiver reverse this charge, but only for transactions within a specific range (usually ₹400 - ₹5,000) and up to a monthly cap (usually ₹250).</p>';
  html += '<p>Tip: Paying via <strong>UPI (CC on UPI)</strong> at fuel stations avoids the surcharge entirely, as UPI transactions don\'t attract fuel surcharge.</p>';
  html += '</div>';

  resultsDiv.innerHTML = html;
}

function calcWaiverSavings(waiver, perTxn, txnCount, monthlySpend) {
  if (!waiver) return 0;
  const { minTxn, maxTxn, monthlyCap } = waiver;
  let totalWaived = 0;
  for (let i = 0; i < txnCount; i++) {
    // Check if transaction qualifies
    if (perTxn >= minTxn && perTxn <= maxTxn) {
      totalWaived += perTxn * FUEL_EFFECTIVE_SURCHARGE / 100;
    }
  }
  // Apply monthly cap
  if (monthlyCap > 0 && totalWaived > monthlyCap) {
    totalWaived = monthlyCap;
  }
  return totalWaived;
}

function renderFuelRow(r, isBest) {
  const dcClass = r.discontinued ? ' discontinued' : '';
  const bestClass = isBest ? ' fuel-best' : '';
  const yoursClass = r.isUser ? ' fuel-yours' : '';
  let html = '<div class="fuel-card-row' + bestClass + yoursClass + dcClass + '">';
  // Mini card visual
  html += '<div class="card-mini" style="background:' + r.color + '"><div class="cm-bank">' + escHtml(r.bank) + '</div><div class="cm-chip"></div><div class="cm-name">' + escHtml(r.name) + '</div></div>';
  // Info
  html += '<div class="fuel-card-info">';
  html += '<div class="fc-name">' + escHtml(r.name);
  if (r.isUser) html += '<span class="fc-yours-tag">Your Card</span>';
  if (isBest) html += '<span class="best-badge">Best</span>';
  if (r.discontinued) html += '<span class="discontinued-badge">Discontinued</span>';
  html += '</div>';
  html += '<div class="fc-bank">' + escHtml(r.bank) + '</div>';
  // Detail tags
  html += '<div class="fuel-card-details">';
  if (r.waiver) {
    html += '<div class="fuel-detail-tag savings">Waiver: <span>₹' + r.surchargeWaived.toFixed(0) + '</span></div>';
    html += '<div class="fuel-detail-tag">Range: ₹' + r.waiver.minTxn + '-₹' + r.waiver.maxTxn.toLocaleString('en-IN') + '</div>';
    html += '<div class="fuel-detail-tag">Cap: ₹' + r.waiver.monthlyCap + '/mo</div>';
  } else {
    html += '<div class="fuel-detail-tag">No surcharge waiver</div>';
  }
  if (r.fuelRewardRate > 0) {
    html += '<div class="fuel-detail-tag reward">Fuel reward: <span>' + r.fuelRewardRate + '%</span></div>';
  }
  html += '</div>';
  html += '</div>';
  // Savings
  html += '<div class="fuel-card-savings">';
  html += '<div class="fc-amount">₹' + r.totalBenefit.toFixed(0) + '</div>';
  html += '<div class="fc-label">total benefit/mo</div>';
  html += '</div>';
  html += '</div>';
  return html;
}

// Update txn count and surcharge on input change
['fuel-monthly', 'fuel-per-txn'].forEach(id => {
  document.getElementById(id).addEventListener('input', function() {
    const m = parseFloat(document.getElementById('fuel-monthly').value) || 0;
    const p = parseFloat(document.getElementById('fuel-per-txn').value) || 0;
    if (m > 0 && p > 0) {
      const t = Math.ceil(m / p);
      document.getElementById('fuel-txn-count').textContent = t;
      document.getElementById('fuel-total-surcharge').textContent = '₹' + (m * FUEL_EFFECTIVE_SURCHARGE / 100).toFixed(0);
    } else {
      document.getElementById('fuel-txn-count').textContent = '--';
      document.getElementById('fuel-total-surcharge').textContent = '--';
    }
  });
});

function evaluateAllRoutes(purchaseKey, amount, networkFilter) {
  const pt = PURCHASE_TYPES.find(p => p.key === purchaseKey);
  if (!pt) return [];
  const all = [];

  // Filter cards by selected network
  const filteredCards = cards.filter(c => cardMatchesNetwork(c, networkFilter));
  if (filteredCards.length === 0) return [];

  // 1. DIRECT routes — each card paying directly
  filteredCards.forEach(card => {
    const { rate, reward } = getCardRate(card, pt.directCat, amount);
    all.push({
      type: 'direct',
      name: 'Direct with ' + card.name,
      totalReward: reward,
      effectiveRate: rate,
      card: card,
      steps: [{ label: 'Pay directly with credit card (' + (card.network || 'Card') + ')', card: card, rate: rate, reward: reward }],
      tip: null, notes: null
    });
  });

  // 2. ROUTE-based options
  ROUTE_TEMPLATES.forEach(route => {
    if (!route.purchaseTypes.includes(purchaseKey)) return;

    // Check if route requires a specific network (e.g., RuPay UPI routes)
    if (route.networkRequired) {
      const hasMatchingCard = filteredCards.some(c => (c.network || '').toLowerCase() === route.networkRequired.toLowerCase());
      if (!hasMatchingCard) return;
    }

    // Find best card for each card-required step
    let totalReward = 0;
    const stepDetails = [];
    let viable = true;

    // Candidate cards: if route needs specific network, only those; else all filtered
    const routeCards = route.networkRequired
      ? filteredCards.filter(c => (c.network || '').toLowerCase() === route.networkRequired.toLowerCase())
      : filteredCards;

    route.steps.forEach(step => {
      if (step.cardCat === null) {
        // Non-card step (using GC balance / platform bonus)
        const bonus = (step.platformBonus || 0) * amount / 100;
        totalReward += bonus;
        stepDetails.push({ label: step.label, card: null, rate: step.platformBonus || 0, reward: bonus });
      } else if (step.cardCat === '_smartbuy') {
        // SmartBuy — find best HDFC card with SmartBuy rates from filtered set
        let bestCard = null, bestReward = 0, bestRate = 0;
        routeCards.forEach(card => {
          if (!cardMatchesBank(card, 'HDFC')) return;
          const sb = getSmartBuyRate(card, amount);
          if (sb && sb.reward > bestReward) {
            bestCard = card; bestReward = sb.reward; bestRate = sb.rate;
          }
        });
        if (!bestCard) { viable = false; return; }
        totalReward += bestReward;
        stepDetails.push({ label: step.label, card: bestCard, rate: bestRate, reward: bestReward });
      } else {
        // Regular card category step
        // Resolve special cardCat values based on purchase type
        let stepCat = step.cardCat;
        if (stepCat === '_inherit' && pt) stepCat = pt.directCat;
        if (stepCat === 'fuel' && pt && FUEL_BRAND_CATS.includes(pt.directCat)) stepCat = pt.directCat;
        let bestCard = null, bestReward = 0, bestRate = 0;
        routeCards.forEach(card => {
          if (route.bankRequired && !cardMatchesBank(card, route.bankRequired)) return;
          const { rate, reward } = getCardRate(card, stepCat, amount);
          const fee = step.feePercent ? amount * step.feePercent / 100 : 0;
          const net = reward - fee;
          if (net > bestReward) { bestCard = card; bestReward = net; bestRate = rate; }
        });
        if (!bestCard) { viable = false; return; }
        const fee = step.feePercent ? amount * step.feePercent / 100 : 0;
        totalReward += bestReward;
        stepDetails.push({
          label: step.label + (step.feePercent ? ' (fee: ' + step.feePercent + '%)' : ''),
          card: bestCard,
          rate: bestRate,
          reward: bestReward,
          fee: fee
        });
      }
    });

    if (!viable || totalReward <= 0) return;

    all.push({
      type: 'route',
      name: route.name,
      totalReward: totalReward,
      effectiveRate: (totalReward / amount) * 100,
      steps: stepDetails,
      tip: route.tip || null,
      notes: route.notes || null,
      card: stepDetails.find(s => s.card)?.card || null
    });
  });

  // Sort descending, deduplicate same-name routes keeping best
  all.sort((a, b) => b.totalReward - a.totalReward);
  const seen = new Set();
  return all.filter(r => {
    const key = r.name + '|' + (r.card?.name || '');
    if (seen.has(key)) return false;
    seen.add(key);
    return true;
  });
}

// ===================== COMPARE =====================
function compare() {
  const purchaseKey = document.getElementById('inp-purchase').value;
  const networkFilter = document.getElementById('inp-network').value;
  const amount = parseFloat(document.getElementById('inp-amount').value) || 0;
  const feeAdjust = document.getElementById('inp-fee-adjust').checked;
  const resultsEl = document.getElementById('results');
  const pt = PURCHASE_TYPES.find(p => p.key === purchaseKey);

  if (cards.length === 0) {
    resultsEl.innerHTML = '<div class="empty-state"><p>Add your credit cards first in the "My Cards" tab.</p></div>';
    document.getElementById('share-bar').style.display = 'none';
    return;
  }
  if (amount <= 0) {
    resultsEl.innerHTML = '<div class="empty-state"><p>Enter a purchase amount to compare.</p></div>';
    document.getElementById('share-bar').style.display = 'none';
    return;
  }

  const ranked = evaluateAllRoutes(purchaseKey, amount, networkFilter);

  // Fee-adjusted: deduct monthly portion of annual fee from each result
  if (feeAdjust) {
    ranked.forEach(r => {
      // Find the primary card used
      const primaryCard = r.card;
      if (primaryCard) {
        const annualFee = primaryCard.annualFee || 0;
        const monthlyFee = annualFee / 12;
        r.totalReward -= monthlyFee;
        r.feeDeducted = monthlyFee;
        r.effectiveRate = (r.totalReward / amount) * 100;
      }
    });
    ranked.sort((a, b) => b.totalReward - a.totalReward);
  }

  if (ranked.length === 0 && networkFilter !== 'all') {
    resultsEl.innerHTML = '<div class="empty-state"><p>No ' + esc(networkFilter) + ' cards found. Try "All Cards" or add a ' + esc(networkFilter) + ' card in "My Cards" tab.</p></div>';
    return;
  }

  if (ranked.length === 0) {
    resultsEl.innerHTML = '<div class="empty-state"><p>No routes found for this purchase type.</p></div>';
    document.getElementById('share-bar').style.display = 'none';
    return;
  }

  document.getElementById('share-bar').style.display = 'block';
  const bestReward = ranked[0].totalReward;
  // Find best direct-only for savings comparison
  const bestDirect = ranked.find(r => r.type === 'direct');
  const directReward = bestDirect ? bestDirect.totalReward : 0;
  const extraSavings = bestReward - directReward;

  const netLabel = networkFilter !== 'all' ? ' (' + esc(networkFilter) + ' only)' : '';
  let headerHtml = '<div class="results-header"><h3>Results for ' + fmt(amount) + ' on ' + esc(pt.label) + netLabel + '</h3>';
  if (extraSavings > 0.01 && ranked[0].type === 'route') {
    headerHtml += '<div class="savings-summary">Smart route saves ' + fmt(extraSavings) + ' more than direct payment!</div>';
  }
  headerHtml += '</div>';

  resultsEl.innerHTML = headerHtml + ranked.map((r, i) => {
    const isBest = i === 0 && r.totalReward > 0;
    const isRoute = r.type === 'route';
    const typeTag = isRoute
      ? '<span class="type-tag route">ROUTE</span>'
      : '<span class="type-tag direct">DIRECT</span>';

    // Check if any card used in this route is discontinued (check card object + DB lookup)
    const routeHasDc = r.steps.some(s => s.card && isCardDiscontinued(s.card));
    const dcCards = r.steps.filter(s => s.card && isCardDiscontinued(s.card)).map(s => s.card);
    const dcNote = dcCards.length > 0 ? getDiscontinuedNote(dcCards[0]) : '';

    let stepsHtml = '';
    if (r.steps.length > 0) {
      stepsHtml = '<div class="route-steps">' +
        r.steps.map((s, si) =>
          '<div class="route-step">' +
            '<div class="step-num">' + (si + 1) + '</div>' +
            '<div class="step-body">' +
              '<div class="step-action">' + esc(s.label) + '</div>' +
              (s.card ? '<div class="step-card-used">Use: ' + esc(s.card.name) + ' <span style="opacity:0.6">[' + esc(s.card.network || '?') + ']</span> (' + s.rate.toFixed(1) + '%) ' + (isCardDiscontinued(s.card) ? '<span class="discontinued-inline">DISCONTINUED</span>' : '') + applyBtn(s.card.dbId, true) + '</div>' : '') +
            '</div>' +
            '<div class="step-reward">' + (s.reward > 0 ? '+' + fmt(s.reward) : (s.reward < 0 ? fmt(s.reward) : '')) + '</div>' +
          '</div>'
        ).join('') +
      '</div>';
    }

    let tipHtml = r.tip ? '<div class="route-tip">' + esc(r.tip) + '</div>' : '';
    let notesHtml = r.notes ? '<div class="route-notes">' + esc(r.notes) + '</div>' : '';

    // Collect unique cards used in this route that have apply links
    const applyCards = [];
    const seenApply = new Set();
    r.steps.forEach(s => {
      if (s.card && s.card.dbId && APPLY_LINKS[s.card.dbId] && !seenApply.has(s.card.dbId)) {
        seenApply.add(s.card.dbId);
        applyCards.push(s.card);
      }
    });
    let applyHtml = applyCards.length > 0 ? '<div class="apply-row">' +
      applyCards.map(c => applyBtn(c.dbId, false)).join(' ') +
      '<span class="apply-hint">Don\'t have ' + (applyCards.length === 1 ? 'this card' : 'these cards') + '? Apply now</span></div>' : '';

    let feeHtml = r.feeDeducted > 0 ? '<div class="route-notes" style="color:var(--red);">Annual fee impact: -' + fmt(r.feeDeducted) + '/mo deducted</div>' : '';

    let dcHtml = routeHasDc ? '<div class="discontinued-note" style="margin:8px 12px 0;">' + esc(dcNote || 'This card is discontinued and not open for new applications.') + '</div>' : '';

    return '<div class="route-card' + (isBest ? ' best' : '') + (routeHasDc ? ' discontinued' : '') + '">' +
      '<div class="route-header">' +
        '<div class="route-rank">#' + (i + 1) + '</div>' +
        '<div class="route-title">' +
          '<span class="name">' + esc(r.name) +
            (routeHasDc ? '<span class="discontinued-badge">Discontinued</span>' : '') +
            (isBest ? '<span class="best-badge">BEST</span>' : '') +
            typeTag +
          '</span>' +
        '</div>' +
        '<div class="route-reward">' +
          '<div class="amount">' + fmt(r.totalReward) + '</div>' +
          '<div class="label">' + r.effectiveRate.toFixed(2) + '% return</div>' +
        '</div>' +
      '</div>' +
      stepsHtml + tipHtml + notesHtml + feeHtml + dcHtml + applyHtml +
    '</div>';
  }).join('');

  // --- Suggestion section: better cards from DB that user doesn't have ---
  const userCardIds = new Set(cards.map(c => c.dbId || c.id || c.name));
  const userBestReward = bestReward;
  const suggestCards = [];

  CARD_DB.forEach(dbCard => {
    // Skip if user already has this card
    if (userCardIds.has(dbCard.id)) return;
    // Apply network filter
    if (networkFilter && networkFilter !== 'all' && (dbCard.network || '').toLowerCase() !== networkFilter.toLowerCase()) return;
    // Calculate direct reward for this card
    const { rate, reward } = getCardRate(dbCard, pt.directCat, amount);
    if (reward <= 0) return;
    let netReward = reward;
    if (feeAdjust && dbCard.annualFee > 0) netReward -= dbCard.annualFee / 12;
    // Only suggest if it beats the user's best
    if (netReward > userBestReward) {
      suggestCards.push({ card: dbCard, reward: netReward, rate: rate, extra: netReward - userBestReward });
    }
  });

  suggestCards.sort((a, b) => b.reward - a.reward);
  const topSuggestions = suggestCards.slice(0, 5);

  if (topSuggestions.length > 0) {
    let suggestHtml = '<div class="suggest-section">' +
      '<div class="suggest-header"><h3>Cards that could earn you more</h3><span class="suggest-badge">UPGRADE TIP</span></div>';
    topSuggestions.forEach(s => {
      const c = s.card;
      const rateTags = CATEGORIES
        .filter(cat => c.rates[cat.key] > 0)
        .sort((a, b) => c.rates[b.key] - c.rates[a.key])
        .slice(0, 4)
        .map(cat => '<span class="sb-tag' + (cat.key === pt.directCat ? ' best' : '') + '">' + cat.label.split('/')[0].trim() + ' ' + c.rates[cat.key] + '%</span>')
        .join('');
      const feeText = c.annualFee === 0 && (c.joiningFee || 0) === 0
        ? '<span style="color:var(--green)">Lifetime Free</span>'
        : 'Fee: &#8377;' + (c.annualFee || 0) + '/yr';
      const sgDc = !!c.discontinued;
      const sgDcBadge = sgDc ? ' <span class="discontinued-badge">Discontinued</span>' : '';
      const sgDcNote = sgDc ? '<div class="discontinued-note">' + esc(c.discontinuedNote || 'No longer available for new applications.') + '</div>' : '';
      suggestHtml += '<div class="suggest-card' + (sgDc ? ' discontinued' : '') + '">' +
        cardVisualLg(c) +
        '<div class="suggest-body">' +
          '<div class="sb-name">' + esc(c.name) + sgDcBadge + '</div>' +
          '<div class="sb-bank">' + esc(c.bank) + ' &middot; ' + esc(c.network) + '</div>' +
          '<div class="sb-rates">' + rateTags + '</div>' +
          '<div class="sb-fee">' + feeText + '</div>' +
          sgDcNote +
          (!sgDc && APPLY_LINKS[c.id] ? '<div style="margin-top:4px">' + applyBtn(c.id, false) + '</div>' : '') +
        '</div>' +
        '<div class="suggest-reward">' +
          '<div class="sr-amount">' + fmt(s.reward) + '</div>' +
          '<div class="sr-label">' + s.rate.toFixed(2) + '% on ' + esc(pt.label) + '</div>' +
          '<div class="sr-extra">+' + fmt(s.extra) + ' more</div>' +
        '</div>' +
      '</div>';
    });
    suggestHtml += '</div>';
    resultsEl.innerHTML += suggestHtml;
  }
}

// ===================== HELPERS =====================
function fmt(n) {
  return '&#8377;' + Number(n).toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function esc(s) {
  const d = document.createElement('div');
  d.textContent = s;
  return d.innerHTML;
}

function applyBtn(cardId, small) {
  const url = APPLY_LINKS[cardId];
  if (!url) return '';
  const cls = small ? 'btn-apply btn-apply-sm' : 'btn-apply';
  return '<a href="' + esc(url) + '" target="_blank" rel="noopener noreferrer" class="' + cls + '">Apply Now &#8594;</a>';
}

// Network logo text
const NET_LABEL = { 'Visa':'VISA', 'Mastercard':'MC', 'RuPay':'RuPay', 'Amex':'AMEX', 'Diners':'Diners' };

// Mini card visual (for search dropdown)
function cardMini(c) {
  const bg = c.color || '#334155';
  const net = NET_LABEL[c.network] || c.network || '';
  const bank = (c.bank || '').replace(/ Bank$/,'');
  return '<div class="card-mini" style="background:linear-gradient(135deg,' + bg + ',' + bg + 'cc)">' +
    '<div class="cm-chip"></div>' +
    '<div class="cm-bank">' + esc(bank) + '</div>' +
    '<div class="cm-name">' + esc(c.name.replace(bank,'').replace(c.bank||'','').trim()) + '</div>' +
    '<div class="cm-net">' + esc(net) + '</div>' +
  '</div>';
}

// Larger card visual (for suggestions section)
function cardVisualLg(c) {
  const bg = c.color || '#334155';
  const net = NET_LABEL[c.network] || c.network || '';
  const bank = (c.bank || '').replace(/ Bank$/,'');
  return '<div class="card-visual-lg" style="background:linear-gradient(135deg,' + bg + ',' + bg + 'cc)">' +
    '<div class="cv-chip"></div>' +
    '<div class="cv-bank">' + esc(bank) + '</div>' +
    '<div class="cv-name">' + esc(c.name.replace(bank,'').replace(c.bank||'','').trim()) + '</div>' +
    '<div class="cv-net">' + esc(net) + '</div>' +
  '</div>';
}

// Auto-compare on enter
document.getElementById('inp-amount').addEventListener('keydown', e => { if (e.key === 'Enter') compare(); });

// ===================== SHARE RESULTS =====================
function shareResults() {
  const purchaseKey = document.getElementById('inp-purchase').value;
  const amount = parseFloat(document.getElementById('inp-amount').value) || 0;
  const pt = PURCHASE_TYPES.find(p => p.key === purchaseKey);
  const networkFilter = document.getElementById('inp-network').value;
  const ranked = evaluateAllRoutes(purchaseKey, amount, networkFilter);
  if (ranked.length === 0) return;

  const best = ranked[0];
  const netLabel = networkFilter !== 'all' ? ' (' + networkFilter + ')' : '';
  let text = 'CardPick Result' + netLabel + '\n';
  text += 'Purchase: ' + pt.label + ' - Rs.' + amount.toLocaleString('en-IN') + '\n\n';
  ranked.slice(0, 5).forEach((r, i) => {
    text += '#' + (i + 1) + ' ' + r.name + ' - Rs.' + r.totalReward.toFixed(2) + ' (' + r.effectiveRate.toFixed(2) + '% return)';
    if (r.type === 'route') text += ' [ROUTE]';
    text += '\n';
    r.steps.forEach((s, si) => {
      if (s.card) text += '   Step ' + (si + 1) + ': ' + s.label + ' with ' + s.card.name + ' (' + s.rate.toFixed(1) + '%)\n';
    });
  });
  text += '\nFind your best card at https://rinzler-oss.github.io/CardPick/';

  const btn = document.querySelector('.btn-share');
  if (navigator.share) {
    navigator.share({ title: 'CardPick - Best Card Result', text: text }).catch(() => {});
  } else {
    navigator.clipboard.writeText(text).then(() => {
      btn.classList.add('copied');
      btn.innerHTML = '&#10003; Copied!';
      setTimeout(() => { btn.classList.remove('copied'); btn.innerHTML = '&#128279; Share Results'; }, 2000);
    });
  }
}

// ===================== MILESTONE DATA =====================
const MILESTONES = {
  'hdfc-regalia-gold': [
    { spend: 150000, reward: 'Rs.1,500 Taj/Marriott voucher', label: '1.5L spend' },
    { spend: 300000, reward: 'Rs.3,000 Taj/Marriott voucher', label: '3L spend' },
    { spend: 500000, reward: 'Rs.5,000 Taj/Marriott voucher', label: '5L spend' },
  ],
  'hdfc-regalia': [
    { spend: 800000, reward: 'Annual fee reversal + vouchers', label: '8L spend' },
  ],
  'hdfc-diners-black': [
    { spend: 80000, reward: '2,500 bonus RP/month', label: '80K/mo' },
    { spend: 500000, reward: 'Annual fee waiver', label: '5L spend' },
  ],
  'hdfc-infinia': [
    { spend: 1000000, reward: 'Annual fee waiver', label: '10L spend' },
  ],
  'hdfc-diners-privilege': [
    { spend: 300000, reward: 'Annual fee reversal', label: '3L spend' },
  ],
  'hdfc-millennia': [
    { spend: 100000, reward: 'Rs.500 cashback quarterly', label: '1L/qtr' },
  ],
  'sbi-elite': [
    { spend: 1000000, reward: 'Annual fee reversal (Rs.4,999)', label: '10L spend' },
  ],
  'sbi-prime': [
    { spend: 300000, reward: 'Annual fee reversal (Rs.2,999)', label: '3L spend' },
  ],
  'icici-sapphiro': [
    { spend: 600000, reward: 'Annual fee waiver', label: '6L spend' },
  ],
  'icici-coral': [
    { spend: 250000, reward: 'Annual fee waiver', label: '2.5L spend' },
  ],
  'icici-rubyx': [
    { spend: 200000, reward: 'Annual fee waiver', label: '2L spend' },
  ],
  'axis-magnus': [
    { spend: 1500000, reward: '25,000 bonus Edge Points', label: '15L spend' },
  ],
  'axis-atlas': [
    { spend: 750000, reward: 'Annual fee reversal', label: '7.5L spend' },
  ],
  'axis-ace': [
    { spend: 200000, reward: 'Annual fee waiver', label: '2L spend' },
  ],
  'idfc-select': [
    { spend: 200000, reward: 'Annual fee waiver', label: '2L spend' },
  ],
  'sc-ultimate': [
    { spend: 600000, reward: 'Annual fee reversal', label: '6L spend' },
  ],
};

// ===================== CARD EXCLUSIONS =====================
// Categories where the card gives 0% even if the rate table shows otherwise
// Mapped by card ID → array of excluded categories
const EXCLUSIONS = {
  'sbi-cashback': ['utilities','fuel','general'], // Utility, Insurance, Fuel, Rent, Wallet, Education, Jewellery, Railways
  'hdfc-infinia': ['fuel'],
  'hdfc-diners-black': ['fuel'],
  'hdfc-diners-privilege': ['fuel'],
  'hdfc-regalia': ['fuel'],
  'hdfc-regalia-gold': ['fuel'],
  'hdfc-regalia-first': ['fuel'],
  'hdfc-millennia': ['fuel'],
  'hdfc-swiggy': ['fuel'],
  'hdfc-freedom': ['fuel'],
  'icici-amazon-pay': ['fuel'],
  'axis-ace': ['fuel'], // Fuel surcharge waiver only, no reward points on fuel
  'kotak-zen': ['fuel','utilities'], // No pts on fuel, wallet, rent, gaming
  'kotak-royale': ['fuel','utilities'], // No pts on fuel, wallet, rent, gaming
  'bajaj-rbl-world-prime': ['fuel'],
  'bajaj-rbl-platinum-prime': ['fuel'],
};

// ===================== PER-CATEGORY CAPS =====================
// Monthly reward cap per specific category (in ₹)
// card ID → { category: capAmount }
const CATEGORY_CAPS = {
  'hdfc-swiggy': { dining: 1500 }, // 10% on Swiggy capped at ₹1,500/mo
  'hdfc-millennia': { online: 750 }, // 5% on select online capped
  'sbi-simplyclick': { online: 500 }, // 10x on partners capped
  'axis-flipkart': { online: 500 }, // 5% on Flipkart capped
  'canara-rupay-select': { dining: 50, utilities: 50 }, // 5% dining/utility cap ₹50/mo each
  'idfc-select': { dining: 1000, travel: 1000 }, // category caps on select categories
};

// ===================== NON-PERCENTAGE PERKS =====================
// card ID → array of { type, label, value (estimated ₹/month) }
const PERKS = {
  'hdfc-infinia': [
    { type: 'lounge', label: 'Unlimited domestic+intl lounge', value: 500 },
    { type: 'concierge', label: '24/7 concierge service', value: 0 },
    { type: 'golf', label: 'Complimentary golf', value: 250 },
  ],
  'hdfc-diners-black': [
    { type: 'lounge', label: 'Unlimited lounge (10+companion/qtr)', value: 500 },
    { type: 'membership', label: 'Club Marriott + Swiggy One + Prime', value: 400 },
    { type: 'golf', label: '2 golf games/qtr', value: 200 },
  ],
  'hdfc-diners-privilege': [
    { type: 'lounge', label: '12 lounge visits/qtr', value: 300 },
    { type: 'movie', label: 'BookMyShow BOGO (2 free/mo, Fri-Sun, max ₹250)', value: 500 },
    { type: 'dining', label: 'ITC Hotels F&B 15% off', value: 0 },
  ],
  'hdfc-regalia': [
    { type: 'lounge', label: '12 lounge visits/yr', value: 100 },
    { type: 'concierge', label: 'Concierge service', value: 0 },
    { type: 'dining', label: 'Swiggy Dineout 7.5%', value: 0 },
  ],
  'hdfc-regalia-gold': [
    { type: 'lounge', label: '12 lounge/yr', value: 100 },
    { type: 'membership', label: 'Swiggy One + MMT Black Gold', value: 300 },
  ],
  'sbi-elite': [
    { type: 'movie', label: '2 free movie tickets/mo (BMS, ~₹500)', value: 500 },
    { type: 'lounge', label: 'Priority Pass (6 intl/yr)', value: 200 },
    { type: 'concierge', label: 'Concierge service', value: 0 },
  ],
  'sbi-prime': [
    { type: 'golf', label: '4 golf rounds free/yr', value: 100 },
    { type: 'membership', label: 'ITC Hotels membership', value: 50 },
    { type: 'lounge', label: '4 domestic lounge/qtr', value: 100 },
  ],
  'icici-emeralde': [
    { type: 'lounge', label: 'Unlimited lounge (domestic+intl)', value: 500 },
    { type: 'concierge', label: 'Concierge + golf + spa', value: 250 },
  ],
  'icici-sapphiro': [
    { type: 'lounge', label: '4 intl lounge/yr + domestic', value: 200 },
    { type: 'concierge', label: 'Concierge service', value: 0 },
  ],
  'icici-coral': [
    { type: 'movie', label: 'BookMyShow BOGO (1 free/mo)', value: 250 },
    { type: 'lounge', label: '4 domestic lounge/yr', value: 50 },
  ],
  'axis-magnus': [
    { type: 'lounge', label: 'Unlimited lounge (8 intl/yr)', value: 400 },
    { type: 'concierge', label: 'Concierge + golf', value: 200 },
    { type: 'dining', label: '40% off dining partners', value: 0 },
  ],
  'axis-atlas': [
    { type: 'lounge', label: '8 lounge/qtr', value: 200 },
    { type: 'travel', label: 'Atlas miles for flights', value: 0 },
  ],
  'amex-plat-travel': [
    { type: 'lounge', label: 'Domestic lounge access', value: 100 },
    { type: 'travel', label: 'Travel insurance', value: 0 },
  ],
  'sc-ultimate': [
    { type: 'lounge', label: 'Priority Pass (unlimited)', value: 500 },
    { type: 'concierge', label: 'Concierge + travel insurance', value: 0 },
  ],
};

// ===================== RECOMMEND CARD ENGINE =====================
function recommendCard() {
  const cats = ['dining','groceries','fuel','travel','online','entertainment','utilities','general'];
  const spends = {};
  let totalSpend = 0;
  cats.forEach(c => {
    spends[c] = parseFloat(document.getElementById('rec-' + c).value) || 0;
    totalSpend += spends[c];
  });
  const feeAdjust = document.getElementById('rec-fee-adjust').checked;
  const resultsEl = document.getElementById('rec-results');

  if (totalSpend <= 0) {
    resultsEl.innerHTML = '<div class="empty-state"><p>Enter your monthly spending in at least one category.</p></div>';
    return;
  }

  // Score each card in the database
  const scored = CARD_DB.map(card => {
    let monthlyReward = 0;
    const excludedCats = [];
    cats.forEach(cat => {
      if (spends[cat] > 0) {
        const result = getCardRate({ ...card, dbId: card.id }, cat, spends[cat]);
        if (result.excluded) excludedCats.push(cat);
        monthlyReward += result.reward;
      }
    });
    // Apply monthly cap
    if (card.monthlyCap > 0) monthlyReward = Math.min(monthlyReward, card.monthlyCap);

    // Add estimated perk value
    const cardPerks = PERKS[card.id] || [];
    const perkValue = cardPerks.reduce((sum, p) => sum + (p.value || 0), 0);

    // Fee adjustment
    const annualFee = card.annualFee || 0;
    const monthlyFee = feeAdjust ? annualFee / 12 : 0;
    const netMonthly = monthlyReward + perkValue - monthlyFee;
    const yearlyReward = monthlyReward * 12;
    const yearlyNet = netMonthly * 12;

    // Best categories for this card
    const topCats = cats
      .filter(c => spends[c] > 0 && (card.rates[c] || 0) > 0 && !excludedCats.includes(c))
      .sort((a, b) => (card.rates[b] || 0) - (card.rates[a] || 0))
      .slice(0, 3);

    return {
      card, monthlyReward, netMonthly, yearlyReward, yearlyNet,
      annualFee, topCats, totalSpend, excludedCats, perkValue, cardPerks
    };
  });

  scored.sort((a, b) => b.netMonthly - a.netMonthly);
  const top = scored.slice(0, 10);

  if (top.length === 0 || top[0].netMonthly <= 0) {
    resultsEl.innerHTML = '<div class="empty-state"><p>No cards found with positive rewards for your spending pattern.</p></div>';
    return;
  }

  resultsEl.innerHTML = '<div class="results-header"><h3>Top Cards for Your Spending</h3><div class="savings-summary">Monthly spend: ' + fmt(totalSpend) + ' &middot; Best yearly reward: ' + fmt(top[0].yearlyNet) + (feeAdjust ? ' (after fee)' : '') + '</div></div>' +
    top.map((s, i) => {
      const isTop = i === 0;
      const card = s.card;
      const milestones = MILESTONES[card.id] || [];

      const catLabels = { dining:'Dining', groceries:'Groceries', fuel:'Fuel', travel:'Travel', online:'Online', entertainment:'Entertainment', utilities:'Utilities', general:'General' };

      let topCatsHtml = s.topCats.map(c =>
        '<span class="reward-tag">' + catLabels[c] + ' <span>' + (card.rates[c] || 0) + '%</span></span>'
      ).join('');

      let milestoneHtml = '';
      if (milestones.length > 0) {
        const yearlySpend = s.totalSpend * 12;
        milestoneHtml = '<div class="rec-milestones"><div style="font-size:0.75rem;color:var(--text-3);margin-bottom:6px;font-weight:600;">Spend Milestones</div>' +
          milestones.map(m => {
            const pct = Math.min(100, (yearlySpend / m.spend) * 100);
            const reached = yearlySpend >= m.spend;
            return '<div class="milestone-bar">' +
              '<div class="milestone-label">' + m.label + '</div>' +
              '<div class="milestone-track"><div class="milestone-fill" style="width:' + pct + '%;' + (reached ? 'background:var(--green);' : '') + '"></div></div>' +
              '<div class="milestone-reward">' + (reached ? '&#10003; ' : '') + m.reward + '</div>' +
            '</div>';
          }).join('') + '</div>';
      }

      let feeNote = '';
      if (card.annualFee > 0) {
        const ltf = card.joiningFee === 0 && card.annualFee === 0;
        feeNote = '<div class="rec-fee">Joining: ' + fmt(card.joiningFee || 0) + ' &middot; Annual: ' + fmt(card.annualFee) +
          (feeAdjust ? ' &middot; <span style="color:var(--red);">-' + fmt(s.annualFee / 12) + '/mo deducted</span>' : '') + '</div>';
      } else {
        feeNote = '<div class="rec-fee" style="color:var(--green);">Lifetime Free</div>';
      }

      // Exclusions display
      let excludeHtml = s.excludedCats.length > 0
        ? '<div style="margin-top:4px;">' + s.excludedCats.map(c => '<span class="excluded-tag">No ' + catLabels[c] + '</span>').join(' ') + '</div>'
        : '';

      // Perks display
      let perksHtml = '';
      if (s.cardPerks.length > 0) {
        perksHtml = '<div style="margin-top:6px;">' +
          s.cardPerks.map(p => '<span class="perk-tag">' + esc(p.label) + '</span>').join('') +
          (s.perkValue > 0 ? '<div style="font-size:0.7rem;color:var(--accent);margin-top:4px;">Est. perk value: ' + fmt(s.perkValue) + '/mo</div>' : '') +
        '</div>';
      }

      const recDcBadge = card.discontinued ? ' <span class="discontinued-badge">Discontinued</span>' : '';
      const recDcNote = card.discontinued && card.discontinuedNote ? '<div class="discontinued-note">' + esc(card.discontinuedNote) + '</div>' : '';
      return '<div class="rec-card' + (isTop ? ' top-pick' : '') + (card.discontinued ? ' discontinued' : '') + '">' +
        '<div class="rec-rank">' + (isTop ? 'TOP PICK' : '#' + (i + 1)) + '</div>' +
        '<div class="rec-name">' + esc(card.name) + ' <span style="font-size:0.78rem;color:var(--text-3);font-weight:400">' + esc(card.network) + '</span>' + recDcBadge + '</div>' +
        '<div class="rec-bank">' + esc(card.bank) + '</div>' +
        recDcNote +
        '<div class="rec-stats">' +
          '<div class="rec-stat"><div class="stat-label">Monthly Reward</div><div class="stat-value">' + fmt(s.monthlyReward) + '</div></div>' +
          '<div class="rec-stat"><div class="stat-label">Yearly' + (feeAdjust ? ' (net)' : '') + '</div><div class="stat-value">' + fmt(s.yearlyNet) + '</div></div>' +
          '<div class="rec-stat"><div class="stat-label">Eff. Rate</div><div class="stat-value">' + (s.netMonthly / s.totalSpend * 100).toFixed(2) + '%</div></div>' +
        '</div>' +
        '<div style="margin-top:8px;">' + topCatsHtml + '</div>' +
        excludeHtml + perksHtml + feeNote +
        (card.notes ? '<div class="rec-notes">' + esc(card.notes) + '</div>' : '') +
        milestoneHtml +
        (APPLY_LINKS[card.id] ? '<div class="apply-row">' + applyBtn(card.id, false) + '</div>' : '') +
      '</div>';
    }).join('');
}

// ===================== IMPORT / EXPORT =====================
function exportCards() {
  if (cards.length === 0) { alert('No cards to export.'); return; }
  const data = JSON.stringify({ cardpick: true, version: 1, cards: cards }, null, 2);
  const blob = new Blob([data], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'cardpick-cards.json';
  a.click();
  URL.revokeObjectURL(url);
}

function importCards(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      let imported = [];
      if (data.cardpick && data.cards) {
        imported = data.cards;
      } else if (Array.isArray(data)) {
        imported = data;
      } else {
        alert('Invalid CardPick export file.'); return;
      }
      if (imported.length === 0) { alert('No cards found in file.'); return; }
      const count = imported.length;
      imported.forEach(c => {
        // Avoid exact duplicates by name
        if (!cards.some(x => x.name === c.name)) cards.push(c);
      });
      save();
      renderCards();
      alert('Imported ' + count + ' card(s).');
    } catch (err) {
      alert('Error reading file: ' + err.message);
    }
  };
  reader.readAsText(file);
  event.target.value = ''; // Reset so same file can be imported again
}

// ===================== SPEND TRACKER =====================
let trackerData = JSON.parse(localStorage.getItem('cp_tracker') || '{}');

function saveTracker() { localStorage.setItem('cp_tracker', JSON.stringify(trackerData)); }

// Set default month to current
(function() {
  const now = new Date();
  const m = now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0');
  document.getElementById('trk-month').value = m;
})();

function saveTrackerMonth() {
  const month = document.getElementById('trk-month').value;
  if (!month) { alert('Select a month first.'); return; }
  const cats = ['dining','groceries','fuel','travel','online','entertainment','utilities','general'];
  const entry = {};
  let total = 0;
  cats.forEach(c => {
    entry[c] = parseFloat(document.getElementById('trk-' + c).value) || 0;
    total += entry[c];
  });
  if (total <= 0) { alert('Enter spending in at least one category.'); return; }
  trackerData[month] = entry;
  saveTracker();
  renderTrackerHistory();
  analyzeTracker();
}

function deleteTrackerMonth(month) {
  delete trackerData[month];
  saveTracker();
  renderTrackerHistory();
  document.getElementById('tracker-results').innerHTML = '';
}

function loadTrackerMonth(month) {
  document.getElementById('trk-month').value = month;
  const entry = trackerData[month] || {};
  const cats = ['dining','groceries','fuel','travel','online','entertainment','utilities','general'];
  cats.forEach(c => { document.getElementById('trk-' + c).value = entry[c] || ''; });
}

function renderTrackerHistory() {
  const el = document.getElementById('tracker-history');
  const months = Object.keys(trackerData).sort().reverse();
  if (months.length === 0) { el.innerHTML = ''; return; }

  const catLabels = { dining:'Dining', groceries:'Groceries', fuel:'Fuel', travel:'Travel', online:'Online', entertainment:'Entertain', utilities:'Utilities', general:'General' };

  el.innerHTML = '<div class="tracker-history"><h4>Saved Months</h4>' +
    months.map(m => {
      const entry = trackerData[m];
      const total = Object.values(entry).reduce((a, b) => a + b, 0);
      // Calculate reward with user's cards
      let reward = 0;
      if (cards.length > 0) {
        const cats = Object.keys(entry);
        cats.forEach(cat => {
          if (entry[cat] > 0) {
            let best = 0;
            cards.forEach(card => {
              const r = getCardRate(card, cat, entry[cat]);
              if (r.reward > best) best = r.reward;
            });
            reward += best;
          }
        });
      }
      return '<div class="history-row">' +
        '<span class="h-month" style="cursor:pointer;" onclick="loadTrackerMonth(\'' + m + '\')">' + m + '</span>' +
        '<span class="h-spend">Spent: ' + fmt(total) + '</span>' +
        '<span class="h-reward">Earned: ~' + fmt(reward) + '</span>' +
        '<span class="h-delete" onclick="deleteTrackerMonth(\'' + m + '\')">&#10005;</span>' +
      '</div>';
    }).join('') + '</div>';
}

function analyzeTracker() {
  const month = document.getElementById('trk-month').value;
  const entry = trackerData[month];
  const resultsEl = document.getElementById('tracker-results');
  if (!entry) {
    resultsEl.innerHTML = '<div class="empty-state"><p>Save a month first to see analysis.</p></div>';
    return;
  }

  const cats = ['dining','groceries','fuel','travel','online','entertainment','utilities','general'];
  const catLabels = { dining:'Dining', groceries:'Groceries', fuel:'Fuel', travel:'Travel', online:'Online Shopping', entertainment:'Entertainment', utilities:'Utilities', general:'General' };

  let totalSpend = 0;
  let actualReward = 0;
  let bestPossibleReward = 0;
  const catBreakdown = [];

  cats.forEach(cat => {
    const spent = entry[cat] || 0;
    totalSpend += spent;
    if (spent <= 0) return;

    // Actual reward with user's cards
    let bestActual = 0, bestActualCard = null;
    cards.forEach(card => {
      const r = getCardRate(card, cat, spent);
      if (r.reward > bestActual) { bestActual = r.reward; bestActualCard = card; }
    });
    actualReward += bestActual;

    // Best possible with ANY card from DB
    let bestDB = 0, bestDBCard = null;
    CARD_DB.forEach(card => {
      const r = getCardRate({ ...card, dbId: card.id }, cat, spent);
      if (r.reward > bestDB) { bestDB = r.reward; bestDBCard = card; }
    });
    bestPossibleReward += bestDB;

    catBreakdown.push({
      cat, label: catLabels[cat], spent, actualReward: bestActual, actualCard: bestActualCard,
      bestReward: bestDB, bestCard: bestDBCard, gap: bestDB - bestActual
    });
  });

  const missedReward = bestPossibleReward - actualReward;

  let summaryHtml = '<div class="tracker-summary"><h4 style="font-size:0.9rem;color:var(--text-1);margin-bottom:10px;">Spending Breakdown — ' + esc(month) + '</h4>';
  catBreakdown.forEach(cb => {
    summaryHtml += '<div class="tracker-row">' +
      '<span class="tracker-cat">' + cb.label + '</span>' +
      '<span class="tracker-amt">' + fmt(cb.spent) + '</span>' +
    '</div>';
  });
  summaryHtml += '<div class="tracker-total"><span>Total Spend</span><span style="color:var(--blue);">' + fmt(totalSpend) + '</span></div>';
  summaryHtml += '</div>';

  let insightHtml = '<div class="tracker-insight">';
  insightHtml += '<h4>Reward Analysis</h4>';

  if (cards.length > 0) {
    insightHtml += '<p>Your cards earned: <span class="highlight">' + fmt(actualReward) + '</span> (' + (totalSpend > 0 ? (actualReward / totalSpend * 100).toFixed(2) : '0') + '% effective rate)</p>';
    insightHtml += '<p>Best possible (any card): <span class="highlight">' + fmt(bestPossibleReward) + '</span> (' + (totalSpend > 0 ? (bestPossibleReward / totalSpend * 100).toFixed(2) : '0') + '%)</p>';
    if (missedReward > 1) {
      insightHtml += '<p>You missed: <span class="missed">' + fmt(missedReward) + '</span> in potential rewards</p>';
      // Show top gaps
      const gaps = catBreakdown.filter(cb => cb.gap > 1).sort((a, b) => b.gap - a.gap).slice(0, 3);
      if (gaps.length > 0) {
        insightHtml += '<p style="margin-top:8px;font-weight:600;color:var(--text-1);">Where you can improve:</p>';
        gaps.forEach(g => {
          insightHtml += '<p>' + g.label + ': ' + (g.actualCard ? esc(g.actualCard.name) : 'No card') + ' earned ' + fmt(g.actualReward) +
            ' &rarr; <span class="highlight">' + esc(g.bestCard.name) + '</span> would earn ' + fmt(g.bestReward) +
            ' (+' + fmt(g.gap) + ') ' +
            (APPLY_LINKS[g.bestCard.id] ? applyBtn(g.bestCard.id, true) : '') + '</p>';
        });
      }
    } else {
      insightHtml += '<p style="color:var(--green);font-weight:600;">You\'re already maximizing your rewards!</p>';
    }
  } else {
    insightHtml += '<p>Add your cards in the "My Cards" tab to see how much you\'re earning.</p>';
    insightHtml += '<p>Best possible (any card from DB): <span class="highlight">' + fmt(bestPossibleReward) + '</span></p>';
  }

  insightHtml += '</div>';

  resultsEl.innerHTML = summaryHtml + insightHtml;
}

renderCards();
renderTrackerHistory();

// Load external card DB (falls back to embedded CARD_DB on failure)
loadCardDB();

// Register service worker for PWA / offline support
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js').catch(() => {});
}
</script>
</body>
</html>
